diff --git a/ADMINISTRATIVONEW/.classpath b/ADMINISTRATIVONEW/.classpath
index 99b1ea4..d36341a 100644
--- a/ADMINISTRATIVONEW/.classpath
+++ b/ADMINISTRATIVONEW/.classpath
@@ -1,17 +1,27 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<classpath>
-	<classpathentry kind="src" path="src"/>
-	<classpathentry exported="true" kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.j2eedt.core.MYECLIPSE_JAVAEE_5_CONTAINER"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE_TOOLS"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_CORE"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_EXTRAS"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_EM"/>
-	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_CORE"/>
-	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_JAXB2"/>
-	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_HTTP_CLIENT"/>
-	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/WEB-INF/lib/poi-3.0.1-FINAL-20070705.jar"/>
-	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/PROCESOS/applet/jsch-0.1.44.jar"/>
-	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/PROCESOS/applet/descargaSFTP-1.2.jar"/>
-	<classpathentry kind="output" path="classes"/>
-</classpath>
+<?xml version="1.0" encoding="UTF-8"?>
+<classpath>
+	<classpathentry kind="src" path="src"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.j2eedt.core.MYECLIPSE_JAVAEE_5_CONTAINER"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE_TOOLS"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_CORE"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_EXTRAS"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_EM"/>
+	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_CORE"/>
+	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_JAXB2"/>
+	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_HTTP_CLIENT"/>
+	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/WEB-INF/lib/poi-3.0.1-FINAL-20070705.jar"/>
+	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/PROCESOS/applet/jsch-0.1.44.jar"/>
+	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/PROCESOS/applet/descargaSFTP-1.2.jar"/>
+	<classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/>
+	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/jdk1.6.0_07">
+		<attributes>
+			<attribute name="owner.project.facets" value="java"/>
+		</attributes>
+	</classpathentry>
+	<classpathentry kind="con" path="org.eclipse.jst.server.core.container/org.jboss.ide.eclipse.as.core.server.runtime.runtimeTarget/JBoss 4.2 Runtime">
+		<attributes>
+			<attribute name="owner.project.facets" value="jst.ejb"/>
+		</attributes>
+	</classpathentry>
+	<classpathentry kind="output" path="classes"/>
+</classpath>
diff --git a/ADMINISTRATIVONEW/.project b/ADMINISTRATIVONEW/.project
index ea19403..a4e3889 100644
--- a/ADMINISTRATIVONEW/.project
+++ b/ADMINISTRATIVONEW/.project
@@ -1,40 +1,48 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<projectDescription>
-	<name>ADMINISTRATIVONEW</name>
-	<comment></comment>
-	<projects>
-	</projects>
-	<buildSpec>
-		<buildCommand>
-			<name>org.eclipse.jdt.core.javabuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>com.genuitec.eclipse.j2eedt.core.DeploymentDescriptorValidator</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>org.eclipse.dali.core.persistenceBuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>org.eclipse.wst.validation.validationbuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>com.genuitec.eclipse.ast.deploy.core.DeploymentBuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-	</buildSpec>
-	<natures>
-		<nature>com.genuitec.eclipse.ast.deploy.core.deploymentnature</nature>
-		<nature>com.genuitec.eclipse.j2eedt.core.ejbnature</nature>
-		<nature>org.eclipse.dali.core.persistenceNature</nature>
-		<nature>org.eclipse.jdt.core.javanature</nature>
-	</natures>
-</projectDescription>
+<?xml version="1.0" encoding="UTF-8"?>
+<projectDescription>
+	<name>ADMINISTRATIVONEW</name>
+	<comment></comment>
+	<projects>
+	</projects>
+	<buildSpec>
+		<buildCommand>
+			<name>org.eclipse.wst.common.project.facet.core.builder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.jdt.core.javabuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>com.genuitec.eclipse.j2eedt.core.DeploymentDescriptorValidator</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.dali.core.persistenceBuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.wst.validation.validationbuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>com.genuitec.eclipse.ast.deploy.core.DeploymentBuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+	</buildSpec>
+	<natures>
+		<nature>org.eclipse.jem.workbench.JavaEMFNature</nature>
+		<nature>org.eclipse.wst.common.modulecore.ModuleCoreNature</nature>
+		<nature>com.genuitec.eclipse.ast.deploy.core.deploymentnature</nature>
+		<nature>com.genuitec.eclipse.j2eedt.core.ejbnature</nature>
+		<nature>org.eclipse.dali.core.persistenceNature</nature>
+		<nature>org.eclipse.jdt.core.javanature</nature>
+		<nature>org.eclipse.wst.common.project.facet.core.nature</nature>
+	</natures>
+</projectDescription>
diff --git a/ADMINISTRATIVONEW/src/admin/util/Constante.java b/ADMINISTRATIVONEW/src/admin/util/Constante.java
index 4ae8239..77fecd0 100644
--- a/ADMINISTRATIVONEW/src/admin/util/Constante.java
+++ b/ADMINISTRATIVONEW/src/admin/util/Constante.java
@@ -1120,6 +1120,7 @@
     //Inicio [Req.S17-022] kdelacruz 03.04.2017
     public static final String INDICADOR_ENVIADO = "S";
     public static final String INDICADOR_NO_ENVIADO = "N";
+    public static final String SEGUIMIENTO_CARTERA_COMBO_GENERICO_TIPO_DOCUMENTO = "WFSCTIDOC";
     //Fin [Req.S17-022]
     
     public static final String CODIGO_PROCESO_CARGA_MASIVA_SEGUIMIENTO_CARTERA = "CRCASEGA";
diff --git a/ADMINISTRATIVONEW/src/admin/util/ConstantesErrores.java b/ADMINISTRATIVONEW/src/admin/util/ConstantesErrores.java
index bccb7ab..ce1c0dc 100644
--- a/ADMINISTRATIVONEW/src/admin/util/ConstantesErrores.java
+++ b/ADMINISTRATIVONEW/src/admin/util/ConstantesErrores.java
@@ -824,6 +824,8 @@
     String ERROR_11176 = "11176"; //Usuario Asesor no pertenece a la Agencia del Cliente
     String ERROR_11177 = "11177"; //No se ha podido identificar el Tipo de Alerta ingresado
     String ERROR_11178 = "11178"; //No se ha podido identificar la Calificaci�n SBS ingresada
+    String ERROR_11186 = "11186"; //El N�mero de Cr�dito no pertenece al n�mero de documento especificado.
+    String ERROR_11187 = "11187"; //No se ha podido identificar el Tipo de Producto ingresado
     //Fin [S17-022]
 
     
diff --git a/ADMINISTRATIVONEW/src/admin/util/local/UtilAdminFacadeInterfaceLocal.java b/ADMINISTRATIVONEW/src/admin/util/local/UtilAdminFacadeInterfaceLocal.java
index 1fa6a34..4bb437c 100644
--- a/ADMINISTRATIVONEW/src/admin/util/local/UtilAdminFacadeInterfaceLocal.java
+++ b/ADMINISTRATIVONEW/src/admin/util/local/UtilAdminFacadeInterfaceLocal.java
@@ -388,5 +388,19 @@
 
     String validarGerenteAgencia(String codigoUsuario,
                                  BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    ArrayList<BeanCombo> lstDataCatalogo(String strNombreTabla, String strNombreColumna);
+
+    String obtenerTiempoTranscurrido(Date fechaInicio,
+                                     Date fechaFin,
+                                     String horaInicio,
+                                     String horaFin,
+                                     String codigoAgencia) throws Exception;
+
+    String obtenerTiempoTranscurrido(String fechaInicio,
+                                     String fechaFin,
+                                     String horaInicio,
+                                     String horaFin,
+                                     String codigoAgencia) throws Exception;
     // Fin [Req.17-022]
 }
diff --git a/ADMINISTRATIVONEW/src/admin/util/session/UtilAdminFacade.java b/ADMINISTRATIVONEW/src/admin/util/session/UtilAdminFacade.java
index 548a9a2..4c98342 100644
--- a/ADMINISTRATIVONEW/src/admin/util/session/UtilAdminFacade.java
+++ b/ADMINISTRATIVONEW/src/admin/util/session/UtilAdminFacade.java
@@ -2,6 +2,9 @@
 
 import static admin.util.ConstantesContabilidad.ESTADO_REGISTRO_VIGENTE;
 
+import java.sql.CallableStatement;
+import java.sql.Connection;
+import java.sql.ResultSet;
 import java.util.ArrayList;
 import java.util.Date;
 import java.util.Iterator;
@@ -9,6 +12,8 @@
 
 import javax.ejb.EJB;
 import javax.ejb.Stateless;
+import javax.naming.InitialContext;
+import javax.sql.DataSource;
 
 import pe.com.tfc.utils.AbstractFacade;
 import pe.com.tfc.utils.PropertyParams;
@@ -40,6 +45,7 @@
 import admin.encaje.local.ENMaestroReporteEncajeInterfaceLocal;
 import admin.util.BeanCombo;
 import admin.util.Constante;
+import admin.util.FormatoFecha;
 import admin.util.local.UtilAdminFacadeInterfaceLocal;
 import admin.util.remote.UtilAdminFacadeInterfaceRemote;
 
@@ -923,6 +929,68 @@
         }
         return indicadorGerenteAgencia;
     }
+
+    public String obtenerTiempoTranscurrido(Date fechaInicio,
+                                            Date fechaFin,
+                                            String horaInicio,
+                                            String horaFin,
+                                            String codigoAgencia) throws Exception {
+        return obtenerTiempoTranscurrido(FormatoFecha.dateUtilToStringDDMMYYYY(fechaInicio),
+                                         FormatoFecha.dateUtilToStringDDMMYYYY(fechaFin),
+                                         horaInicio,
+                                         horaFin,
+                                         codigoAgencia);
+    }
+
+    public String obtenerTiempoTranscurrido(String fechaInicio,
+                                            String fechaFin,
+                                            String horaInicio,
+                                            String horaFin,
+                                            String codigoAgencia) throws Exception {
+
+        Connection conn = null;
+        CallableStatement cstm = null;
+        String procedure = null;
+        ResultSet rs = null;
+        Integer diasHabiles;
+        String horas_minutos;
+
+        try {
+
+            InitialContext c = new InitialContext();
+            DataSource jdbcFactory = (DataSource) c.lookup("java:/ENRIQUEFINANCIERODS");
+            conn = jdbcFactory.getConnection();
+
+            procedure = "{? = call DPRO.PCK_DELFIN_GENERALES.FUN_DIAS_HABILES(?,?,?)}";
+            cstm = conn.prepareCall(procedure);
+            cstm.registerOutParameter(1, java.sql.Types.INTEGER);
+            cstm.setString(2, fechaInicio);
+            cstm.setString(3, fechaFin);
+            cstm.setString(4, codigoAgencia);
+            cstm.execute();
+            diasHabiles = cstm.getInt(1);
+
+            procedure = "{? = call DPRO.PCK_DELFIN_GENERALES.FUN_TIEMPO_TRANS(?,?)}";
+            cstm = conn.prepareCall(procedure);
+            cstm.registerOutParameter(1, java.sql.Types.VARCHAR);
+            cstm.setString(2, horaInicio);
+            cstm.setString(3, horaFin);
+            cstm.execute();
+            horas_minutos = cstm.getString(1);
+
+        } catch (Exception e) {
+            throw e;
+        } finally {
+            try {
+                if (rs != null)
+                    rs.close();
+            } catch (Exception e) {
+                e.printStackTrace();
+            }
+            handlerRelease(conn, cstm);
+        }
+        return diasHabiles + " dias " + horas_minutos;
+    }
     // Fin [Req.17-022]
 
 }
diff --git a/DELFINWEBNEW/.classpath b/DELFINWEBNEW/.classpath
index 6c42886..0f38d04 100644
--- a/DELFINWEBNEW/.classpath
+++ b/DELFINWEBNEW/.classpath
@@ -1,35 +1,46 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<classpath>
-	<classpathentry kind="src" path="src"/>
-	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
-	<classpathentry kind="con" path="com.genuitec.eclipse.j2eedt.core.J2EE14_CONTAINER"/>
-	<classpathentry combineaccessrules="false" kind="src" path="/ADMINISTRATIVONEW"/>
-	<classpathentry combineaccessrules="false" kind="src" path="/FINANCIERONEW"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/JasperBabylon-1.0.0.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/barbecue-1.5-beta1.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/bsh-2.0b4.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-beanutils-1.7.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-codec-1.3.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-collections-2.1.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-dbcp-1.2.1.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-digester-1.7.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-fileupload-1.1.1.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-httpclient-3.1.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-io-1.3.1.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-javaflow-20060411.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-logging-1.0.2.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-logging-api-1.0.2.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-math-1.0.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-pool-1.3.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-vfs-1.0.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/iReport.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jakarta-bcel-20050813.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/poi-3.0.1-FINAL-20070705.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jsonplugin-0.34.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/itext-1.3.1.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jasperreports-3.0.0-applet.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jasperreports-3.0.0.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jasperreports-extensions-1.3.1.jar"/>
-	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jasperreports-flash-2.0.5.jar"/>
-	<classpathentry kind="output" path="WebRoot/WEB-INF/classes"/>
-</classpath>
+<?xml version="1.0" encoding="UTF-8"?>
+<classpath>
+	<classpathentry kind="src" path="src"/>
+	<classpathentry kind="con" path="com.genuitec.eclipse.j2eedt.core.J2EE14_CONTAINER"/>
+	<classpathentry combineaccessrules="false" kind="src" path="/ADMINISTRATIVONEW"/>
+	<classpathentry combineaccessrules="false" kind="src" path="/FINANCIERONEW"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/JasperBabylon-1.0.0.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/barbecue-1.5-beta1.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/bsh-2.0b4.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-beanutils-1.7.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-codec-1.3.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-collections-2.1.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-dbcp-1.2.1.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-digester-1.7.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-fileupload-1.1.1.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-httpclient-3.1.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-io-1.3.1.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-javaflow-20060411.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-logging-1.0.2.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-logging-api-1.0.2.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-math-1.0.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-pool-1.3.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/commons-vfs-1.0.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/iReport.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jakarta-bcel-20050813.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/poi-3.0.1-FINAL-20070705.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jsonplugin-0.34.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/itext-1.3.1.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jasperreports-3.0.0-applet.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jasperreports-3.0.0.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jasperreports-extensions-1.3.1.jar"/>
+	<classpathentry kind="lib" path="WebRoot/WEB-INF/lib/jasperreports-flash-2.0.5.jar"/>
+	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/jdk1.6.0_07">
+		<attributes>
+			<attribute name="owner.project.facets" value="java"/>
+		</attributes>
+	</classpathentry>
+	<classpathentry kind="con" path="org.eclipse.jst.server.core.container/org.jboss.ide.eclipse.as.core.server.runtime.runtimeTarget/JBoss 4.2 Runtime">
+		<attributes>
+			<attribute name="owner.project.facets" value="jst.web"/>
+		</attributes>
+	</classpathentry>
+	<classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.web.container"/>
+	<classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/>
+	<classpathentry kind="output" path="WebRoot/WEB-INF/classes"/>
+</classpath>
diff --git a/DELFINWEBNEW/.project b/DELFINWEBNEW/.project
index d6944cb..c2d3cd4 100644
--- a/DELFINWEBNEW/.project
+++ b/DELFINWEBNEW/.project
@@ -1,50 +1,58 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<projectDescription>
-	<name>DELFINWEBNEW</name>
-	<comment></comment>
-	<projects>
-	</projects>
-	<buildSpec>
-		<buildCommand>
-			<name>org.eclipse.wst.jsdt.core.javascriptValidator</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>com.genuitec.eclipse.j2eedt.core.WebClasspathBuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>org.eclipse.jdt.core.javabuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>com.genuitec.eclipse.j2eedt.core.J2EEProjectValidator</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>com.genuitec.eclipse.j2eedt.core.DeploymentDescriptorValidator</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>org.eclipse.wst.validation.validationbuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>com.genuitec.eclipse.ast.deploy.core.DeploymentBuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-	</buildSpec>
-	<natures>
-		<nature>com.genuitec.eclipse.ast.deploy.core.deploymentnature</nature>
-		<nature>com.genuitec.eclipse.j2eedt.core.webnature</nature>
-		<nature>org.eclipse.jdt.core.javanature</nature>
-		<nature>org.eclipse.wst.jsdt.core.jsNature</nature>
-	</natures>
-</projectDescription>
+<?xml version="1.0" encoding="UTF-8"?>
+<projectDescription>
+	<name>DELFINWEBNEW</name>
+	<comment></comment>
+	<projects>
+	</projects>
+	<buildSpec>
+		<buildCommand>
+			<name>org.eclipse.wst.common.project.facet.core.builder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.wst.jsdt.core.javascriptValidator</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>com.genuitec.eclipse.j2eedt.core.WebClasspathBuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.jdt.core.javabuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>com.genuitec.eclipse.j2eedt.core.J2EEProjectValidator</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>com.genuitec.eclipse.j2eedt.core.DeploymentDescriptorValidator</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.wst.validation.validationbuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>com.genuitec.eclipse.ast.deploy.core.DeploymentBuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+	</buildSpec>
+	<natures>
+		<nature>org.eclipse.jem.workbench.JavaEMFNature</nature>
+		<nature>org.eclipse.wst.common.modulecore.ModuleCoreNature</nature>
+		<nature>com.genuitec.eclipse.ast.deploy.core.deploymentnature</nature>
+		<nature>com.genuitec.eclipse.j2eedt.core.webnature</nature>
+		<nature>org.eclipse.jdt.core.javanature</nature>
+		<nature>org.eclipse.wst.jsdt.core.jsNature</nature>
+		<nature>org.eclipse.wst.common.project.facet.core.nature</nature>
+	</natures>
+</projectDescription>
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/WF_T_Contenedor_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/WF_T_Contenedor_CNTR.jsp
index 3684fa2..54830e4 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/WF_T_Contenedor_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/WF_T_Contenedor_CNTR.jsp
@@ -7,7 +7,8 @@
 <%@ taglib uri="/delfin" prefix="delfinTagHtml" %>
 <html>
   <head>
-    <title>WORKFLOW LEGAL</title>
+  	<%--kdelacruz [Req.S17-022] 19.04.2017--%>
+    <title>WORKFLOW</title>
     <link id="css" href="${pageContext.request.contextPath}/UTILS/css/DELFIN.css" rel="stylesheet" type="text/css">
     <script src="${pageContext.request.contextPath}/UTILS/Script/MsgValidacion.js"></script>
     <script src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Utiles.js"></script>
@@ -61,7 +62,9 @@
             if(event.keyCode == 505)
                 return false;
         }
-        document.onkeydown = keyDown;       
+        document.onkeydown = keyDown;
+        <%--kdelacruz [Req.S17-022] 19.04.2017--%>
+        document.oncontextmenu = function(){return false};
 
         function salir(){
             var url = '<c:out value="${requestScope.url}"/>';
@@ -224,7 +227,8 @@
       <table cellpadding="0" cellspacing="0" width="100%">
         <tr>
           <td class="tituloopcion">
-            DETALLE WORKFLOW LEGAL
+          <%--kdelacruz [Req.S17-022] 19.04.2017--%>
+            DETALLE WORKFLOW
           </td>
         </tr>
         <tr>
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/CR_C_ConsultaSeguimientoCartera_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/CR_C_ConsultaSeguimientoCartera_CNTR.jsp
index 68a6679..a8dd10d 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/CR_C_ConsultaSeguimientoCartera_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/CR_C_ConsultaSeguimientoCartera_CNTR.jsp
@@ -45,7 +45,58 @@
                 byID('descripcionAsesor').className = 'campodisplayiz';
                 byID('imgAsesor').style.visibility = "hidden";
             }
+            cargarPermisos();
+            
         }
+
+        function cargarPermisos(){
+            var tienePermisoAutorizarIndividual = consultarPermiso("WF_SEG_CAR_REG_IND");
+            if(!tienePermisoAutorizarIndividual){
+                byID('itMenu10').style.display = 'none';
+              }
+            var tienePermisoAutorizarMasivo = consultarPermiso("WF_SEG_CAR_REG_MAS");
+            if(!tienePermisoAutorizarMasivo){
+                byID('itMenu11').style.display = 'none';
+              }
+
+            if(!tienePermisoAutorizarIndividual && !tienePermisoAutorizarMasivo){
+                byID('spanRegistrar').style.display = 'none';
+            }
+            
+            var tienePermisoAtender = consultarPermiso("WF_SEG_CAR_ATE");
+            if(!tienePermisoAtender){
+              byID('spanAtencion').style.display = 'none';
+            }
+            var tienePermisoExportar = consultarPermiso("WF_SEG_CAR_EXP");
+            if(!tienePermisoExportar){
+              byID('spanExportar').style.display = 'none';
+            }
+        }
+
+        function consultarPermiso(codigo){
+            var params = '?identificadorMenuOpcion=' + codigo;
+            params += '&time=' + new Date().getTime();
+
+            var url = path + '/SS_C_ValidarPermisoMenuOpcion_Servlet' + params;
+            var tienePermiso = false;
+            ajaxRequest('GET', url, false, function() {
+              if (http_request.readyState == 4) {
+                if (http_request.status == 200) {
+                  var xmldoc = http_request.responseXML;
+                  var codigo = getValor(xmldoc, 'codigo');
+                  tienePermiso = (codigo == '1');
+                } else {
+                  alert(m_0105);
+                  tienePermiso = false;
+                }
+              }
+            });
+            return tienePermiso;
+          }
+
+          function getValor(xmldoc, campo) {
+            return xmldoc.getElementsByTagName(campo)[0].firstChild.nodeValue;
+          }
 
         function pag(direccion){
             document.ifrmDetalleWorkflowSeguimiento.paginacion(direccion);
@@ -95,8 +146,7 @@
             if(event.keyCode == 505)
                 return false;
         }
-        document.onkeydown = keyDown;       
-
+        document.onkeydown = keyDown;
         document.oncontextmenu = function(){return false}
 
         function salir(){
@@ -120,9 +170,11 @@
                   params += '&codigoCliente=' + byID('codigoCliente').value;
               }
               params += '&codigoEstado=' + byID('cboEstado').value;
+              params += '&codigoTipoProducto=' + byID('cboTipoProducto').value;
               if(pag){
                   params += '&hid_pagina=' + pag;
               }
+              params += '&time=' + (new Date()).getTime();
 
           var url = path + '/CR_C_ConsultaSeguimientoCartera_Servlet' + params;
           document.getElementById('hidepage').style.visibility = '';
@@ -132,17 +184,22 @@
         function limpiarFiltrosDetalle(){
             byID('fechaAsignacionInicial').value = '';
             byID('fechaAsignacionFinal').value = '';
+            if (permiteCambiarAgencia){
             byID('codigoAgencia').value = '';
             byID('descripcionAgencia').value = '';
+            }
             byID('cboEstado').value = '';
             byID('fechaAtencionInicial').value = '';
             byID('fechaAtencionFinal').value = '';
+            if (permiteCambiarAsesor){
             byID('codigoAsesor').value = '';
             byID('descripcionAsesor').value = '';
+            }
             byID('cboTipoAlerta').value = '';
             byID('codigoCliente').value = '';
             byID('numeroDocumento').value = '';
             byID('nombreCliente').value = '';
+            byID('cboTipoProducto').value = '';
         }
 
         function buscarPersonas() {
@@ -225,8 +282,13 @@
         }
 
         function modificarSolicitud(){
+            
             var idMaestra = document.ifrmDetalleWorkflowSeguimiento.obtenerIdMaestra();
             var correlativoSeguimiento = document.ifrmDetalleWorkflowSeguimiento.obtenerIdSeguimientoCartera();
+            if(isEmpty(idMaestra)){
+                alert(m_9120);
+                return;
+            }
             cargaIndividual(idMaestra, correlativoSeguimiento);
         }
 
@@ -252,6 +314,33 @@
             var attribs = 'dialogHeight:400px;dialogWidth:800px; center:yes; help:no; resizable:no; status:no';
             window.top.document.location.replace(url);
        }
+
+       function exportarBandeja(formatoReporte){
+           var params = '?action=REPORTE_BANDEJA_SEGUIMIENTO_CARTERA';
+           params += '&fechaAsignacionInicial=' + byID('fechaAsignacionInicial').value;
+           params += '&fechaAsignacionFinal=' + byID('fechaAsignacionFinal').value;
+           params += '&fechaAtencionInicial=' + byID('fechaAtencionInicial').value;
+           params += '&fechaAtencionFinal=' + byID('fechaAtencionFinal').value;
+           params += '&codigoTipoAlerta=' + byID('cboTipoAlerta').value;
+           if(!isEmpty(byID('descripcionAgencia').value)){
+               params += '&codigoAgencia=' + byID('codigoAgencia').value;
+           }
+           if(!isEmpty(byID('descripcionAsesor').value)){
+               params += '&codigoAsesor=' + byID('codigoAsesor').value;
+           }
+           if(!isEmpty(byID('nombreCliente').value)){
+               params += '&codigoCliente=' + byID('codigoCliente').value;
+           }
+           params += '&codigoEstado=' + byID('cboEstado').value;
+           params += '&codigoTipoProducto=' + byID('cboTipoProducto').value;
+           params += '&formatoReporte=' + formatoReporte;
+           params += '&time=' + (new Date()).getTime();
+
+           var prop = "dialogHeight:360px;dialogWidth:780px;center:yes;help:no;resizable:no;status:no";
+           url =  path +"/CR_C_ConsultaSeguimientoCartera_Servlet" + params;
+           window.open(url, "hojaResumen", prop);
+       }
+
     </script>
   </head>
   <body onhelp="getF1();" class="colorbody" onload="cargar();" style="padding: 0px, 0px, 0px, 0px;overflow:auto;">
@@ -267,7 +356,7 @@
       <table cellpadding="0" cellspacing="0" width="100%">
         <tr>
           <td class="tituloopcion">
-            DETALLE WORKFLOW LEGAL
+            DETALLE WORKFLOW SEGUIMIENTO CARTERA
           </td>
         </tr>
         <tr>
@@ -295,9 +384,25 @@
                                </div>
                            </div>
                         </span>
+                        <span id="spanRegistrar">
                         <delfinTagHtml:boton nombre="BT_Registrar.gif" onMouseOver="despMenu('itMenu1',1)" onMouseout="despMenu('itMenu1',0)"/>
+                        </span>
+                        <span id="spanAtencion">
                         <delfinTagHtml:boton nombre="BT_Atencion.gif" onclick="javascript:modificarSolicitud()"/>
-                        <delfinTagHtml:boton nombre="BT_Exportar_G.gif" onclick="javascript:modificarSolicitud()"/>
+                        </span>
+                        <span>
+                           <div id="itMenu2" style="width:30px; height:20px; top:26px; z-index:1;" class="itMenu" onMouseOver="despMenu(this.id,1)" onMouseOut="despMenu(this.id,0)" > 
+                               <div id="itMenu20" style="width: 30px" class="itMenuDes" onMouseOver="destacar(this,1)" onMouseOut="destacar(this,0)"> 
+                                   <a href="" target="_parent" class="itLink"><delfinTagHtml:boton nombre="BT_Pdf_P.gif" onclick="javascript:exportarBandeja('PDF');return false;" /></a>
+                               </div>
+                               <div id="itMenu21" style="width: 30px" class="itMenuDes" onMouseOver="destacar(this,1)" onMouseOut="destacar(this,0)"> 
+                                   <a href="" target="_parent" class="itLink"><delfinTagHtml:boton nombre="BT_Xls_P.gif" onclick="javascript:exportarBandeja('EXCEL');return false;" /></a> 
+                               </div>
+                           </div>
+                        </span>
+                        <span id="spanExportar">
+	                        <delfinTagHtml:boton nombre="BT_Exportar_G.gif" onMouseOver="despMenu('itMenu2',1)" onMouseout="despMenu('itMenu2',0)"/>
+                        </span>
                         <delfinTagHtml:boton nombre="BT_Salir.gif" onclick="javascript:salir();" />
                       </td>
                     </tr>
@@ -325,7 +430,7 @@
                         <td class="etiqueta" align="left" width="110" valign="middle">
                             Fecha Asignaci&oacute;n
                         </td>
-                        <td class="etiqueta" width="200">
+                        <td class="etiqueta" width="240">
                             del <input name="fechaAsignacionInicial" id="txtFechaAsignacionInicial" value="<c:out value='${fechaProcesoInicio}' />" style="width: 70px" class="campoobligatorioce"  tabindex="1" onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionInicial');" onfocus="this.select(); field='txtFechaAsignacionInicial'; nextfield ='txtFechaAsignacionFinal';">
                             al <input name="fechaAsignacionFinal" id="txtFechaAsignacionFinal" value="<c:out value='${fechaProcesoFin}' />" style="width: 70px" class="campoobligatorioce"  tabindex="1" onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionFinal');" onfocus="this.select(); field='fechaAsignacionFinal'; nextfield ='fechaAtencionInicial';">
                         </td>
@@ -342,7 +447,7 @@
                         </td>
                         <td > 
                             <select name="cboEstado" id="cboEstado" style="width: 120px;" tabindex="4" class="campoobligatorioiz"
-                                   onfocus="field='cboEstado'; nextfield ='fechaAsignacionInicial';">
+                                   onfocus="field='cboEstado'; nextfield ='cboTipoProducto';">
                                  <c:forEach var='listBeanWFEstado' items='${requestScope.listBeanWFEstado}'>
                                     <option value="<c:out value='${listBeanWFEstado.idEstado}'/>" >
                                         <c:out value='${listBeanWFEstado.descripcionEstado}' />
@@ -368,8 +473,17 @@
                             <img id="imgAsesor" style="cursor:hand" title="Buscar Asesor" src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif" onclick="buscarAsesor();">
                         </td>
                         <td class="etiqueta" align="left" valign="middle">
+                            Tipo Producto
                         </td>
                         <td > 
+                            <select name="cboTipoProducto" id="cboTipoProducto" style="width: 120px;" tabindex="4" class="campoobligatorioiz"
+                                   onfocus="field='cboEstado'; nextfield ='fechaAsignacionInicial';">
+                                 <c:forEach var='beanCombo' items='${requestScope.listTipoProducto}'>
+                                    <option value="<c:out value='${beanCombo.codigo}'/>" >
+                                        <c:out value='${beanCombo.descripcion}' />
+                                    </option>
+                                 </c:forEach>
+                            </select>
                         </td>
                       </tr>
                       <tr id="trFiltroActivos3"> 
@@ -377,7 +491,7 @@
                             Tipo de Alerta
                         </td>
                         <td>
-                           <select name="cboTipoAlerta" id="cboTipoAlerta" style="width: 150px;" tabindex="4" class="campoobligatorioiz"
+                           <select name="cboTipoAlerta" id="cboTipoAlerta" style="width: 230px;" tabindex="4" class="campoobligatorioiz"
                                    onfocus="field='cboTipoAlerta'; nextfield ='descripcionAgencia';">
                                  <c:forEach var='beanCombo' items='${requestScope.listTipoAlerta}'>
                                     <option value="<c:out value='${beanCombo.codigo}'/>" >
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/CR_C_ConsultaSeguimientoCartera_TABLA.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/CR_C_ConsultaSeguimientoCartera_TABLA.jsp
index a41f642..56a03a6 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/CR_C_ConsultaSeguimientoCartera_TABLA.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/CR_C_ConsultaSeguimientoCartera_TABLA.jsp
@@ -21,11 +21,11 @@
         .active-controls-grid {height: 100%; font: menu;}
 
                  .active-column-0  {display: none;}
-                 .active-column-1  {display: none;}
+                 .active-column-1  {width: 120px;text-align: left;}
                  .active-column-2  {width: 140px;text-align: left;}
                  .active-column-3  {width: 190px;text-align: left;}
                  .active-column-4  {width: 190px;text-align: left}
-                 .active-column-5  {width: 130px;text-align: left;}
+                 .active-column-5  {width: 150px;text-align: left;}
                  .active-column-6  {width: 110px;text-align: right;}
                  .active-column-7  {width: 90px;text-align: center;}
                  .active-column-8  {width: 90px;text-align: center;}
@@ -34,7 +34,7 @@
                  .active-column-11  {width: 120px;text-align: left;}
                  .active-column-12  {width: 90px;text-align: center;}
                  .active-column-13  {width: 120px;text-align: left;}
-                 
+                 .active-column-14  {width: 170px;text-align: left;}
 
         .active-grid-column {border-right: 1px solid threedlightshadow; }
         .active-grid-row {border-bottom: 1px solid threedlightshadow; }
@@ -55,8 +55,9 @@
                         ,"Estado" //9
                         ,"Fecha Ult. Act." //10
                         ,"Comentario Act."//11
-                        ,"Fecha Final" //12
-                        ,"Comentario Final"]; //13
+                        ,"Fecha Revisión GyS" //12
+                        ,"Comentario Revisión GyS" //13
+                        ,"Tiempo"]; //14
 
         //      create ActiveWidgets Grid javascript object
         var obj = new Active.Controls.Grid;
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraAdministracionLotes_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraAdministracionLotes_CNTR.jsp
index 36fcfd0..a6d94d6 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraAdministracionLotes_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraAdministracionLotes_CNTR.jsp
@@ -13,26 +13,69 @@
 <head>
 <title>ADMINISTRACION DE LOTES</title>
 <link id="css"
-	href="${pageContext.request.contextPath}/UTILS/css/DELFIN.css"
-	rel="stylesheet" type="text/css">
+    href="${pageContext.request.contextPath}/UTILS/css/DELFIN.css"
+    rel="stylesheet" type="text/css">
 <script
-	src="${pageContext.request.contextPath}/UTILS/Script/MsgValidacion.js"></script>
+    src="${pageContext.request.contextPath}/UTILS/Script/MsgValidacion.js"></script>
 <script
-	src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Utiles.js"></script>
+    src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Utiles.js"></script>
 <script type="text/javascript">
 
     var operacionEnProceso;
     var path;
+    var f = null;
 
-	    function cargar() {
-	        operacionEnProceso = false;
+        function cargar() {
+            operacionEnProceso = false;
             f = document.getElementById('frmBusqueda');
             path = '<%=request.getContextPath()%>';
         mensajeRespuesta('<c:out value="${codigoError}" />', '<c:out value="${mensajeError}" />');
         onCargarTabla();
+        cargarPermisos();
     }
 
+    function cargarPermisos(){
+    	var tienePermisoAutorizar = consultarPermiso("WF_SEG_CAR_AUT");
+        if(!tienePermisoAutorizar){
+          byID('spanAutorizar').style.display = 'none';
+        }
+        var tienePermisoDetalle = consultarPermiso("WF_SEG_CAR_DET");
+        if(!tienePermisoDetalle){
+          byID('spanDetalle').style.display = 'none';
+        }
+        var tienePermisoCarga = consultarPermiso("WF_SEG_CAR_CLT");
+        if(!tienePermisoCarga){
+          byID('spanCargarLote').style.display = 'none';
+        }
+    }
+
+    function consultarPermiso(codigo){
+       var params = '?identificadorMenuOpcion=' + codigo;
+       params += '&time=' + new Date().getTime();
+
+       var url = path + '/SS_C_ValidarPermisoMenuOpcion_Servlet' + params;
+       var tienePermiso = false;
+       ajaxRequest('GET', url, false, function() {
+         if (http_request.readyState == 4) {
+           if (http_request.status == 200) {
+             var xmldoc = http_request.responseXML;
+             var codigo = getValor(xmldoc, 'codigo');
+             tienePermiso = (codigo == '1');
+           } else {
+             alert(m_0105);
+             tienePermiso = false;
+           }
+         }
+       });
+       return tienePermiso;
+     }
+
+     function getValor(xmldoc, campo) {
+       return xmldoc.getElementsByTagName(campo)[0].firstChild.nodeValue;
+     }
+
     function cargarLotes() {
+        
         var params = '?action=MOSTRAR_CONTENEDOR';
             params += '&time=' + (new Date()).getTime();
         var url = path + '/CR_T_SeguimientoCarteraCargaAlerta_Servlet' + params;
@@ -41,6 +84,7 @@
     }
 
     function detalleCarga() {
+        
         var idLote = document.ifrmDetalleWorkflowSeguimiento.obtenerIdLote();
         if (isEmpty(idLote)) {
             return;
@@ -48,7 +92,7 @@
         var params = '?action=MOSTRAR_CONTENEDOR';
         params += '&idLote=' + idLote;
         var url = path + '/CR_T_SeguimientoCarteraDetalleCarga_Servlet' + params;
-        var attribs = 'dialogHeight:600px;dialogWidth:900px; center:yes; help:no; resizable:no; status:no';
+        var attribs = 'dialogHeight:530px;dialogWidth:900px; center:yes; help:no; resizable:no; status:no';
         window.showModalDialog(url, window, attribs);
     }
 
@@ -128,10 +172,10 @@
         }
         var params = serializeForm(byID('frmAdministracion'));
             params = '&action=CAMBIAR_ESTADO';
-	        params += '&idLote=' + document.ifrmDetalleWorkflowSeguimiento.obtenerIdLote();
-	        params += '&estadoCambiaLote=' + CodigoEstadoLote;
-	        params += '&time=' + new Date().getTime();
-	        var url = path + '/CR_T_SeguimientoCarteraAdministracionLotes_Servlet';
+            params += '&idLote=' + document.ifrmDetalleWorkflowSeguimiento.obtenerIdLote();
+            params += '&estadoCambiaLote=' + CodigoEstadoLote;
+            params += '&time=' + new Date().getTime();
+            var url = path + '/CR_T_SeguimientoCarteraAdministracionLotes_Servlet';
 
         operacionEnProceso = true;
         ajaxRequestPOST(url, params, false, function(xmldoc) {
@@ -144,199 +188,203 @@
 </script>
 </head>
 <body onhelp="getF1();" class="colorbody" onload="cargar();"
-	style="padding: 0px, 0px, 0px, 0px; overflow: auto;">
-	<form name="frmAdministracion" id="frmAdministracion" method="post">
-		<input type="hidden" name="hidNumeroDocumento"> <input
-			type="hidden" name="usuarioSolicitante"> <input type="hidden"
-			name="usuarioLegal"> <input type="hidden" name="hidIdModulo"
-			value='<%=idModulo%>'>
-		<div id="hidepage"
-			style="position: absolute; left: 400px; top: 280px; width: 100; height: 20">
-			<table>
-				<tr>
-					<td align="center"><img
-						src="<%=request.getContextPath()%>/UTILS/img/loadings.gif"></td>
-				</tr>
-				<tr>
-					<td align="center" style="font-weight: bold;"><span
-						class="etiqueta">Cargando...</span></td>
-				</tr>
-			</table>
-		</div>
-		<div id="wndHide"></div>
-		<table cellpadding="0" cellspacing="0" width="100%">
-			<tr>
-				<td class="tituloopcion">ADMINISTRACION DE LOTES - SEGUIMIENTO
-					DE CARTERA</td>
-			</tr>
-			<tr>
-				<td height="4"><img
-					src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
-					height="2"></td>
-			</tr>
-		</table>
-		<!-- tabla inicio -->
+    style="padding: 0px, 0px, 0px, 0px; overflow: auto;">
+    <form name="frmAdministracion" id="frmAdministracion" method="post">
+        <input type="hidden" name="hidNumeroDocumento"> <input
+            type="hidden" name="usuarioSolicitante"> <input type="hidden"
+            name="usuarioLegal"> <input type="hidden" name="hidIdModulo"
+            value='<%=idModulo%>'>
+        <div id="hidepage"
+            style="position: absolute; left: 400px; top: 280px; width: 100; height: 20">
+            <table>
+                <tr>
+                    <td align="center"><img
+                        src="<%=request.getContextPath()%>/UTILS/img/loadings.gif"></td>
+                </tr>
+                <tr>
+                    <td align="center" style="font-weight: bold;"><span
+                        class="etiqueta">Cargando...</span></td>
+                </tr>
+            </table>
+        </div>
+        <div id="wndHide"></div>
+        <table cellpadding="0" cellspacing="0" width="100%">
+            <tr>
+                <td class="tituloopcion">ADMINISTRACION DE LOTES</td>
+            </tr>
+            <tr>
+                <td height="4"><img
+                    src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
+                    height="2"></td>
+            </tr>
+        </table>
+        <!-- tabla inicio -->
 
-		<table border="0" cellpadding="0" cellspacing="2" width="99.5%"
-			align="center">
-			<tr>
-				<td>
-					<table border="1" cellpadding="0" cellspacing="0" width="100%"
-						align="center" class="frame">
-						<tr>
-							<td height="20" align="center">
-								<table width="100%" cellpadding="0" cellspacing="0" border="0">
-									<tr>
-										<td align="left" colspan="4" valign="middle"><span>
-												<div id="itMenu1"
-													style="width: 30px; height: 20px; top: 26px; z-index: 1;"
-													class="itMenu" onMouseOver="despMenu(this.id,1)"
-													onMouseOut="despMenu(this.id,0)">
-													<div id="itMenu10" style="width: 30px" class="itMenuDes"
-														onMouseOver="destacar(this,1)"
-														onMouseOut="destacar(this,0)">
-														<a href="" target="_parent" class="itLink"><delfinTagHtml:boton
-																nombre="BT_Aprobar_P.gif"
-																onclick="javascript:aprobarLote();" /></a>
-													</div>
-													<div id="itMenu11" style="width: 30px" class="itMenuDes"
-														onMouseOver="destacar(this,1)"
-														onMouseOut="destacar(this,0)">
-														<a href="" target="_parent" class="itLink"><delfinTagHtml:boton
-																nombre="BT_Rechazar_P.gif"
-																onclick="javascript:rechazarLote();" /></a>
-													</div>
-												</div>
-										</span> <delfinTagHtml:boton
-												nombre="BT_AutorizarLotesSeguimiento.gif"
-												onMouseOver="despMenu('itMenu1',1)"
-												onMouseout="despMenu('itMenu1',0)" /> <delfinTagHtml:boton
-												nombre="BT_DetalleLotesSeguimiento.gif"
-												onclick="javascript:detalleCarga()" /> <delfinTagHtml:boton
-												nombre="BT_CargarLotesSeguimiento.gif"
-												onclick="javascript:cargarLotes()" /> <delfinTagHtml:boton
-												nombre="BT_Salir.gif" onclick="javascript:salir();" /></td>
-									</tr>
-								</table>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-			<tr>
-				<td height="4"><img
-					src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
-					height="2"></td>
-			</tr>
-			<tr>
-				<td class="tituloframe">FILTROS DE BUSQUEDA</td>
-			</tr>
-			<tr>
-				<td>
-					<table border="2" cellpadding="0" cellspacing="0" width="100%"
-						align="center" class="frame">
-						<tr>
-							<td height="20" align="center">
-								<table width="99%" cellpadding="0" cellspacing="2" border="0">
-									<tr id="trFiltroActivos1">
-										<td class="etiqueta" align="left" width="110" valign="middle">
-											Fecha Proceso</td>
-										<td class="etiqueta" width="200">del <input
-											name="fechaAsignacionInicial" id="txtFechaAsignacionInicial"
-											value="<c:out value='${requestScope.fechaProcesoInicio}' />" style="width: 70px"
-											class="campoobligatorioce" tabindex="1"
-											onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionInicial');"
-											onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='txtFechaAsignacionFinal';">
-											al <input name="fechaAsignacionFinal"
-											id="txtFechaAsignacionFinal"
-											value="<c:out value='${requestScope.fechaProcesoFin}' />" style="width: 70px"
-											class="campoobligatorioce" tabindex="1"
-											onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionFinal');"
-											onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='cboEstado';">
-										</td>
-										<td class="etiqueta" align="left" width="130" valign="middle">
-											Estado Lote</td>
-										<td><select name="cboEstado" id="cboEstado"
-											style="width: 120px;" tabindex="4" class="campoobligatorioiz"
-											onfocus="field='cboEstado'; nextfield ='descripcionSolicitante';">
-												<c:forEach var='beanCombo'
-													items='${requestScope.listBeanEstado}'>
-													<option value="<c:out value='${beanCombo.codigo}'/>">
-														<c:out value='${beanCombo.descripcion}' />
-													</option>
-												</c:forEach>
-										</select></td>
-										<td><delfinTagHtml:boton nombre="BT_Buscar_P.gif"
-												onclick="javascript:onCargarTabla();" /></td>
-									</tr>
-								</table>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-			<tr>
-				<td height="4"><img
-					src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
-					height="2"></td>
-			</tr>
-			<tr>
-				<td>
-					<table cellpadding="0" border="0" cellspacing="0" width="100%"
-						align="center">
-						<tr>
-							<td align="center" valign="top" width="100%">
-								<table width="100%" align="center" cellspacing="0" border="0">
-									<tr>
-										<td valign="top">
-											<table width="100%" cellpadding="0" cellspacing="0"
-												border="0">
-												<tr>
-													<td class="tituloframe">LOTES CARGADOS</td>
-												</tr>
-												<tr>
-													<td>
+        <table border="0" cellpadding="0" cellspacing="2" width="99.5%"
+            align="center">
+            <tr>
+                <td>
+                    <table border="1" cellpadding="0" cellspacing="0" width="100%"
+                        align="center" class="frame">
+                        <tr>
+                            <td height="20" align="center">
+                                <table width="100%" cellpadding="0" cellspacing="0" border="0">
+                                    <tr>
+                                        <td align="left" colspan="4" valign="middle">
+                                            <span>
+                                                <div id="itMenu1"
+                                                    style="width: 30px; height: 20px; top: 26px; z-index: 1;"
+                                                    class="itMenu" onMouseOver="despMenu(this.id,1)"
+                                                    onMouseOut="despMenu(this.id,0)">
+                                                    <div id="itMenu10" style="width: 30px" class="itMenuDes"
+                                                        onMouseOver="destacar(this,1)"
+                                                        onMouseOut="destacar(this,0)">
+                                                        <a href="" target="_parent" class="itLink"><delfinTagHtml:boton
+                                                                nombre="BT_Aprobar_P.gif"
+                                                                onclick="javascript:aprobarLote();" /></a>
+                                                    </div>
+                                                    <div id="itMenu11" style="width: 30px" class="itMenuDes"
+                                                        onMouseOver="destacar(this,1)"
+                                                        onMouseOut="destacar(this,0)">
+                                                        <a href="" target="_parent" class="itLink"><delfinTagHtml:boton
+                                                                nombre="BT_Rechazar_P.gif"
+                                                                onclick="javascript:rechazarLote();" /></a>
+                                                    </div>
+                                                </div>
+                                           </span>
+                                            
+                                           <span id="spanAutorizar">
+                                                <delfinTagHtml:boton nombre="BT_AutorizarLotesSeguimiento.gif" onMouseOver="despMenu('itMenu1',1)" onMouseout="despMenu('itMenu1',0)" />
+                                           </span>
+                                           <span  id="spanDetalle">
+                                                <delfinTagHtml:boton nombre="BT_DetalleLotesSeguimiento.gif" onclick="javascript:detalleCarga()" /> 
+                                           </span>
+                                           <span id="spanCargarLote">
+                                                <delfinTagHtml:boton nombre="BT_CargarLotesSeguimiento.gif" onclick="javascript:cargarLotes()" /> 
+                                           </span>
+                                           <delfinTagHtml:boton nombre="BT_Salir.gif" onclick="javascript:salir();" />
+                                       </td>
+                                    </tr>
+                                </table>
+                            </td>
+                        </tr>
+                    </table>
+                </td>
+            </tr>
+            <tr>
+                <td height="4"><img
+                    src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
+                    height="2"></td>
+            </tr>
+            <tr>
+                <td class="tituloframe">FILTROS DE BUSQUEDA</td>
+            </tr>
+            <tr>
+                <td>
+                    <table border="2" cellpadding="0" cellspacing="0" width="100%"
+                        align="center" class="frame">
+                        <tr>
+                            <td height="20" align="center">
+                                <table width="99%" cellpadding="0" cellspacing="2" border="0">
+                                    <tr id="trFiltroActivos1">
+                                        <td class="etiqueta" align="left" width="110" valign="middle">
+                                            Fecha Proceso</td>
+                                        <td class="etiqueta" width="200">del <input
+                                            name="fechaAsignacionInicial" id="txtFechaAsignacionInicial"
+                                            value="<c:out value='${requestScope.fechaProcesoInicio}' />"
+                                            style="width: 70px" class="campoobligatorioce" tabindex="1"
+                                            onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionInicial');"
+                                            onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='txtFechaAsignacionFinal';">
+                                            al <input name="fechaAsignacionFinal"
+                                            id="txtFechaAsignacionFinal"
+                                            value="<c:out value='${requestScope.fechaProcesoFin}' />"
+                                            style="width: 70px" class="campoobligatorioce" tabindex="1"
+                                            onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionFinal');"
+                                            onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='cboEstado';">
+                                        </td>
+                                        <td class="etiqueta" align="left" width="130" valign="middle">
+                                            Estado Lote</td>
+                                        <td><select name="cboEstado" id="cboEstado"
+                                            style="width: 120px;" tabindex="4" class="campoobligatorioiz"
+                                            onfocus="field='cboEstado'; nextfield ='descripcionSolicitante';">
+                                                <c:forEach var='beanCombo'
+                                                    items='${requestScope.listBeanEstado}'>
+                                                    <option value="<c:out value='${beanCombo.codigo}'/>">
+                                                        <c:out value='${beanCombo.descripcion}' />
+                                                    </option>
+                                                </c:forEach>
+                                        </select></td>
+                                        <td><delfinTagHtml:boton nombre="BT_Buscar_P.gif"
+                                                onclick="javascript:onCargarTabla();" /></td>
+                                    </tr>
+                                </table>
+                            </td>
+                        </tr>
+                    </table>
+                </td>
+            </tr>
+            <tr>
+                <td height="4"><img
+                    src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
+                    height="2"></td>
+            </tr>
+            <tr>
+                <td>
+                    <table cellpadding="0" border="0" cellspacing="0" width="100%"
+                        align="center">
+                        <tr>
+                            <td align="center" valign="top" width="100%">
+                                <table width="100%" align="center" cellspacing="0" border="0">
+                                    <tr>
+                                        <td valign="top">
+                                            <table width="100%" cellpadding="0" cellspacing="0"
+                                                border="0">
+                                                <tr>
+                                                    <td class="tituloframe">LOTES CARGADOS</td>
+                                                </tr>
+                                                <tr>
+                                                    <td>
                                                         <iframe id="ifrmDetalleWorkflowSeguimiento" name="ifrmDetalleWorkflowSeguimiento" frameborder="0" width="100%" height="300px"  class="frame"></iframe>
-													</td>
-												</tr>
-											</table>
-										</td>
-									</tr>
-								</table>
-								<table width="100%">
-									<tr>
-										<td align="right"><IMG
-											src="<%=request.getContextPath()%>/UTILS/img/PagRe.gif"
-											onClick="pag(-1);"
-											style="CURSOR: hand; vertical-align: middle;" alt="Anterior">
-											<label id="inicial"
-											style="width: 25; text-align: left; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
-											<IMG src="<%=request.getContextPath()%>/UTILS/img/t.gif"
-											height=1 width="10"> <label id="final"
-											style="width: 25; text-align: right; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
-											<IMG src="<%=request.getContextPath()%>/UTILS/img/PagAv.gif"
-											onClick="pag(1)"
-											style="CURSOR: hand; vertical-align: middle;" alt="Siguiente">
-											<label id="total"
-											style="width: 50; text-align: left; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
-										</td>
-									</tr>
-								</table>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-		</table>
+                                                    </td>
+                                                </tr>
+                                            </table>
+                                        </td>
+                                    </tr>
+                                </table>
+                                <table width="100%">
+                                    <tr>
+                                        <td align="right"><IMG
+                                            src="<%=request.getContextPath()%>/UTILS/img/PagRe.gif"
+                                            onClick="pag(-1);"
+                                            style="CURSOR: hand; vertical-align: middle;" alt="Anterior">
+                                            <label id="inicial"
+                                            style="width: 25; text-align: left; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
+                                            <IMG src="<%=request.getContextPath()%>/UTILS/img/t.gif"
+                                            height=1 width="10"> <label id="final"
+                                            style="width: 25; text-align: right; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
+                                            <IMG src="<%=request.getContextPath()%>/UTILS/img/PagAv.gif"
+                                            onClick="pag(1)"
+                                            style="CURSOR: hand; vertical-align: middle;" alt="Siguiente">
+                                            <label id="total"
+                                            style="width: 50; text-align: left; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
+                                        </td>
+                                    </tr>
+                                </table>
+                            </td>
+                        </tr>
+                    </table>
+                </td>
+            </tr>
+        </table>
 
-		<!-- tabla final -->
-		<table cellpadding="0" cellspacing="0" border="0" width="100%">
-			<tr>
-				<td><%@ include file="/GENERAL/Header.jsp"%>
-				</td>
-			</tr>
-			<tr height="40px"></tr>
-		</table>
-	</form>
+        <!-- tabla final -->
+        <table cellpadding="0" cellspacing="0" border="0" width="100%">
+            <tr>
+                <td><%@ include file="/GENERAL/Header.jsp"%>
+                </td>
+            </tr>
+            <tr height="40px"></tr>
+        </table>
+    </form>
 </body>
 </html>
\ No newline at end of file
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraAdministracionLotes_TABLA.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraAdministracionLotes_TABLA.jsp
index c24d426..4c2fca4 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraAdministracionLotes_TABLA.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraAdministracionLotes_TABLA.jsp
@@ -51,8 +51,8 @@
 	        var myData = [<c:out value="${myData}" escapeXml="false"/>];
 	
 	        var myColumns = ["Id Lote",//0
-	             	         "Fecha de Asignaci�n",//1
-	             	         "Hora",//1
+	             	         "Fecha Carga",//1
+	             	         "Hora Carga",//1
 	                         "Usuario Registro",//2
 	                         "Nombre Usuario Registro",//3
                              "Usuario Estado",//4
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraCargaAlerta_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraCargaAlerta_CNTR.jsp
index 333c9b6..5388039 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraCargaAlerta_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraCargaAlerta_CNTR.jsp
@@ -1,4 +1,4 @@
-<!-- CR-T-CargaAlertaSeguimientoCartera_CNTR.jsp -->
+<!-- CR-T-SeguimientoCarteraCargaAlerta_CNTR.jsp -->
 <%-- [S17-022] rsanchez 24.03.2017 --%>
 
 <%@ taglib uri="/delfin" prefix="delfinTagHtml"%>
@@ -9,7 +9,7 @@
 <head>
     <META HTTP-EQUIV="Pragma" CONTENT="no-cache" />
     <!-- Titulo del M�dulo -->
-    <title>Carga Alerta</title>
+    <title>CARGA ALERTA MASIVA</title>
     <!-- Invocaci�n de Estilos -->
     <link id="css" href="<%=request.getContextPath()%>/UTILS/css/DELFIN.css" rel="stylesheet" type="text/css">
     <!-- Invocaci�n de Java Scripts -->
@@ -108,7 +108,7 @@
         <table cellpadding="0" cellspacing="0" width="100%">
 	        <tr>
 	          <td class="tituloopcion">
-	            SEGUIMIENTO DE CARTERA - CARGA ALERTA
+	            CARGA ALERTA MASIVA
 	          </td>
 	        </tr>
 	        <tr>
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraDetalleCarga_CHILD.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraDetalleCarga_CHILD.jsp
index 272e724..8c1c36f 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraDetalleCarga_CHILD.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR-T-SeguimientoCarteraDetalleCarga_CHILD.jsp
@@ -10,51 +10,139 @@
 %>
 <html>
 <head>
-<title>DETALLE CARGA DE LOTE</title>
+<title>DETALLE DE LOTE</title>
 <link id="css"
-	href="${pageContext.request.contextPath}/UTILS/css/DELFIN.css"
-	rel="stylesheet" type="text/css">
+    href="${pageContext.request.contextPath}/UTILS/css/DELFIN.css"
+    rel="stylesheet" type="text/css">
 <script
-	src="${pageContext.request.contextPath}/UTILS/Script/MsgValidacion.js"></script>
+    src="${pageContext.request.contextPath}/UTILS/Script/MsgValidacion.js"></script>
 <script
-	src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Utiles.js"></script>
+    src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Utiles.js"></script>
 <script type="text/javascript">
     var f = null;
     var path;
     field = "";
+    nextfield = "fechaAsignacionInicial";
 
     function onLoad() {
         f = document.getElementById('frmBusqueda');
         path = '<%=request.getContextPath()%>';
         document.getElementById('hidepage').style.visibility = '';
-        onCargarDetalle();
+        onCargarTabla();
     }
 
-    function onCargarDetalle() {
+    function onCargarTabla(pag) {
         var params = '?action=CARGAR_DETALLE';
-            params += '&fechaAsignacionInicial=' + byID('fechaAsignacionInicial').value;
-            params += '&fechaAsignacionFinal=' + byID('fechaAsignacionFinal').value;
-            params += '&fechaAtencionInicial=' + byID('fechaAtencionInicial').value;
-            params += '&fechaAtencionFinal=' + byID('fechaAtencionFinal').value;
-            params += '&codigoTipoAlerta=' + byID('cboTipoAlerta').value;
-            if(!isEmpty(byID('descripcionAgencia').value)){
-                params += '&codigoAgencia=' + byID('codigoAgencia').value;
-            }
-            if(!isEmpty(byID('descripcionAsesor').value)){
-                params += '&codigoAsesor=' + byID('codigoAsesor').value;
-            }
-            if(!isEmpty(byID('nombreCliente').value)){
-                params += '&codigoCliente=' + byID('codigoCliente').value;
-            }
-            
+        params += '&fechaAsignacionInicial=' + byID('fechaAsignacionInicial').value;
+        params += '&fechaAsignacionFinal=' + byID('fechaAsignacionFinal').value;
+        params += '&fechaAtencionInicial=' + byID('fechaAtencionInicial').value;
+        params += '&fechaAtencionFinal=' + byID('fechaAtencionFinal').value;
+        params += '&codigoTipoAlerta=' + byID('cboTipoAlerta').value;
+        params += '&idLote=' + byID('idLote').value;
+        if (!isEmpty(byID('descripcionAgencia').value)) {
+            params += '&codigoAgencia=' + byID('codigoAgencia').value;
+        }
+        if (!isEmpty(byID('descripcionAsesor').value)) {
+            params += '&codigoAsesor=' + byID('codigoAsesor').value;
+        }
+        if (!isEmpty(byID('nombreCliente').value)) {
+            params += '&codigoCliente=' + byID('codigoCliente').value;
+        }
+        if(pag){
+            params += '&hid_pagina=' + pag;
+        }
         var url = path + '/CR_T_SeguimientoCarteraDetalleCarga_Servlet' + params;
         document.getElementById('hidepage').style.visibility = '';
-        document.ifrmDetalleWorkflow.location.replace(url);
-      }
-
-    function pag(direccion) {
-        document.ifrmDetalleWorkflowSeguimiento.paginacion(direccion);
+        document.ifrmGrillaDetalle.location.replace(url);
     }
+
+    function pag(direccion){
+        document.ifrmGrillaDetalle.paginacion(direccion);
+    }
+    document.onkeydown = keyDown;
+    function keyDown(DnEvents){
+        k = window.event.keyCode;
+        if (k == 13){
+        	if(nextfield == "txtFechaAsignacionInicial"){
+        		buscarPersonas();
+        		eval('document.forms[0].' + nextfield + '.focus()');
+        	    return false;
+        	}
+        	if(nextfield == "txtFechaAsignacionFinal"){
+        		eval('document.forms[0].' + nextfield + '.focus()');
+        	    return false;
+        	}
+        	if(nextfield == "txtFechaAtencionInicial"){
+        		eval('document.forms[0].' + nextfield + '.focus()');
+        	     return false;
+        	}
+        	if(nextfield == "txtFechaAtencionFinal"){
+        		eval('document.forms[0].' + nextfield + '.focus()');
+        	     return false;
+        	}
+        	if(nextfield == "cboTipoAlerta"){
+        		eval('document.forms[0].' + nextfield + '.focus()');
+        	     return false;
+        	}
+        	if(nextfield == "descripcionAgencia"){
+        		eval('document.forms[0].' + nextfield + '.focus()');
+        	     return false;
+        	}
+        	if(nextfield == "descripcionAsesor"){
+        		buscarAgencia();
+        		eval('document.forms[0].' + nextfield + '.focus()');
+        	    return false;
+        	}
+        	if(nextfield == "nombreCliente"){
+        		buscarAsesor();
+        		eval('document.forms[0].' + nextfield + '.focus()');
+        	    return false;
+        	}
+            return false;
+        }
+        if (k == 120){
+            return false;
+        }
+        if (k == 27){
+            salir();
+            return false;
+        }
+        if (k == 121){
+            grabar()
+            return false;
+        }
+        if (k == 112){
+            ayuda();
+            return false;
+        }
+        if (event.ctrlKey){
+            event.keyCode = 0;
+            return false;
+        }
+        if (k==46){
+            return false;
+        }
+        if (window.event && (k == 114 || k == 116 || k == 117 || k == 122))
+            event.keyCode = 505;
+        if(event.keyCode == 505)
+            return false;
+    }
+
+    function insertarUsuario(data, indicador){
+        byID('codigoAsesor').value = data[0];
+        byID('descripcionAsesor').value = data[1];
+    }
+
+    function insertarPersona(data) {
+        byID('codigoCliente').value = data[0];
+        byID('numeroDocumento').value = data[1];
+        byID('nombreCliente').value = data[2];
+    }
+    
+    function insertarAgencia(data){
+        byID('codigoAgencia').value = data[0];
+        byID('descripcionAgencia').value = data[1];
+     }
 
     function buscarAgencia() {
         var nombre = "AGENCIA";
@@ -112,258 +200,249 @@
 </script>
 </head>
 <body class="colorbody" onload="onLoad();">
-	<form name="frmBusqueda" id="frmBusqueda" method="post">
-		<input type="hidden" name="hidNumeroDocumento"> <input
-			type="hidden" name="usuarioSolicitante"> <input type="hidden"
-			name="usuarioLegal"> <input type="hidden" name="hidIdModulo"
-			value='<%=idModulo%>'>
-		<div id="hidepage"
-			style="position: absolute; left: 460px; top: 200px; width: 100; height: 20">
-			<table>
-				<tr>
-					<td align="center"><img
-						src="<%=request.getContextPath()%>/UTILS/img/loadings.gif"></td>
-				</tr>
-				<tr>
-					<td align="center" style="font-weight: bold;"><span
-						class="etiqueta">Cargando...</span></td>
-				</tr>
-			</table>
-		</div>
-		<div id="wndHide"></div>
-		<table cellpadding="0" cellspacing="0" width="100%">
-			<tr>
-				<td class="tituloopcion">DETALLE DE LOTE - SEGUIMIENTO DE
-					CARTERA
-			</tr>
-			<tr>
-				<td height="4"><img
-					src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
-					height="2"></td>
-			</tr>
-		</table>
-		<table border="0" cellpadding="0" cellspacing="2" width="99.5%"
-			align="center">
-			<tr>
-				<td>
-					<table border="1" cellpadding="0" cellspacing="0" width="100%"
-						align="center" class="frame">
-						<tr>
-							<td height="20" align="center">
-								<table width="100%" cellpadding="0" cellspacing="0" border="0">
-									<tr>
-										<td align="left" colspan="4" valign="middle"><span>
-												<div id="itMenu1"
-													style="width: 30px; height: 20px; top: 26px; z-index: 1;"
-													class="itMenu" onMouseOver="despMenu(this.id,1)"
-													onMouseOut="despMenu(this.id,0)">
-													<div id="itMenu10" style="width: 30px" class="itMenuDes"
-														onMouseOver="destacar(this,1)"
-														onMouseOut="destacar(this,0)">
-														<a href="" target="_parent" class="itLink"><delfinTagHtml:boton
-																nombre="BT_Individual.gif"
-																onclick="javascript:generarReporte('PDF');return false;" /></a>
-													</div>
-													<div id="itMenu11" style="width: 30px" class="itMenuDes"
-														onMouseOver="destacar(this,1)"
-														onMouseOut="destacar(this,0)">
-														<a href="" target="_parent" class="itLink"><delfinTagHtml:boton
-																nombre="BT_Masivo.gif"
-																onclick="javascript:generarReporte('EXCEL');return false;" /></a>
-													</div>
-												</div>
-										</span> <delfinTagHtml:boton nombre="BT_Salir.gif"
-												onclick="javascript:salir();" /></td>
-									</tr>
-								</table>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-			<tr>
-				<td height="4"><img
-					src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
-					height="2"></td>
-			</tr>
-			<tr>
-				<td class="tituloframe">FILTROS DE BUSQUEDA</td>
-			</tr>
-			<tr>
-				<td>
-					<table border="0" cellpadding="0" cellspacing="0" width="100%"
-						align="center" class="frame">
-						<tr>
-							<td height="20" align="center">
-								<table width="99%" cellpadding="0" cellspacing="2" border="0">
-									<tr id="trFiltroActivos1">
-										<td class="etiqueta" align="left" width="110" valign="middle">
-											Fecha Asignaci&oacute;n</td>
-										<td class="etiqueta" width="200">del <input
-											name="fechaAsignacionInicial" id="txtFechaAsignacionInicial"
-											value="<c:out value='${fechaProceso}' />" style="width: 70px"
-											class="campoobligatorioce" tabindex="1"
-											onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionInicial');"
-											onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='cboEstado';">
-											al <input name="fechaAsignacionFinal"
-											id="txtFechaAsignacionFinal"
-											value="<c:out value='${fechaProceso}' />" style="width: 70px"
-											class="campoobligatorioce" tabindex="1"
-											onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionFinal');"
-											onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='cboEstado';">
-										</td>
-										<td class="etiqueta" align="left" width="60" valign="middle">
-											Agencia</td>
-										<td width="200"><input type="hidden" name="codigoAgencia"
-											id="codigoAgencia" value="<c:out value='${codigoAgencia}' />"
-											style="width: 80px" class="campoobligatorioiz" tabindex="1"
-											onfocus="this.select(); field='txtCriterio'; nextfield ='txtFechaSolicitud';">
-											<input name="descripcionAgencia" id="descripcionAgencia"
-											value="<c:out value='${descripcionAgencia}' />"
-											style="width: 160px" class="campoobligatorioiz" tabindex="1"
-											onfocus="this.select(); field='txtCriterio'; nextfield ='txtFechaSolicitud';">
-											<img id="imgAgencia" style="cursor: hand"
-											title="Buscar Agencia"
-											src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif"
-											onclick="buscarAgencia();"></td>
-									</tr>
-									<tr id="trFiltroActivos2">
-										<td class="etiqueta" align="left" valign="middle">Fecha
-											Atenci&oacute;n</td>
-										<td class="etiqueta">del <input
-											name="fechaAtencionInicial" id="txtFechaAsignacionInicial"
-											value="<c:out value='${fechaProceso}' />" style="width: 70px"
-											class="campoobligatorioce" tabindex="1"
-											onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAtencionInicial');"
-											onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='cboEstado';">
-											al <input name="fechaAtencionFinal"
-											id="txtFechaAsignacionFinal"
-											value="<c:out value='${fechaProceso}' />" style="width: 70px"
-											class="campoobligatorioce" tabindex="1"
-											onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAtencionFinal');"
-											onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='cboEstado';">
-										</td>
-										<td class="etiqueta" align="left" valign="middle">Asesor
-										</td>
-										<td width="200"><input type="hidden" name="codigoAsesor"
-											id="codigoAsesor" style="width: 80px"
-											class="campoobligatorioiz" tabindex="1"
-											onfocus="this.select(); field='txtCriterio'; nextfield ='txtFechaSolicitud';">
-											<input name="descripcionAsesor" id="descripcionAsesor"
-											value="<c:out value='${descripcionAsesor}' />"
-											style="width: 160px" class="campoobligatorioiz" tabindex="1"
-											onfocus="this.select(); field='descripcionAsesor'; nextfield ='numeroDocumento';">
-											<img id="imgAsesor" style="cursor: hand"
-											title="Buscar Asesor"
-											src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif"
-											onclick="buscarAsesor();"></td>
-									</tr>
-									<tr id="trFiltroActivos3">
-										<td class="etiqueta" align="left" valign="middle">Tipo de
-											Alerta</td>
-										<td><select name="cboAlerta" id="cboAlerta"
-											style="width: 100%;" tabindex="4" class="campoobligatorioiz"
-											onfocus="field='cboEstado'; nextfield ='descripcionSolicitante';">
-												<c:forEach var='beanCRTipoAlerta'
-													items='${requestScope.listBeanCRTipoAlerta}'>
-													<option
-														value="<c:out value='${beanCRTipoAlerta.idTipoAlerta}'/>">
-														<c:out value='${beanCRTipoAlerta.descripcionTipoAlerta}' />
-													</option>
-												</c:forEach>
-										</select></td>
-										<td class="etiqueta" align="left" valign="middle">
-											Cliente</td>
-										<td width="200"><input type="hidden" name="codigoCliente"
-											id="codigoCliente" value="<c:out value='${codigoCliente}' />" />
-											<input type="hidden" name="numeroDocumento"
-											id="numeroDocumento"
-											value="<c:out value='${numeroDocumento}' />"
-											onfocus="this.select();nextfield='cboTipoLinea'"
-											class="campoobligatorioiz" maxlength="20"
-											style="width: 80px;" /> <input type="text"
-											name="nombreCliente" id="nombreCliente"
-											value="<c:out value='${nombreCliente}' />"
-											onfocus="this.select();nextfield='cboTipoLinea';"
-											class="campoobligatorioiz" style="width: 160px;" /> <img
-											id="imgPersona" style="cursor: hand"
-											src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif"
-											title="Buscar Cliente"
-											onclick="if(!byID('numeroDocumento').readOnly){buscarPersonas();}">
-										</td>
-										<td><delfinTagHtml:boton nombre="BT_Buscar_P.gif"
+    <form name="frmBusqueda" id="frmBusqueda" method="post">
+        <input type="hidden" name="idLote" value="<c:out value='${idLote}' />">
+        <input type="hidden" name="hidNumeroDocumento"> <input
+            type="hidden" name="usuarioSolicitante"> <input type="hidden"
+            name="usuarioLegal"> <input type="hidden" name="hidIdModulo"
+            value='<%=idModulo%>'>
+        <div id="hidepage"
+            style="position: absolute; left: 400px; top: 300px; width: 100; height: 20">
+            <table>
+                <tr>
+                    <td align="center"><img
+                        src="<%=request.getContextPath()%>/UTILS/img/loadings.gif"></td>
+                </tr>
+                <tr>
+                    <td align="center" style="font-weight: bold;"><span
+                        class="etiqueta">Cargando...</span></td>
+                </tr>
+            </table>
+        </div>
+        <div id="wndHide"></div>
+        <table cellpadding="0" cellspacing="0" width="100%">
+            <tr>
+                <td class="tituloopcion">DETALLE DE LOTE</tr>
+            <tr>
+                <td height="4"><img
+                    src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
+                    height="2"></td>
+            </tr>
+        </table>
+        <table border="0" cellpadding="0" cellspacing="2" width="99.5%"
+            align="center">
+            <tr>
+                <td>
+                    <table border="1" cellpadding="0" cellspacing="0" width="100%"
+                        align="center" class="frame">
+                        <tr>
+                            <td height="20" align="center">
+                                <table width="100%" cellpadding="0" cellspacing="0" border="0">
+                                    <tr>
+                                        <td align="left" colspan="4" valign="middle"><span>
+                                                <div id="itMenu1"
+                                                    style="width: 30px; height: 20px; top: 26px; z-index: 1;"
+                                                    class="itMenu" onMouseOver="despMenu(this.id,1)"
+                                                    onMouseOut="despMenu(this.id,0)">
+                                                    <div id="itMenu10" style="width: 30px" class="itMenuDes"
+                                                        onMouseOver="destacar(this,1)"
+                                                        onMouseOut="destacar(this,0)">
+                                                        <a href="" target="_parent" class="itLink"><delfinTagHtml:boton
+                                                                nombre="BT_Individual.gif"
+                                                                onclick="javascript:generarReporte('PDF');return false;" /></a>
+                                                    </div>
+                                                    <div id="itMenu11" style="width: 30px" class="itMenuDes"
+                                                        onMouseOver="destacar(this,1)"
+                                                        onMouseOut="destacar(this,0)">
+                                                        <a href="" target="_parent" class="itLink"><delfinTagHtml:boton
+                                                                nombre="BT_Masivo.gif"
+                                                                onclick="javascript:generarReporte('EXCEL');return false;" /></a>
+                                                    </div>
+                                                </div>
+                                        </span> <delfinTagHtml:boton nombre="BT_Salir.gif"
+                                                onclick="javascript:salir();" /></td>
+                                    </tr>
+                                </table>
+                            </td>
+                        </tr>
+                    </table>
+                </td>
+            </tr>
+            <tr>
+                <td height="4"><img
+                    src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
+                    height="2"></td>
+            </tr>
+            <tr>
+                <td class="tituloframe">FILTROS DE BUSQUEDA</td>
+            </tr>
+            <tr>
+                <td>
+                    <table border="0" cellpadding="0" cellspacing="0" width="100%"
+                        align="center" class="frame">
+                        <tr>
+                            <td height="20" align="center">
+                                <table width="99%" cellpadding="0" cellspacing="2" border="0">
+                                    <tr id="trFiltroActivos1">
+                                        <td class="etiqueta" align="left" width="110" valign="middle">
+                                            Fecha Asignaci&oacute;n</td>
+                                        <td class="etiqueta" width="200">del <input
+                                            name="fechaAsignacionInicial" id="txtFechaAsignacionInicial"
+                                            value="<c:out value='${fechaProceso}' />" style="width: 70px"
+                                            class="campoobligatorioce" tabindex="1"
+                                            onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionInicial');"
+                                            onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='txtFechaAsignacionFinal';">
+                                            al <input name="fechaAsignacionFinal"
+                                            id="txtFechaAsignacionFinal"
+                                            value="<c:out value='${fechaProceso}' />" style="width: 70px"
+                                            class="campoobligatorioce" tabindex="1"
+                                            onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAsignacionFinal');"
+                                            onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='txtFechaAtencionInicial';">
+                                        </td>
+                                        <td class="etiqueta" align="left" width="60" valign="middle">
+                                            Agencia</td>
+                                        <td width="200"><input type="hidden" name="codigoAgencia"
+                                            id="codigoAgencia" value="<c:out value='${codigoAgencia}' />"
+                                            style="width: 80px" class="campoobligatorioiz" tabindex="1"
+                                            onfocus="this.select(); field='txtCriterio'; nextfield ='txtFechaSolicitud';">
+                                            <input name="descripcionAgencia" id="descripcionAgencia"
+                                            value="<c:out value='${descripcionAgencia}' />"
+                                            style="width: 160px" class="campoobligatorioiz" tabindex="1"
+                                            onfocus="this.select(); field='descripcionAgencia'; nextfield ='descripcionAsesor';">
+                                            <img id="imgAgencia" style="cursor: hand"
+                                            title="Buscar Agencia"
+                                            src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif"
+                                            onclick="buscarAgencia();"></td>
+                                    </tr>
+                                    <tr id="trFiltroActivos2">
+                                        <td class="etiqueta" align="left" valign="middle">Fecha
+                                            Atenci&oacute;n</td>
+                                        <td class="etiqueta">del <input
+                                            name="fechaAtencionInicial" id="txtFechaAtencionInicial"
+                                            value="<c:out value='${fechaProceso}' />" style="width: 70px"
+                                            class="campoobligatorioce" tabindex="1"
+                                            onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAtencionInicial');"
+                                            onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='txtFechaAtencionFinal';">
+                                            al <input name="fechaAtencionFinal"
+                                            id="txtFechaAtencionFinal"
+                                            value="<c:out value='${fechaProceso}' />" style="width: 70px"
+                                            class="campoobligatorioce" tabindex="1"
+                                            onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAtencionFinal');"
+                                            onfocus="this.select(); field='txtFechaAsignacion'; nextfield ='cboTipoAlerta';">
+                                        </td>
+                                        <td class="etiqueta" align="left" valign="middle">Asesor
+                                        </td>
+                                        <td width="200"><input type="hidden" name="codigoAsesor"
+                                            id="codigoAsesor" style="width: 80px"
+                                            class="campoobligatorioiz" tabindex="1"
+                                            onfocus="this.select(); field='txtCriterio'; nextfield ='';">
+                                            <input name="descripcionAsesor" id="descripcionAsesor"
+                                            value="<c:out value='${descripcionAsesor}' />"
+                                            style="width: 160px" class="campoobligatorioiz" tabindex="1"
+                                            onfocus="this.select(); field='descripcionAsesor'; nextfield ='nombreCliente';">
+                                            <img id="imgAsesor" style="cursor: hand"
+                                            title="Buscar Asesor"
+                                            src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif"
+                                            onclick="buscarAsesor();"></td>
+                                    </tr>
+                                    <tr id="trFiltroActivos3">
+                                        <td class="etiqueta" align="left" valign="middle">Tipo de
+                                            Alerta</td>
+                                        <td><select name="cboTipoAlerta" id="cboTipoAlerta"
+                                            style="width: 150px;" tabindex="4" class="campoobligatorioiz"
+                                            onfocus="field='cboTipoAlerta'; nextfield ='descripcionAgencia';">
+                                                <c:forEach var='beanCombo'
+                                                    items='${requestScope.listTipoAlerta}'>
+                                                    <option value="<c:out value='${beanCombo.codigo}'/>">
+                                                        <c:out value='${beanCombo.descripcion}' />
+                                                    </option>
+                                                </c:forEach>
+                                        </select></td>
+                                        <td class="etiqueta" align="left" valign="middle">
+                                            Cliente</td>
+                                        <td width="200"><input type="hidden" name="codigoCliente"
+                                            id="codigoCliente" value="<c:out value='${codigoCliente}' />" />
+                                            <input type="hidden" name="numeroDocumento"
+                                            id="numeroDocumento"
+                                            value="<c:out value='${numeroDocumento}' />"
+                                            onfocus="this.select();nextfield='cboTipoLinea'"
+                                            class="campoobligatorioiz" maxlength="20"
+                                            style="width: 80px;" /> <input type="text"
+                                            name="nombreCliente" id="nombreCliente"
+                                            value="<c:out value='${nombreCliente}' />"
+                                            onfocus="this.select();nextfield='txtFechaAsignacionInicial';"
+                                            class="campoobligatorioiz" style="width: 160px;" /> <img
+                                            id="imgPersona" style="cursor: hand"
+                                            src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif"
+                                            title="Buscar Cliente"
+                                            onclick="if(!byID('numeroDocumento').readOnly){buscarPersonas();}">
+                                        </td>
+                                        <td><delfinTagHtml:boton nombre="BT_Buscar_P.gif"
                                                 onclick="javascript:onCargarTabla();" /></td>
-										<td class="etiqueta" align="left" valign="middle"></td>
-										<td></td>
-									</tr>
-								</table>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-			<tr>
-				<td height="4"><img
-					src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
-					height="2"></td>
-			</tr>
-			<tr>
-				<td>
-					<table cellpadding="0" border="0" cellspacing="0" width="100%"
-						align="center">
-						<tr>
-							<td align="center" valign="top" width="100%">
-								<table width="100%" align="center" cellspacing="0" border="0">
-									<tr>
-										<td valign="top">
-											<table width="100%" cellpadding="0" cellspacing="0"
-												border="0">
-												<tr>
-													<td class="tituloframe">DETALLE DE CLIENTES</td>
-												</tr>
-												<tr>
-													<td><iframe id="ifrmDetalleWorkflow"
-															name="ifrmDetalleWorkflow" frameborder="0"
-															width="100%" height="300px" class="frame"
-															src="FINANCIERO/workflow/seguimientoCartera/carga/CR_T_SeguimientoCarteraDetalleCarga_TABLA.jsp"></iframe>
-													</td>
-												</tr>
-											</table>
-										</td>
-									</tr>
-								</table>
-								<table width="100%">
-									<tr>
-										<td align="right"><IMG
-											src="<%=request.getContextPath()%>/UTILS/img/PagRe.gif"
-											onClick="pag(-1);"
-											style="CURSOR: hand; vertical-align: middle;" alt="Anterior">
-											<label id="inicial"
-											style="width: 25; text-align: left; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
-											<IMG src="<%=request.getContextPath()%>/UTILS/img/t.gif"
-											height=1 width="10"> <label id="final"
-											style="width: 25; text-align: right; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
-											<IMG src="<%=request.getContextPath()%>/UTILS/img/PagAv.gif"
-											onClick="pag(1)"
-											style="CURSOR: hand; vertical-align: middle;" alt="Siguiente">
-											<label id="total"
-											style="width: 50; text-align: left; font-size: 8pt; font-family: Arial; vertical-align: middle;"></label>
-										</td>
-									</tr>
-								</table>
-							</td>
-						</tr>
-					</table>
-				</td>
-			</tr>
-		</table>
-		<table>
-			<tr>
-				<td><img
-					src="${pageContext.request.contextPath}/UTILS/img/t.gif" width="1"
-					height="1"></td>
-			</tr>
-		</table>
-	</form>
+                                        <td class="etiqueta" align="left" valign="middle"></td>
+                                        <td></td>
+                                    </tr>
+                                </table>
+                            </td>
+                        </tr>
+                    </table>
+                </td>
+            </tr>
+            <tr>
+                <td height="4"><img
+                    src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1"
+                    height="2"></td>
+            </tr>
+            <tr>
+                <td>
+                    <table cellpadding="0" border="0" cellspacing="0" width="100%"
+                        align="center">
+                        <tr>
+                            <td align="center" valign="top" width="100%">
+                                <table width="100%" align="center" cellspacing="0" border="0">
+                                    <tr>
+                                        <td valign="top">
+                                            <table width="100%" cellpadding="0" cellspacing="0"
+                                                border="0">
+                                                <tr>
+                                                    <td class="tituloframe">DETALLE DE CLIENTES</td>
+                                                </tr>
+                                                <tr>
+                                                    <td><iframe id="ifrmGrillaDetalle"
+                                                            name="ifrmGrillaDetalle" frameborder="0" width="100%"
+                                                            height="300px" class="frame"
+                                                            src="FINANCIERO/workflow/seguimientoCartera/carga/CR_T_SeguimientoCarteraDetalleCarga_TABLA.jsp"></iframe>
+                                                    </td>
+                                                </tr>
+                                            </table>
+                                        </td>
+                                    </tr>
+                                </table>
+                                <table width="100%">
+                                    <tr>
+                                        <td align="right">
+                                          <IMG src="<%=request.getContextPath()%>/UTILS/img/PagRe.gif" onClick="pag(-1);" style="CURSOR: hand;vertical-align: middle;" alt="Anterior">
+                                          <label id="inicial" style="width:25;text-align:left;font-size:8pt;font-family:Arial;vertical-align: middle;"></label>
+                                          <IMG src="<%=request.getContextPath()%>/UTILS/img/t.gif" height=1 width="10">
+                                          <label id="final" style="width:25;text-align:right;font-size:8pt;font-family:Arial;vertical-align: middle;"></label>
+                                          <IMG src="<%=request.getContextPath()%>/UTILS/img/PagAv.gif" onClick="pag(1)" style="CURSOR: hand;vertical-align: middle;" alt="Siguiente">
+                                          <label id="total" style="width:50;text-align:left;font-size:8pt;font-family:Arial;vertical-align: middle;"></label>
+                                         </td>
+                                    </tr>
+                                </table>
+                            </td>
+                        </tr>
+                    </table>
+                </td>
+            </tr>
+        </table>
+        <table>
+            <tr>
+                <td><img
+                    src="${pageContext.request.contextPath}/UTILS/img/t.gif" width="1"
+                    height="1"></td>
+            </tr>
+        </table>
+    </form>
 </body>
 </html>
\ No newline at end of file
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR_T_SeguimientoCarteraDetalleCarga_TABLA.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR_T_SeguimientoCarteraDetalleCarga_TABLA.jsp
index e1080f3..a61ebde 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR_T_SeguimientoCarteraDetalleCarga_TABLA.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/carga/CR_T_SeguimientoCarteraDetalleCarga_TABLA.jsp
@@ -5,81 +5,95 @@
 <%@ taglib prefix='fmt' uri='http://java.sun.com/jstl/fmt'%>
 <%
     String path = request.getContextPath();
+    String myData = request.getAttribute("myData") != null ? (String)request.getAttribute("myData") : "";
+    String hid_pagina = request.getParameter("hid_pagina") != null?request.getParameter("hid_pagina"):"1";  
+    String ini = request.getAttribute("inicio") != null?(String)request.getAttribute("inicio"):"0";
+    String indFin = request.getAttribute("indFin") != null?(String)request.getAttribute("indFin"):"0";
 %>
 <html>
 <head>
 <!-- Invocaci�n de Estilos -->
 <link id="css" href="<%=path%>/UTILS/css/DELFIN.css" rel="stylesheet"
-	type="text/css">
+    type="text/css">
 <!-- Invocaci�n de JavaScript -->
 <script src="<%=path%>/UTILS/Script/grid.js"></script>
 <script src="<%=path%>/UTILS/Script/MsgValidacion.js"></script>
 <script src="<%=path%>/UTILS/Script/DELFIN-Utiles.js"></script>
 <style>
 .active-controls-grid {
-	width: "100%";
-	height: 100%;
-	font: menu;
+    width: "100%";
+    height: 100%;
+    font: menu;
 }
 
 .active-column-0 {
-	width: 100px;
-	text-align: left;
+    width: 120px;
+    text-align: left;
 }
 
 .active-column-1 {
-	width: 18%;
-	text-align: left;
+    width: 200px;
+    text-align: left;
 }
 
 .active-column-2 {
-	width: 18%;
-	text-align: left;
+    width: 200px;
+    text-align: left;
 }
 
 .active-column-3 {
-	width: 10%;
-	text-align: left;
+    width: 120px;
+    text-align: left;
 }
 
 .active-column-4 {
-	width: 18%;
-	text-align: right;
+    width: 100px;
+    text-align: right;
 }
 
 active-column-5 {
-	width: 18%;
-	text-align: center;
+    width: 100px;
+    text-align: center;
+}
+
+active-column-6 {
+    width: 200px;
+    text-align: left;
+}
+
+active-column-7 {
+    width: 100px;
+    text-align: left;
 }
 
 .active-grid-column {
-	border-right: 1px solid threedlightshadow;
+    border-right: 1px solid threedlightshadow;
 }
 
 .active-grid-row {
-	border-bottom: 1px solid threedlightshadow;
+    border-bottom: 1px solid threedlightshadow;
 }
 </style>
 </head>
 <body onload="onload();" TOPMARGIN=0 LEFTMARGIN=0 MARGINHEIGHT=0
-	MARGINWIDTH=0>
-	<script>
-            var path;
-            function onload(){
-              path = '<%=path%>';
-            parent.mensajeRespuesta('<c:out value="${codigoError}" />', '<c:out value="${mensajeError}" />');
-            if (parent.document.getElementById('hidepage')) {
-                parent.loadImages();
-            }
-            setFoco();
-        }
+    MARGINWIDTH=0>
+    <script>
+       var path;
+       function onload(){
+           path = '<%=path%>';
+           parent.mensajeRespuesta('<c:out value="${codigoError}" />', '<c:out value="${mensajeError}" />');
+           if(parent.document.getElementById('hidepage')){
+               parent.loadImages();
+           }
+           setFoco();
+         }
 
         var posini;
         var posfin;
         var indice = '0';
         var myData = [ <c:out value="${myData}" escapeXml="false"/> ];
 
-        var myColumns = [ "Agencia", "Asesor", "Cliente", "Tipo Alerta", "Monto Alerta", "Fecha Atenci�n" ];
+        var myColumns = [ "Agencia", "Asesor", "Cliente", "Tipo Alerta", "Monto Alerta", "Fecha Atenci�n", "N�mero Cr�dito", "Producto" ];
 
         //  create ActiveWidgets Grid javascript object
         var obj = new Active.Controls.Grid;
@@ -148,6 +162,48 @@
         //Pintado de la grilla
         document.write(obj);
 
+        function datosPagina(pag){
+            parent.onCargarTabla(pag);
+        }
+
+        function paginacion(direccion){
+            if(myData.length < 1){
+                return;
+              }
+              var pag = eval("<%=hid_pagina%>")+eval(direccion);
+                  if(direccion == "-1"){
+                     <%if(!ini.equals("0")){%>
+                          datosPagina(pag);
+                     <%}else{%>
+                          alert(m_0060);
+                     <%}%>
+                  }else{
+                     <%if(indFin.equals("0")){%>
+                          datosPagina(pag);
+                     <%}else{%>
+                          alert(m_0061);
+                     <%}%>
+                  }
+            }
+
+        valores();
+        function valores(){
+          <%
+            String comienzo = request.getAttribute("inicio") != null?(String)request.getAttribute("inicio"):"0";
+            String fin = request.getAttribute("fin") != null?(String)request.getAttribute("fin"):"0";
+            String total = request.getAttribute("total") != null?(String)request.getAttribute("total"):"0";
+          %>
+            if(myData.length>0){
+               parent.inicial.innerHTML = eval(<%=comienzo%>)+1;
+               parent.final.innerHTML   = <%= fin %>;
+               parent.total.innerHTML   = "de <%= total %>";
+            }else{
+               parent.inicial.innerHTML = "";
+               parent.final.innerHTML   = "";
+               parent.total.innerHTML   = "";
+            }
+        }
+
         function setFoco() {
             try {
                 if (myData.length == 0) {
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/documentos/CR_T_DocumentoActividad_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/documentos/CR_T_DocumentoActividad_CNTR.jsp
index be9ddef..107554f 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/documentos/CR_T_DocumentoActividad_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/documentos/CR_T_DocumentoActividad_CNTR.jsp
@@ -118,7 +118,8 @@
             if(event.keyCode == 505)
                 return false;
         }
-        document.onkeydown = keyDown;       
+        document.onkeydown = keyDown;
+        document.oncontextmenu = function(){return false}
 
      function salir(){
          window.close();
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_C_DatosActividades_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_C_DatosActividades_CNTR.jsp
index 45d386a..b0468c1 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_C_DatosActividades_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_C_DatosActividades_CNTR.jsp
@@ -71,6 +71,7 @@
                 return false;
         }
         document.onkeydown = keyDown;
+        document.oncontextmenu = function(){return false};
 
         function onCargarDetalle() {
             
@@ -124,7 +125,7 @@
                 alert(m_10120);
                 return false;
                 }
-            if(indicadorValidacion == 'S'){
+            if(indicadorValidacion == '<%=Constante.ESTADO_REGISTRO_VIGENTE%>'){
                 if(!validar()){
                     return false;
                 }
@@ -140,7 +141,7 @@
             ajaxRequestPOST(url, params, false, function(xmldoc) {
                 mensajeRespuestaXML(xmldoc, function(){
                   alert(m_8570);
-                  parent.salir();
+                  salir();
                 });
               });
         }
@@ -157,6 +158,9 @@
 
         function agregarActividad(idActividad, indicadorEnvio){
             var strComportamiento = byID('strComportamiento').value;
+            if(isEmpty(indicadorEnvio)){
+            	indicadorEnvio = '';
+            }
             if(isEmpty(idActividad)){
                 idActividad = '';
                 
@@ -171,9 +175,10 @@
                 params += '&idMaestra=' + byID('idMaestra').value;
                 params += '&idActividad=' + idActividad;
                 params += '&strComportamiento=' + strComportamiento;
+                params += '&indicadorEnvio=' + indicadorEnvio;
                 params += '&time=' + (new Date()).getTime();
             var url = '/DELFINWEBNEW/CR_T_RegistroActividades_Servlet' + params;
-            var attribs = 'dialogHeight:300px;dialogWidth:600px; center:yes; help:no; resizable:no; status:no';
+            var attribs = 'dialogHeight:275px;dialogWidth:600px; center:yes; help:no; resizable:no; status:no';
             window.showModalDialog(url, window, attribs);
          }
 
@@ -206,77 +211,39 @@
               });
         }
 
+        function cargarDocumentos(indicadorEnvio, correlativoActividad){
+            var strComportamiento = byID('strComportamiento').value;
+            if(isEmpty(correlativoActividad)){
+                alert(m_10133);
+                return;
+             }
+             var params = '?action=MOSTRAR_DETALLE';
+             params += '&correlativoActividad=' + correlativoActividad;
+             params += '&comportamiento=' + strComportamiento;
+             params += '&indicadorEnvio=' + indicadorEnvio;
+            var pagina = path + '/CR_T_DocumentosPorActividades_Servlet' + params;
+            window.showModalDialog(pagina, window,"dialogHeight:500px;dialogWidth:700px;center:yes;help:no;resizable:no;status:no");
+        }
+
   </script>
   </head>
   <body onhelp="getF1();" class="colorbody" onload="cargar();" style="padding: 0px, 0px, 0px, 0px;overflow:auto;">
     <form name="frmDatosActividades" id="frmDatosActividades" method="post">
       <div id="hidepage" style="position: absolute;left:460px;top:230px;width: 100;height: 20">
+      <input type="hidden" name="idEtapa" id="idEtapa" value="<c:out value="${requestScope.idEtapa}"/>">
+      <input type="hidden" name="idMaestra" id="idMaestra">
+      <input type="hidden" name="idModulo" id="idModulo" >
+      <input type="hidden" name="correlativoSeguimiento" id="correlativoSeguimiento" value="<c:out value="${beanCRSeguimientoCartera.correlativoSeguimiento}"/>" >
+      <input type="hidden" name="idActividad" id="idActividad">
+      <input type="hidden" name="strComportamiento" id="strComportamiento" value="<c:out value="${requestScope.strComportamiento}"/>">
+      <input type="hidden" name="codigoCliente" id="codigoCliente" value="<c:out value="${beanCRSeguimientoCartera.codigoCliente}"/>" >
+      <input type="hidden" name="tipoPersona" id="tipoPersona" value="<c:out value="${beanCRSeguimientoCartera.tipoPersona}"/>" >
           <table>
               <tr><td align="center"><img src="<%=request.getContextPath()%>/UTILS/img/loadings.gif" ></td></tr>
               <tr><td align="center" style="font-weight: bold;" ><span class="etiqueta" >Cargando...</span></td></tr>
           </table>
       </div>
       <table border="0" cellpadding="0" cellspacing="2" width="99.5%" align="center" >
-        <tr>
-          <td height="4">
-            <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
-          </td>
-        </tr>
-        <tr>
-            <td class="tituloframe">
-                DATOS ACTIVIDADES
-                <input type="hidden" name="idEtapa" id="idEtapa" value="<c:out value="${requestScope.idEtapa}"/>">
-                <input type="hidden" name="idMaestra" id="idMaestra">
-                <input type="hidden" name="idModulo" id="idModulo" >
-                <input type="hidden" name="correlativoSeguimiento" id="correlativoSeguimiento" value="<c:out value="${beanCRSeguimientoCartera.correlativoSeguimiento}"/>" >
-                <input type="hidden" name="strComportamiento" id="strComportamiento" value="<c:out value="${requestScope.strComportamiento}"/>">
-            </td>
-        </tr>
-        <tr>
-          <td>
-            <table border="2" cellpadding="0" cellspacing="0" width="100%" align="center" class="frame">
-              <tr>
-                <td height="20" align="center">
-                  <table width="99%" cellpadding="0" cellspacing="2" border="0">
-                    <tr>
-                        <td class="etiqueta" align="left"  valign="middle" style="width: 3%">
-                            Motivo
-                        </td>
-                        <td style="width: 45%"> 
-                            <select name="idTipoMotivo" id="idTipoMotivo" style="width: 250px;" tabindex="4" onfocus=" nextfield='textoComentario'" <%=cboIz%>>
-	                          <c:forEach var='beanCRMotivoSeguimientoCartera' items='${requestScope.listBeanCRMotivoSeguimientoCartera}'  >
-	                            <option value="<c:out value='${beanCRMotivoSeguimientoCartera.idMotivoSeguimiento}'/>" <c:if test="${beanCRMotivoSeguimientoCartera.idMotivoSeguimiento == beanCRMovimientoPorSeguimiento.idTipoMotivo}">selected</c:if> >
-	                              <c:out value='${beanCRMotivoSeguimientoCartera.descripcionMotivo}' />
-	                            </option>
-	                          </c:forEach>
-	                        </select>
-                        </td>
-                    </tr>
-                    <tr>
-			          <td height="4">
-			            <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
-			          </td>
-			        </tr>
-                    <tr>
-                        <td class="etiqueta" align="left"  valign="middle" style="width: 3%" >
-                            Comentarios
-                        </td>
-                       <td colspan="2"> 
-                           <textarea name="textoComentario" id="textoComentario" style="width: 100%;height:70px;"
-                           onfocus="this.select(); field='textoComentario';" <%=campoIz%>
-                           onKeyDown="goblalLimitText('textoComentario','numCarac',1000);" onKeyUp="goblalLimitText('textoComentario','numCarac',1000);"><c:out value="${requestScope.textoComentario}"/></textarea>
-                           <input type="hidden" name="countdown" size="3" readonly />
-                           <div style="text-align: right;" class="etiqueta">
-                              (Max. <label name="numCarac" id="numCarac"></label>&nbsp;/ 1000)
-                            </div>
-                        </td>
-                    </tr>
-                </table>
-                </td>
-              </tr>
-            </table>
-          </td>
-        </tr>
         <tr>
           <td height="4">
             <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
@@ -339,6 +306,61 @@
             </table>
           </td>
         </tr>
+        <tr>
+          <td height="4">
+            <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
+          </td>
+        </tr>
+        <tr>
+            <td class="tituloframe">
+                DATOS DE ENVIO
+            </td>
+        </tr>
+        <tr>
+          <td>
+            <table border="2" cellpadding="0" cellspacing="0" width="100%" align="center" class="frame">
+              <tr>
+                <td height="20" align="center">
+                  <table width="99%" cellpadding="0" cellspacing="2" border="0">
+                    <tr>
+                        <td class="etiqueta" align="left"  valign="middle" style="width: 3%">
+                            Motivo
+                        </td>
+                        <td style="width: 45%"> 
+                            <select name="idTipoMotivo" id="idTipoMotivo" style="width: 250px;" tabindex="4" onfocus=" nextfield='textoComentario'" <%=cboIz%>>
+                              <c:forEach var='beanCRMotivoSeguimientoCartera' items='${requestScope.listBeanCRMotivoSeguimientoCartera}'  >
+                                <option value="<c:out value='${beanCRMotivoSeguimientoCartera.idMotivoSeguimiento}'/>" <c:if test="${beanCRMotivoSeguimientoCartera.idMotivoSeguimiento == beanCRMovimientoPorSeguimiento.idTipoMotivo}">selected</c:if> >
+                                  <c:out value='${beanCRMotivoSeguimientoCartera.descripcionMotivo}' />
+                                </option>
+                              </c:forEach>
+                            </select>
+                        </td>
+                    </tr>
+                    <tr>
+                      <td height="4">
+                        <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
+                      </td>
+                    </tr>
+                    <tr>
+                        <td class="etiqueta" align="left"  valign="middle" style="width: 3%; padding: 0 0 30px 0" >
+                            Comentarios
+                        </td>
+                       <td colspan="2"> 
+                           <textarea name="textoComentario" id="textoComentario" style="width: 100%;height:70px;"
+                           onfocus="this.select(); field='textoComentario';" <%=campoIz%>
+                           onKeyDown="goblalLimitText('textoComentario','numCarac',1000);" onKeyUp="goblalLimitText('textoComentario','numCarac',1000);"><c:out value="${requestScope.textoComentario}"/></textarea>
+                           <input type="hidden" name="countdown" size="3" readonly />
+                           <div style="text-align: right;" class="etiqueta">
+                              (Max. <label name="numCarac" id="numCarac"></label>&nbsp;/ 1000)
+                            </div>
+                        </td>
+                    </tr>
+                </table>
+                </td>
+              </tr>
+            </table>
+          </td>
+        </tr>
       </table>
     </form>
   </body>
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_C_DatosActividades_TABLA.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_C_DatosActividades_TABLA.jsp
index 1ae9542..33b4f7c 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_C_DatosActividades_TABLA.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_C_DatosActividades_TABLA.jsp
@@ -28,6 +28,7 @@
         .active-column-5  {width: 120px;text-align: left}
         .active-column-6  {width: 250px;text-align: left;}
         .active-column-7  {width: 250px;text-align: left;}
+        .active-column-8  {width: 100px;text-align: center;}
 
         .active-grid-column {border-right: 1px solid threedlightshadow; }
         .active-grid-row {border-bottom: 1px solid threedlightshadow; }
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroActividades_CHILD.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroActividades_CHILD.jsp
index 656a0e5..43ad49c 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroActividades_CHILD.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroActividades_CHILD.jsp
@@ -56,6 +56,8 @@
             	    return false;
             	}
             	if(nextfield == "tipoActividad"){
+            		byID('fechaActividad').value=vuelveFecha(byID('fechaActividad').value);
+            		cal1.popup();
             	    eval('document.forms[0].' + nextfield + '.focus()');
             	    return false;
             	}
@@ -92,6 +94,7 @@
                 return false;
         }
         document.onkeydown = keyDown;
+        document.oncontextmenu = function(){return false};
 
         function salir(){
         	window.close();
@@ -128,7 +131,8 @@
         }
 
         function grabarActividad(){
-            strComportamiento = byID('strComportamiento').value;
+            var strComportamiento = byID('strComportamiento').value;
+            var idMaestra = byID('idMaestra').value;
             if(strComportamiento != '<%=Constante.WF_COMPORTAMIENTO_TRANSACCIONAL%>'){
                 alert(m_10120);
                 return false;
@@ -139,17 +143,33 @@
 
             var params = serializeForm(byID('frmRegistroActividad'));
             params += '&action=GRABAR';
-            params += '&idMaestra=' + byID('idMaestra').value;
+            params += '&idMaestra=' + idMaestra;
             params += '&time=' + (new Date()).getTime();
             var url = path + '/CR_T_RegistroActividades_Servlet';
             ajaxRequestPOST(url, params, false, function(xmldoc) {
                 mensajeRespuestaXML(xmldoc, function(){
+                  var idActividad = getValor(xmldoc, 'idActividad');
+                  byID('correlativoActividad').value = idActividad;
                   alert(m_8570);
                   var callerWindowObj = dialogArguments;
                   callerWindowObj.onCargarDetalle();
-                  salir();
                 });
               });
+        }
+        function cargarDocumentos(){
+        	var indicadorEnvio = byID('indicadorEnvio').value;
+        	var correlativoActividad = byID('correlativoActividad').value;
+        	var strComportamiento = byID('strComportamiento').value
+            if(isEmpty(correlativoActividad)){
+                alert(m_10133);
+                return;
+             }
+        	 var params = '?action=MOSTRAR_DETALLE';
+             params += '&correlativoActividad=' + correlativoActividad;
+             params += '&comportamiento=' + strComportamiento;
+             params += '&indicadorEnvio=' + indicadorEnvio;
+            var pagina = path + '/CR_T_DocumentosPorActividades_Servlet' + params;
+            window.showModalDialog(pagina, window,"dialogHeight:500px;dialogWidth:700px;center:yes;help:no;resizable:no;status:no");
         }
     </script>
   </head>
@@ -160,6 +180,7 @@
     <input type="hidden" name="idModulo" id="idModulo">
     <input type="hidden" name="strComportamiento" id="strComportamiento" value="<c:out value="${requestScope.strComportamiento}"/>">
     <input type="hidden" name="correlativoActividad" id="correlativoActividad" value="<c:out value="${requestScope.beanCRActividadSeguimientoCartera.correlativoActividad}"/>">
+    <input type="hidden" name="indicadorEnvio" id="indicadorEnvio" value="<c:out value="${requestScope.indicadorEnvio}"/>">
       <table border="0" cellpadding="0" cellspacing="2" width="99.5%" align="center" >
         <tr>
           <td>
@@ -171,8 +192,8 @@
                       <td align="left" colspan="4" valign="middle">
                         <div id="botonesRegistroActividades" style="display: inline">
                             <delfinTagHtml:boton nombre="BT_Grabar.gif" onclick="javascript:grabarActividad();"/>
-                            <delfinTagHtml:boton nombre="BT_Documentos.gif" onclick="javascript:"/>
                         </div>
+                            <delfinTagHtml:boton nombre="BT_Documentos.gif" onclick="javascript:cargarDocumentos()"/>
                         <delfinTagHtml:boton nombre="BT_Salir.gif" onclick="javascript:salir();" />
                       </td>
                     </tr>
@@ -197,34 +218,22 @@
                 <td height="20" align="center">
                   <table width="99%" cellpadding="0" cellspacing="2" border="0">
                     <tr> 
-                        <td class="etiqueta" align="left" width="110" valign="middle">
+                        <td class="etiqueta" align="left" style="padding: 5px 0" width="150" valign="middle">
                             Fecha Actividad
                         </td>
-                        <td class="etiqueta" width="200">
-                            <input name="fechaActividad" id="fechaActividad" value="<c:out value='${beanCRActividadSeguimientoCartera.fechaActividad}' />" style="width: 180px" <%=campoCe%>  
-                            tabindex="1" onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaActividad');" onfocus="this.select(); field='fechaActividad'; nextfield ='tipoActividad';">
+                        <td class="etiqueta" width="80%">
+                            <input name="fechaActividad" id="fechaActividad" value="<c:out value='${beanCRActividadSeguimientoCartera.fechaActividad}' />" style="width: 45%" <%=campoCe%>  
+                            tabindex="1" onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaActividad');" 
+                            onfocus="this.select(); field='fechaActividad'; nextfield ='tipoActividad';">
                             <img id="imgFecha" style="cursor:hand" title="Seleccionar Fecha" width="16px" height="16px" src="<%=request.getContextPath()%>/UTILS/img/cal.gif" onclick="if(!byID('fechaActividad').readOnly){cal1.popup();};">
-                        </td>
-
-                        <td  class="etiqueta" align="left" width="110" valign="middle">
-                            Comentario
-                        </td>
-                        <td class="etiqueta" width="200" rowspan="2">
-                            <textarea name="comentarioActividad" id="comentarioActividad" style="width: 200px;height:60px;"
-                                 onfocus="this.select(); field='comentarioActividad';" <%=campoIz%>
-                                 onKeyDown="goblalLimitText('comentarioActividad','numCarac',1000);" onKeyUp="goblalLimitText('comentarioActividad','numCarac',1000);"><c:out value="${requestScope.beanCRActividadSeguimientoCartera.comentarioActividad}"/></textarea>
-                                 <input type="hidden" name="countdown" size="3" readonly />
-                                 <div style="text-align: right;" class="etiqueta">
-                                    (Max. <label name="numCarac" id="numCarac"></label>&nbsp;/ 1000)
-                                 </div>
                         </td>
                     </tr>
                     <tr>
-                        <td class="etiqueta" align="left" width="60" valign="middle">
+                        <td class="etiqueta" align="left" style="padding: 5px 0" valign="middle">
                             Tipo Actividad
                         </td>
-                        <td width="200"> 
-                            <select name="tipoActividad" id="tipoActividad" onchange="" onfocus="nextfield='contactoActividad'" <%=cboIz%> style="width: 200px;" >
+                        <td class="etiqueta"> 
+                            <select name="tipoActividad" id="tipoActividad" onchange="" onfocus="nextfield='contactoActividad'" <%=cboIz%> style="width: 50%;" >
 	                          <c:forEach var='indicadorTipoActividad' items='${lstTipoActividad}'>
 	                            <option value="<c:out value='${indicadorTipoActividad.codigo}'/>" <c:if test="${indicadorTipoActividad.codigo == beanCRActividadSeguimientoCartera.tipoActividad}">selected</c:if> >
 	                              <c:out value='${indicadorTipoActividad.descripcion}' />
@@ -234,11 +243,11 @@
                         </td>
                     </tr>
                     <tr>
-                        <td class="etiqueta" align="left" width="130" valign="middle">
+                        <td class="etiqueta" align="left" style="padding: 5px 0" valign="middle">
                             Contacto
                         </td>
                         <td > 
-                            <select name="contactoActividad" id="contactoActividad" onchange="" onfocus="nextfield='comentarioActividad'" <%=cboIz%> style="width: 200px;" >
+                            <select name="contactoActividad" id="contactoActividad" onchange="" onfocus="nextfield='comentarioActividad'" <%=cboIz%> style="width: 50%;" >
                               <c:forEach var='indicadorContacto' items='${requestScope.lstContacto}'>
                                 <option value="<c:out value='${indicadorContacto.codigo}'/>" <c:if test="${indicadorContacto.codigo == beanCRActividadSeguimientoCartera.contactoActividad}">selected</c:if> >
                                   <c:out value='${indicadorContacto.descripcion}' />
@@ -247,6 +256,20 @@
                             </select>
                         </td>
                       </tr>
+                      <tr>
+                        <td  class="etiqueta" align="left" style="padding: 5px 0" valign="middle">
+                            Comentario
+                        </td>
+                        <td class="etiqueta">
+                            <textarea name="comentarioActividad" id="comentarioActividad" style="width: 99%;height:60px;"
+                                 onfocus="this.select(); field='comentarioActividad';" <%=campoIz%>
+                                 onKeyDown="goblalLimitText('comentarioActividad','numCarac',1000);" onKeyUp="goblalLimitText('comentarioActividad','numCarac',1000);"><c:out value="${requestScope.beanCRActividadSeguimientoCartera.comentarioActividad}"/></textarea>
+                                 <input type="hidden" name="countdown" size="3" readonly />
+                                 <div style="text-align: right;" class="etiqueta">
+                                    (Max. <label name="numCarac" id="numCarac"></label>&nbsp;/ 1000)
+                                 </div>
+                        </td>
+                      </tr>
                   </table>
                 </td>
               </tr>
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_CNTR.jsp
new file mode 100644
index 0000000..f17f381
--- /dev/null
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_CNTR.jsp
@@ -0,0 +1,358 @@
+<!-- CR_T_RegistroDocumentosPorActividades_CNTR.jsp-->
+<%--[Req.S17-022] kdelacruz 07.04.2017 - Implementaci�n WorkFlow Seguimiento Carteral--%>
+
+<%@ page language="java" import="java.util.*" pageEncoding="ISO-8859-1"%>
+<jsp:directive.page import="financ.util.Constante"/>
+<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
+<%@ taglib uri="/delfin" prefix="delfinTagHtml" %>
+<%
+    String strComportamiento = request.getAttribute("strComportamiento") != null ? (String) request.getAttribute("strComportamiento") : "C";
+    
+    String campoIz = "T".equals(strComportamiento) ? "class='campoobligatorioiz'" : "readonly class='campodisplayiz'";
+    String campoDe = "T".equals(strComportamiento) ? "class='campoobligatoriode'" : "readonly class='campodisplayde'";
+    String campoCe = "T".equals(strComportamiento) ? "class='campoobligatorioce'" : "readonly class='campodisplayce'";
+
+    String opcionDe = "T".equals(strComportamiento) ? "class='campoopcionalde'" : "readonly class='campodisplayde'";
+
+    String cboOpcIz = "T".equals(strComportamiento) ? "class='campoopcionaliz'" : "disabled class='campodisplayiz'";
+    String cboIz = "T".equals(strComportamiento) ? "class='campoobligatorioiz'" : "disabled class='campodisplayiz'";
+%>
+<html>
+  <head>
+    <title>REGISTRO DE ACTIVIDAD</title>
+    <link id="css" href="${pageContext.request.contextPath}/UTILS/css/DELFIN.css" rel="stylesheet" type="text/css">
+    <script src="${pageContext.request.contextPath}/UTILS/Script/MsgValidacion.js"></script>
+    <script src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Utiles.js"></script>
+    <script src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Calendario.js"></script>
+    <script type="text/javascript">
+    
+        var f = null;
+        var path;
+        nextfield = "";
+
+        function cargar() {
+            byID('idMaestra').value = byID('idMaestra').value;
+            byID('idModulo').value = byID('idModulo').value;
+            f = document.getElementById('frmRegistroDocumentoActividad');
+            path = '<%=request.getContextPath()%>';
+            mensajeRespuesta('<c:out value="${codigoError}" />', '<c:out value="${mensajeError}" />');
+            goblalLimitText('textoComentario','numCarac',1000);
+            onCargarDetalle();
+            if('<%=Constante.COMPORTAMIENTO_TRANSACCIONAL%>' != '<%=strComportamiento%>'){
+                byID('botonesRegistroDocumentos').style.display = 'none';
+            }
+        }
+
+        function onCargarDetalle(pag) {
+            var idActividad = byID('idActividad').value;
+            var params = '?action=CARGAR_DETALLE';
+            params += '&idActividad=' + idActividad;
+            if(pag){
+                params += '&hid_pagina=' + pag;
+            }
+            var url = path + '/CR_T_DocumentosPorActividades_Servlet' + params;
+            document.ifrmDetalleDocumentos.location.replace(url); 
+        }
+
+        function keyDown(DnEvents){
+            k = window.event.keyCode;
+            if (k == 13){
+                if(nextfield == "textoComentario"){
+                    eval('document.forms[0].' + nextfield + '.focus()');
+                    return false;
+                }
+                return false;
+            }
+            if (k == 120){
+                return false;
+            }
+            if (k == 27){
+                salir();
+                return false;
+            }
+            if (k == 121){
+                return false;
+            }
+            if (k == 112){
+                ayuda();
+                return false;
+            }
+            if (event.ctrlKey){
+                event.keyCode = 0;
+                return false;
+            }
+            if (k==46){
+                return false;
+            }
+            if (window.event && (k == 114 || k == 116 || k == 117 || k == 122))
+                event.keyCode = 505;
+            if(event.keyCode == 505)
+                return false;
+        }
+        document.onkeydown = keyDown;
+        document.oncontextmenu = function(){return false};
+
+        function salir(){
+            window.close();
+            return true;
+        }
+
+        function validar(){
+            var textoComentario = byID('textoComentario').value;
+            var cboTipoDocumento = byID('cboTipoDocumento').value;
+            var idFileTMP = byID('idFileTMP').value;
+            
+            if(isEmpty(textoComentario)){
+                frmRegistroDocumentoActividad.textoComentario.focus();
+                alert(m_0001);
+                return false;
+            }
+            if(isEmpty(cboTipoDocumento)){
+                frmRegistroDocumentoActividad.cboTipoDocumento.focus();
+                alert(m_0001);
+                return false;
+            }
+            if(isEmpty(idFileTMP)){
+                alert(m_10136);
+                return false;
+            }
+            return true;
+        }
+
+        function limpiarCampos(){
+            byID('textoComentario').value = '';
+            byID('idFileTMP').value = '';
+        }
+        function guardarDocumento(){
+            strComportamiento = byID('strComportamiento').value;
+            if(strComportamiento != '<%=Constante.WF_COMPORTAMIENTO_TRANSACCIONAL%>'){
+                alert(m_10120);
+                return false;
+                }
+            if(!validar()){
+                return false;
+            }
+            if(!validarIndicadorEnvio()){
+                return false;
+            }
+
+            var cboTipoDocumento = byID('cboTipoDocumento').value;
+            var textoComentario = byID('textoComentario').value;
+            var idActividad = byID('idActividad').value;
+            var idFileTMP = byID('idFileTMP').value;
+            var params = 'action=GUARDAR_DOCUMENTO';
+	            params += '&cboTipoDocumento=' + cboTipoDocumento;
+	            params += '&textoComentario=' + textoComentario;
+	            params += '&idActividad=' + idActividad;
+	            params += '&idFileTMP=' + idFileTMP;
+	            params += '&time=' + (new Date()).getTime();
+            var url = path + '/CR_T_DocumentosPorActividades_Servlet';
+            ajaxRequestPOST(url, params, false, function(xmldoc) {
+                mensajeRespuestaXML(xmldoc, function(){
+                	onCargarDetalle();
+                	limpiarCampos();
+                	alert(m_8570);
+                });
+              });
+        }
+
+        function validarIndicadorEnvio(){
+        	var indicadorEnvio = byID('indicadorEnvio').value;
+            if(indicadorEnvio == '<%=Constante.ESTADO_REGISTRO_VIGENTE%>'){
+                alert(m_10128);
+                return false;
+            }
+            return true;
+        }
+
+        function borrarArchivo(idCorrelativo, idFile){
+        	if(!validarIndicadorEnvio()){
+                return false;
+            }
+            strComportamiento = byID('strComportamiento').value;
+            if(strComportamiento != '<%=Constante.WF_COMPORTAMIENTO_TRANSACCIONAL%>'){
+                alert(m_10120);
+                return false;
+            }
+            if (!confirm(m_0002)){
+                return;
+            }
+
+            var params = 'action=BORRAR_DOCUMENTO';
+            params += '&idCorrelativo=' + idCorrelativo;
+            params += '&idFile=' + idFile;
+            params += '&time=' + (new Date()).getTime();
+            var url = path + '/CR_T_DocumentosPorActividades_Servlet';
+            ajaxRequestPOST(url, params, false, function(xmldoc) {
+                mensajeRespuestaXML(xmldoc, function(){
+                    onCargarDetalle();
+                    alert(m_8570);
+                });
+              });
+        }
+
+        function pag(direccion){
+            document.ifrmDetalleDocumentos.paginacion(direccion);
+        }
+
+        function insertarIdArchivo(campo, idFile){
+            eval("byID('" + campo + "').value=idFile");
+         }
+
+        function adjuntarDocumento(){
+        	strComportamiento = byID('strComportamiento').value;
+            if(strComportamiento != '<%=Constante.WF_COMPORTAMIENTO_TRANSACCIONAL%>'){
+                alert(m_10120);
+                return false;
+            }
+            adjuntarFile('idFileTMP');
+         }
+
+    </script>
+  </head>
+  <body onhelp="getF1();" class="colorbody" onload="cargar();" style="padding: 0px, 0px, 0px, 0px;overflow:auto;">
+    <form name="frmRegistroDocumentoActividad" id="frmRegistroDocumentoActividad" method="post">
+    <input type="hidden" name="idEtapa" id="idEtapa" value="<c:out value="${requestScope.idEtapa}"/>">
+    <input type="hidden" name="idMaestra" id="idMaestra" value="<c:out value="${requestScope.idMaestra}"/>">
+    <input type="hidden" name="idModulo" id="idModulo">
+    <input type="hidden" name="strComportamiento" id="strComportamiento" value="<c:out value="${requestScope.strComportamiento}"/>">
+    <input type="hidden" name="idActividad" id="idActividad" value="<c:out value="${requestScope.idActividad}"/>">
+    <input type="hidden" name="idFileTMP" id="idFileTMP" value="<c:out value="${requestScope.idFileTMP}" />">
+    <input type="hidden" name="indicadorEnvio" id="indicadorEnvio" value="<c:out value="${requestScope.indicadorEnvio}" />">
+      <table cellpadding="0" cellspacing="0" width="100%">
+        <tr>
+          <td class="tituloopcion">
+            Registro de Documentos
+          </td>
+        </tr>
+        <tr>
+          <td height="4">
+            <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
+          </td>
+        </tr>
+      </table>
+      <table border="0" cellpadding="0" cellspacing="2" width="99.5%" align="center" >
+        <tr>
+          <td>
+            <table border="1" cellpadding="0" cellspacing="0" width="100%" align="center" class="frame">
+              <tr>
+                <td height="20" align="center">
+                  <table width="100%" cellpadding="0" cellspacing="0" border="0">
+                    <tr>
+                      <td align="left" colspan="4" valign="middle">
+                      <div id="botonesRegistroDocumentos" style="display: inline">
+                            <delfinTagHtml:boton nombre="BT_GrabarSeguimiento.gif" onclick="JavaScript:guardarDocumento();" />
+                        </div>
+                        <delfinTagHtml:boton nombre="BT_Salir.gif" onclick="JavaScript:salir();" />
+                      </td>
+                    </tr>
+                  </table>
+                </td>
+              </tr>
+            </table>
+          </td>
+        </tr>
+        <tr>
+          <td height="4">
+            <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
+          </td>
+        </tr>
+        <tr>
+            <td class="tituloframe">DATOS DEL DOCUMENTO</td>
+        </tr>
+        <tr>
+          <td>
+            <table border="2" cellpadding="0" cellspacing="0" width="100%" align="center" class="frame">
+              <tr>
+                <td height="20" align="center">
+                  <table width="99%" cellpadding="0" cellspacing="2" border="0">
+                    <tr>
+                        <td class="etiqueta" align="left" width="140" valign="middle">
+                        Tipo Documento
+                        </td>
+                        <td  width="250">
+                            <select name="cboTipoDocumento" id="cboTipoDocumento" style="width: 100%;" tabindex="4" <%=cboIz%>
+                            onfocus=" nextfield ='textoComentario';">
+                                    <c:forEach var='beanCombo' items='${requestScope.lstTiposDeDocumentos}'>
+                                        <option value="<c:out value='${beanCombo.codigo}'/>" >
+                                            <c:out value='${beanCombo.descripcion}' />
+                                        </option>
+                                     </c:forEach>
+                            </select>
+                        </td>
+                    </tr>
+                    <tr>
+                    <td class="etiqueta" align="left" width="140" valign="middle">
+                        Adjuntar Documento
+                    </td>
+                      <td align="left" valign="middle">
+                            <delfinTagHtml:boton nombre="BT_Subir_P.gif" onclick="JavaScript:adjuntarDocumento();" />
+                      </td>
+                    </tr>
+                    <tr>
+                        <td class="etiqueta" align="left" width="140" valign="middle">
+                        Comentario
+                        </td>
+                        <td > 
+                           <textarea name="textoComentario" id="textoComentario" style="width: 100%;height:70px;"
+                           onfocus="this.select(); field='textoComentario';" <%=campoIz%>
+                           onKeyDown="goblalLimitText('textoComentario','numCarac',1000);" onKeyUp="goblalLimitText('textoComentario','numCarac',1000);"><c:out value="${requestScope.textoComentario}"/></textarea>
+                           <input type="hidden" name="countdown" size="3"  />
+                           <div style="text-align: right;" class="etiqueta">
+                              (Max. <label name="numCarac" id="numCarac"></label>&nbsp;/ 1000)
+                            </div>
+                        </td>
+                    </tr>
+                </table>
+                </td>
+              </tr>
+            </table>
+          </td>
+        </tr>
+      <tr>
+          <td height="4">
+            <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
+          </td>
+        </tr>
+        <tr>
+          <td>
+            <table cellpadding="0" border="0" cellspacing="0" width="100%" align="center">
+              <tr>
+                <td align="center" valign="top" width="100%">
+                  <table width="100%" align="center" cellspacing="0" border="0">
+                    <tr>
+                      <td valign="top">
+                        <table width="100%" cellpadding="0" cellspacing="0" border="0">
+                          <tr>
+                              <td class="tituloframe">DETALLE DE DOCUMENTOS</td>
+                          </tr>
+                          <tr>
+                            <td>
+                              <iframe id="ifrmDetalleDocumentos" name="ifrmDetalleDocumentos" frameborder="0" width="100%" height="170px"  class="frame" src="FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_TABLA.jsp"></iframe>
+                            </td>
+                          </tr>
+                        </table>
+                      </td>
+                    </tr>
+                  </table>
+                  <table width="100%">
+                    <tr>
+                      <td align="right">
+                      <IMG src="<%=request.getContextPath()%>/UTILS/img/PagRe.gif" onClick="pag(-1);" style="CURSOR: hand;vertical-align: middle;" alt="Anterior">
+                      <label id="inicial" style="width:25;text-align:left;font-size:8pt;font-family:Arial;vertical-align: middle;"></label>
+                      <IMG src="<%=request.getContextPath()%>/UTILS/img/t.gif" height=1 width="10">
+                      <label id="final" style="width:25;text-align:right;font-size:8pt;font-family:Arial;vertical-align: middle;"></label>
+                      <IMG src="<%=request.getContextPath()%>/UTILS/img/PagAv.gif" onClick="pag(1)" style="CURSOR: hand;vertical-align: middle;" alt="Siguiente">
+                      <label id="total" style="width:50;text-align:left;font-size:8pt;font-family:Arial;vertical-align: middle;"></label>
+                      </td>
+                    </tr>
+                  </table>
+                </td>
+              </tr>
+            </table>
+          </td>
+        </tr>
+      </table>
+    </form>
+  </body>
+</html>
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_TABLA.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_TABLA.jsp
new file mode 100644
index 0000000..03ca9d3
--- /dev/null
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_TABLA.jsp
@@ -0,0 +1,230 @@
+<!-- CR_T_RegistroDocumentosPorActividades_TABLA.jsp-->
+<%--[Req.S17-022] kdelacruz 07.04.2017 - Implementaci�n WorkFlow Seguimiento Carteral--%>
+
+<jsp:directive.page import="general.utils.Paginacion"/>
+<%
+    String path =request.getContextPath();
+    String myData = request.getAttribute("myData") != null ? (String)request.getAttribute("myData") : "";
+    System.out.println(myData);
+    String hid_pagina = request.getParameter("hid_pagina") != null?request.getParameter("hid_pagina"):"1";  
+    String ini = request.getAttribute("inicio") != null?(String)request.getAttribute("inicio"):"0";
+    String indFin = request.getAttribute("indFin") != null?(String)request.getAttribute("indFin"):"0";
+    String numeroSolicitud = (String)request.getParameter("numeroSolicitud") != null ? (String)request.getParameter("numeroSolicitud") : "";
+%>
+<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %>
+<html>
+<head>  
+    <!-- Invocaci�n de Estilos -->
+    <link id="css" href="<%=request.getContextPath()%>/UTILS/css/DELFIN.css" rel="stylesheet" type="text/css">
+    <!-- Invocaci�n de JavaScript -->
+    <script src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Tabla.js"></script>
+    <script src="<%=request.getContextPath()%>/UTILS/Script/MsgValidacion.js"></script>
+    <script src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Utiles.js"></script>
+    <style>
+        .active-controls-grid {width: "100%"; font: menu;}
+        .active-column-0  {display: none;}
+        .active-column-1  {display: none;}
+        .active-column-2  {display: none;}
+        .active-column-3  {display: none;}
+        .active-column-4  {width: 170px;text-align: left}
+        .active-column-5  {width: 150px;text-align: left;}
+        .active-column-6  {width: 50px;text-align: left;}
+        .active-column-7  {width: 50px;text-align: right;}
+        .active-column-8  {width: 100px;text-align: center;}
+        .active-column-9  {width: 120px;text-align: left;}
+        .active-column-10  {width: 250px;text-align: left;}
+        .active-column-11  {width: 80px;text-align: center;}
+        .active-column-12  {width: 80px;text-align: center;}
+
+        .active-grid-column {border-right: 1px solid threedlightshadow; }
+        .active-grid-row {border-bottom: 1px solid threedlightshadow; }
+    </style>
+</head>
+<body onhelp="getF1()" onLoad="onload();">
+    <script>    
+      var path;
+      function onload(){
+        path = '<%=path%>';
+        if(parent.document.getElementById('hidepage')){
+            parent.loadImages();
+        }
+        setFoco();
+      }
+        var myData= [<c:out value="${requestScope.myData}" escapeXml="false"/>];
+        var myColumns = ["ID Correlativo" //0
+                         , "ID Actividad" //1
+                         , "ID File"//2
+                         , "Codigo Tipo Documento" //3
+                         , "Tipo Documento" //4
+                         , "Nombre Documento" //5
+                         , "Extensi�n" //6
+                         , "Tama�o" //7
+                         , "Fecha Registro" //8
+                         , "Usuario Registro" //9
+                         , "Comentario" //10
+                         , "Descargar" //11
+                         , "Eliminar"];  //12
+
+        //  create ActiveWidgets Grid javascript object
+        var obj = new Active.Controls.Grid;
+
+        obj.setId("obj");
+        // grid header
+        obj.gridColumn = myColumns;
+        // grid data
+        obj.gridData = myData;
+        //  header methods
+        obj.getColumnCount = function() {return this.gridColumn.length};
+        obj.getColumnText = function(i){return this.gridColumn[i]};
+        //  data methods
+        obj.getDataCount = function() {return this.gridData.length};
+        obj.getDataText = function(i, j){return this.gridData[i][j]};
+        obj.setDataText = function(value, i, j){this.gridData[i][j] = value};
+
+        obj.setRowHeaderWidth("28px");
+        obj.setColumnHeaderHeight("20px");
+
+        //var row = new Active.Templates.Row;
+        var row = new Active.Templates.Row;
+        obj.setTemplate('row', row);
+        row.setEvent("ondblclick", function(){this.action("myAction")});    
+        obj.setTemplate("row", row);
+        obj.setAction("myAction", function(src){
+        	consultarDatos();
+        });
+        //Evento Focus de la grilla 
+        obj.setAction("selectionChanged", mySelect);
+
+        //Evento que reconoce la tecla ENTER
+        var defaultEventHandler = obj.getEvent("onkeydown");
+        var myEventHandler = function(event){
+            if(event.keyCode==13){
+
+            }else if(event.keyCode==27){
+                parent.parent.salir();
+                event.returnValue = false;
+            }else if (event.keyCode == 8)event.returnValue = backspace();//Cancela Backspace
+            else if (event.keyCode == 112)parent.ayuda();//F1 ACERCA DE...
+            else if (event.ctrlKey){//Cancela Control
+                event.keyCode = 0;
+                event.returnValue = false; 
+            }else if (window.event && (event.keyCode == 114 || event.keyCode == 116 ||
+                event.keyCode == 117 || event.keyCode == 122)){//Cancela F3,F5,F6 y F11
+                event.keyCode = 505;
+                if(event.keyCode == 505)event.returnValue = false;  
+            }else
+                defaultEventHandler.call(this, event);
+        }
+        obj.setEvent("onkeydown", myEventHandler);
+
+        function mySelect(){
+        }
+
+        var checkbox = new My.Templates.CheckboxLabel;
+        checkbox.setCheckedProperty("true", "Si");
+        checkbox.setCheckedProperty("false", "");
+        obj.setColumnTemplate(checkbox, 0);
+        
+
+        //Pintado de la grilla
+        document.write(obj);
+
+        function devuelveTam(){
+            return myData.length;
+        }
+
+        function setFoco(){
+        }
+        function getTableIndex() {
+            return obj.getProperty("selection/index");
+        }
+        
+        //Numero de filas de las tablas
+        function NumerodeFilas() {
+            return obj.getRowProperty("values").length;
+        }
+        
+      //Devuelve los datos de la fila que se solicita
+        function devuelveFila(){
+            var fila = new Array(myColumns.length);
+            if(myData.length){
+                var index = obj.getSelectionProperty("index");
+                for (i=0; i<myColumns.length; i++)
+                    fila[i] = obj.getDataProperty('text', index, i);
+            }
+            return  fila;
+        }
+    
+        var f = parent.document.forms[0];
+        function devuelveTamanio(){
+        }
+        
+        if(myData.length>0)
+            obj.setSelectionIndex(0);
+            
+        //Funciones que anulan el click derecho del mouse
+        document.oncontextmenu=new Function("return false");
+        
+        function NumerodeFilas() {
+            return obj.getRowProperty("values").length;
+        }
+
+        function getTableIndex() {
+            return obj.getProperty("selection/index");
+        }
+
+        function datosPagina(pag){
+            parent.onCargarDetalle(pag);
+        }
+
+        function paginacion(direccion){
+            if(myData.length < 1){
+                return;
+              }
+              var pag = eval("<%=hid_pagina%>")+eval(direccion);
+                  if(direccion == "-1"){
+                     <%if(!ini.equals("0")){%>
+                          datosPagina(pag);
+                     <%}else{%>
+                          alert(m_0060);
+                     <%}%>
+                  }else{
+                     <%if(indFin.equals("0")){%>
+                          datosPagina(pag);
+                     <%}else{%>
+                          alert(m_0061);
+                     <%}%>
+                  }
+            }
+
+        valores();
+        function valores(){
+            <%
+              String comienzo = request.getAttribute("inicio") != null?(String)request.getAttribute("inicio"):"0";
+              String fin = request.getAttribute("fin") != null?(String)request.getAttribute("fin"):"0";
+              String total = request.getAttribute("total") != null?(String)request.getAttribute("total"):"0";
+            %>
+              if(myData.length>0){
+                 parent.inicial.innerHTML = eval(<%=comienzo%>)+1;
+                 parent.final.innerHTML   = <%= fin %>;
+                 parent.total.innerHTML   = "de <%= total %>";
+              }else{
+                 parent.inicial.innerHTML = "";
+                 parent.final.innerHTML   = "";
+                 parent.total.innerHTML   = "";
+              }
+          }
+
+        function consultarDatos() {
+            var filas = NumerodeFilas();
+            if(filas != 0){
+                parent.byID('cboTipoDocumento').value = myData[getTableIndex()][3];
+                parent.byID('textoComentario').value = myData[getTableIndex()][10];
+            }else{
+                return '';
+             }
+        }
+
+    </script>
+</body>
+</html>
\ No newline at end of file
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/datosSeguimiento/CR_T_DatosSeguimiento_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/datosSeguimiento/CR_T_DatosSeguimiento_CNTR.jsp
index bbd15fc..cf3626b 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/datosSeguimiento/CR_T_DatosSeguimiento_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/datosSeguimiento/CR_T_DatosSeguimiento_CNTR.jsp
@@ -57,6 +57,7 @@
             byID('interesDevengado').value = formateador(byID('interesDevengado').value);
           }
 
+        document.onkeydown = keyDown;
         function keyDown(DnEvents){
             k = window.event.keyCode;
             if (k == 13){
@@ -84,11 +85,13 @@
 	                    return false;
 	                }
 	                if(nextfield == "fechaAtencion"){
+	                	byID('fechaAlerta').value=vuelveFecha(byID('fechaAlerta').value);
 	                	cal1.popup();
 	                    eval('document.forms[0].' + nextfield + '.focus()');
 	                    return false;
 	                }
 	                if(nextfield == "montoAlerta"){
+	                	byID('fechaAtencion').value=vuelveFecha(byID('fechaAtencion').value);
 	                	cal2.popup();
 	                    eval('document.forms[0].' + nextfield + '.focus()');
 	                    return false;
@@ -106,6 +109,14 @@
 	                    return false;
 	                }
 	                if(nextfield == "comentario"){
+                        eval('document.forms[0].' + nextfield + '.focus()');
+                        return false;
+                    }
+	                if(nextfield == "tipoProducto"){
+                        eval('document.forms[0].' + nextfield + '.focus()');
+                        return false;
+                    }
+	                if(nextfield == "numeroCredito"){
                         eval('document.forms[0].' + nextfield + '.focus()');
                         return false;
                     }
@@ -138,7 +149,7 @@
             if(event.keyCode == 505)
                 return false;
         }
-        document.onkeydown = keyDown;
+        document.oncontextmenu = function(){return false};
 
         function salir(){
             parent.salir();
@@ -156,6 +167,8 @@
             var fechaAtencion = byID('fechaAtencion').value;
             var montoAlerta = byID('montoAlerta').value;
             var comentario = byID('comentario').value;
+            var numeroCredito = byID('numeroCredito').value;
+            var tipoProducto = byID('tipoProducto').value;
             
             if(isEmpty(nombreAgencia)){
                 frmDatos.nombreAgencia.focus();
@@ -209,6 +222,16 @@
                 alert(m_0001);
                return false;
             }
+            if(isEmpty(numeroCredito)){
+                frmDatos.numeroCredito.focus();
+                alert(m_0001);
+               return false;
+            }
+            if(isEmpty(tipoProducto)){
+                frmDatos.tipoProducto.focus();
+                alert(m_0001);
+               return false;
+            }
             return true;
         }
 
@@ -230,7 +253,6 @@
                     return false;
                 }
             }
-
             var params = serializeForm(byID('frmDatosSeguimiento'));
             params += '&action=PROCESAR';
             params += '&idEvento=' + idEvento;
@@ -245,10 +267,19 @@
                   byID('descripcionEstado').value = descripcionEstado;
                   byID('idMaestra').value = idMaestra;
                   byID('correlativoSeguimiento').value = correlativoSeguimiento;
+                  cargaIndividual(idMaestra);
                   alert(m_8570);
-                  parent.salir();
                 });
               });
+        }
+
+        function cargaIndividual(idMaestra){
+            var params = '?action=MOSTRAR_CONTENEDOR_WORKFLOW';
+            params += '&idMaestra=' + idMaestra;
+            params += '&idModulo=' + byID('idModulo').value;
+            params += '&url=/CR_C_ConsultaSeguimientoCartera_Servlet?action=MOSTRAR_DETALLE';
+            var url = '<%=request.getContextPath()%>/WF_T_Maestra_Servlet' + params;
+            window.top.document.location.replace(url);
         }
 
         function openBusqueda(){
@@ -263,7 +294,7 @@
         }
 
         function insertarPersona(data){
-            f.codigoCliente.value = data[0];
+            byID('codigoCliente').value = data[0];
             f.txtCriterio.value        = data[2];
             document.frmDatosSeguimiento.txtCriterio.focus();
             obtenerAgenciaPorCliente(data[0]);
@@ -279,7 +310,6 @@
             params += '&txtValorBuscar=' + valor;
             params += '&valorAgencia=' + codigoAgencia;
             params += '&tabla=' + nombre;
-            params += '&time=' + (new Date()).getTime();
             window.showModalDialog(url + params ,window,'dialogHeight:330px;dialogWidth:670px;center:yes;help:no;resizable:no;status:no');
        }
 
@@ -322,6 +352,8 @@
                 <input type="hidden" name="idModulo" id="idModulo">
                 <input type="hidden" name="correlativoSeguimiento" id="correlativoSeguimiento" value="<c:out value="${requestScope.beanCRSeguimientoCartera.correlativoSeguimiento}"/>" >
                 <input type="hidden" name="strComportamiento" id="strComportamiento" value="<c:out value="${requestScope.strComportamiento}"/>">
+                <input type="hidden" name="codigoCliente" id="codigoCliente" value="<c:out value="${beanCRSeguimientoCartera.codigoCliente}"/>" >
+      <input type="hidden" name="tipoPersona" id="tipoPersona" value="<c:out value="${beanCRSeguimientoCartera.tipoPersona}"/>" >
             </td>
         </tr>
         <tr>
@@ -342,16 +374,16 @@
                        <img  src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif" style="cursor: hand" border=0 onclick="if(!byID('txtCriterio').readOnly){openBusqueda();};">
                     </td>
 
-                     <td class="etiqueta" align="left" valign="middle" width="10%">
-                         Fecha Atencion
-                     </td>
-                     <td class="etiqueta" align="left" valign="middle" width="40%"> 
-                        <input name="fechaAtencion" style="width: 75%" <%=campoCe%> tabindex="1" 
-                        value="<c:out value='${requestScope.beanCRSeguimientoCartera.fechaAtencion}' />"
-                        onkeypress="valida_especiales(this.value,'fecha')" maxlength="10" onblur="this.value=vuelveFecha(this.value);if(!esFecha(this.value)) {alert(m_0006);this.focus();return false;}"
-                        onfocus="this.select(); field='fechaAtencion'; nextfield ='montoAlerta';"/>
-                        <img id="imgFecha" style="cursor:hand" title="Seleccionar Fecha" width="16px" height="16px" src="<%=request.getContextPath()%>/UTILS/img/cal.gif" onclick="if(!byID('fechaAtencion').readOnly){cal2.popup();};">
-                     </td>
+                     <td class="etiqueta" align="left" valign="middle" width="100">
+                        Monto Alerta
+                    </td>
+
+                    <td class="etiqueta" align="left" valign="middle"  width="40%"> 
+                        <input name="montoAlerta" style="width: 80%" <%=campoDe%> tabindex="1" maxlength="10"
+                               value="<c:out value='${requestScope.beanCRSeguimientoCartera.montoAlerta}' />"
+                               onKeyPress="valida_numero(this,'dec')" onblur="this.value=formateador(this.value);"
+                               onfocus="this.select(); field='montoAlerta'; nextfield ='codigoCalificacionSBS';">
+                    </td>
                   </tr>
                   <tr>
                      <td class="etiqueta" align="left" valign="middle" style="padding: 10px 0" width="10%">
@@ -363,15 +395,18 @@
                         onfocus="this.select(); field='codigoAgenciaAsignada'; nextfield ='nombreAsignado';">
                      </td>
 
-                    <td class="etiqueta" align="left" valign="middle" width="100">
-                        Monto Alerta
+                    <td class="etiqueta" align="left" width="100" valign="middle">
+                            Cal. SBS
                     </td>
 
-                    <td width="100" class="etiqueta" align="left" valign="middle"> 
-                        <input name="montoAlerta" style="width: 80%" <%=campoDe%> tabindex="1" maxlength="10"
-                               value="<c:out value='${requestScope.beanCRSeguimientoCartera.montoAlerta}' />"
-                               onKeyPress="valida_numero(this,'dec')" onblur="this.value=formateador(this.value);"
-                               onfocus="this.select(); field='montoAlerta'; nextfield ='codigoCalificacionSBS';">
+                    <td  width="40%">
+                            <select name=codigoCalificacionSBS id="codigoCalificacionSBS" style="width: 80%;" tabindex="4" onfocus="nextfield='tipoProducto'" <%=cboIz%>>
+                              <c:forEach var='beanCombo' items='${requestScope.lstCalificacionSBS}' >
+                                <option value="<c:out value='${beanCombo.codigo}' />" <c:if test="${beanCombo.codigo == beanCRSeguimientoCartera.codigoCalificacionSBS}">selected</c:if> >
+                                  <c:out value='${beanCombo.descripcion}' />
+                                </option>
+                              </c:forEach>
+                            </select>
                     </td>
                   </tr>
                   <tr>
@@ -386,13 +421,13 @@
                          <img  src="<%=request.getContextPath()%>/UTILS/img/Detalle.gif" style="cursor: hand" border=0 onclick="if(!byID('nombreAsignado').readOnly){buscarAsesor();};">
                     </td>
                     
-                    <td class="etiqueta" align="left" width="100" valign="middle">
-                            Cal. SBS
+                    <td class="etiqueta" align="left" valign="middle">
+                            Tipo Producto
                         </td>
-                        <td >
-                            <select name=codigoCalificacionSBS id="codigoCalificacionSBS" style="width: 80%;" tabindex="4" onfocus="nextfield='montoProvision'" <%=cboIz%>>
-                              <c:forEach var='beanCombo' items='${requestScope.lstCalificacionSBS}' >
-                                <option value="<c:out value='${beanCombo.codigo}' />" <c:if test="${indicadorFinanciamiento.codigo == beanCRSeguimientoCartera.codigoCalificacionSBS}">selected</c:if> >
+                        <td  width="40%">
+                            <select name=tipoProducto id="tipoProducto" style="width: 80%;" tabindex="4" onfocus="nextfield='numeroCredito'" <%=cboIz%>>
+                              <c:forEach var='beanCombo' items='${requestScope.lstProductos}' >
+                                <option value="<c:out value='${beanCombo.codigo}' />" <c:if test="${beanCombo.codigo == beanCRSeguimientoCartera.tipoProducto}">selected</c:if> >
                                   <c:out value='${beanCombo.descripcion}' />
                                 </option>
                               </c:forEach>
@@ -414,14 +449,14 @@
                     </td>
 
                     <td class="etiqueta" align="left" valign="middle">
-		                Monto Prov.
-		            </td>
-		            <td > 
-	                     <input name="montoProvision" style="width: 80%" <%=opcionDe%>  tabindex="1" maxlength="10" 
-		                 value="<c:out value='${requestScope.beanCRSeguimientoCartera.montoProvision}' />"
-		                 onKeyPress="valida_numero(this,'dec')" maxlength="14" onblur="this.value=formateador(this.value);"
-		                 onfocus="this.select(); field='montoProvision'; nextfield ='interesDevengado';">
-		             </td>
+                        N�mero de Cr�dito
+                    </td>
+                    <td  width="40%"> 
+                         <input id="numeroCredito" name="numeroCredito" style="width: 80%" <%=campoIz%>  tabindex="1"
+                         value="<c:out value='${requestScope.beanCRSeguimientoCartera.numeroCredito}' />"
+                         onKeyPress="valida_numero(this,'dec')" maxlength="15"
+                         onfocus="this.select(); field='montoProvision'; nextfield ='montoProvision';">
+                     </td>
                   </tr>
                   <tr>
                     <td class="etiqueta" align="left" valign="middle" style="padding: 10px 0">
@@ -429,17 +464,39 @@
                     </td>
                     <td> 
                        <input name="fechaAlerta" style="width: 75%" <%=campoCe%> tabindex="1" value="<c:out value='${requestScope.beanCRSeguimientoCartera.fechaAlerta}' />"
-                        onkeypress="valida_especiales(this.value,'fecha')" maxlength="10" onblur="this.value=vuelveFecha(this.value);if(!esFecha(this.value)) {alert(m_0006);this.focus();return false;}"
+                        maxlength="10" onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAlerta');"
                         onfocus="this.select(); field='fechaAlerta'; nextfield ='fechaAtencion';"/>
                         <img id="imgFecha" style="cursor:hand" title="Seleccionar Fecha" width="16px" height="16px" src="<%=request.getContextPath()%>/UTILS/img/cal.gif" onclick="if(!byID('fechaAlerta').readOnly){cal1.popup();};">
                      </td>
                     </td>
 
+                    <td class="etiqueta" align="left" valign="middle">
+                        Monto Prov.
+                    </td>
+                    <td  width="40%"> 
+                         <input name="montoProvision" style="width: 80%" <%=opcionDe%>  tabindex="1" maxlength="10" 
+                         value="<c:out value='${requestScope.beanCRSeguimientoCartera.montoProvision}' />"
+                         onKeyPress="valida_numero(this,'dec')" maxlength="14" onblur="this.value=formateador(this.value);"
+                         onfocus="this.select(); field='montoProvision'; nextfield ='interesDevengado';">
+                     </td>
+                  </tr>
+                  <tr>
+                       <td class="etiqueta" align="left" valign="middle" style="padding: 10px 0">
+                         Fecha Atencion
+                     </td>
+                     <td class="etiqueta" align="left" valign="middle"> 
+                        <input name="fechaAtencion" style="width: 75%" <%=campoCe%> tabindex="1" 
+                        value="<c:out value='${requestScope.beanCRSeguimientoCartera.fechaAtencion}' />"
+                        maxlength="10" onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAtencion');"
+                        onfocus="this.select(); field='fechaAtencion'; nextfield ='montoAlerta';"/>
+                        <img id="imgFecha" style="cursor:hand" title="Seleccionar Fecha" width="16px" height="16px" src="<%=request.getContextPath()%>/UTILS/img/cal.gif" onclick="if(!byID('fechaAtencion').readOnly){cal2.popup();};">
+                     </td>
+                     
                     <td class="etiqueta" align="left" valign="middle" width="100">
                        Int. Devengado
                     </td>
-                    <td class="etiqueta" align="left" valign="middle"> 
-                       <input name="interesDevengado" style="width: 80%" <%=opcionDe%>  tabindex="1" maxlength="10" 
+                    <td class="etiqueta" align="left" valign="middle"  width="40%"> 
+                       <input name="interesDevengado" style="width: 80%" <%=opcionDe%>  tabindex="1" 
                          onKeyPress="valida_numero(this,'dec')"  maxlength="12" onblur="this.value=formateador(this.value);"
                          value="<c:out value='${requestScope.beanCRSeguimientoCartera.interesDevengado}' />"
                          onfocus="this.select(); field='montoProvision'; nextfield ='comentario';">
@@ -450,8 +507,9 @@
                             Estado
 	                    </td>
 	                    <td >
-	                        <input name=descripcionEstado style="width: 80%" class="campodisplayiz" readonly  tabindex="1" value="<c:out value='${requestScope.beanWFMaestra.descripcionEstado}' />"
-	                        onfocus="this.select(); field='descripcionEstado';">
+                     <input id="descripcionEstado" name=descripcionEstado style="width: 80%" class="campodisplayiz" readonly  tabindex="1" 
+                     value="<c:out value='${requestScope.beanWFMaestra.descripcionEstado}' />"
+                     onfocus="this.select(); field='descripcionEstado'; nextfield ='montoAlerta';">
 	                    </td>
                  </tr>
                 </table>
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/resolucion/CR_C_Resolucion_CNTR.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/resolucion/CR_C_Resolucion_CNTR.jsp
index 12da6b0..8149479 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/resolucion/CR_C_Resolucion_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/seguimientoCartera/etapa/resolucion/CR_C_Resolucion_CNTR.jsp
@@ -18,6 +18,7 @@
     <link id="css" href="${pageContext.request.contextPath}/UTILS/css/DELFIN.css" rel="stylesheet" type="text/css">
     <script src="${pageContext.request.contextPath}/UTILS/Script/MsgValidacion.js"></script>
     <script src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Utiles.js"></script>
+    <script src="<%=request.getContextPath()%>/UTILS/Script/DELFIN-Calendario.js"></script> 
     <script type="text/javascript">
     
         var f = null;
@@ -30,13 +31,12 @@
             f = document.getElementById('frmSolicitudEstudioTitulo');
             path = '<%=request.getContextPath()%>';
             mensajeRespuesta('<c:out value="${codigoError}" />', '<c:out value="${mensajeError}" />');
-            onCargarDetalle();
             setMotivoPorRespuesta();
             mostrarFecha();
-            goblalLimitText('textoComentario','numCarac',200);
+            goblalLimitText('textoComentario','numCarac',1000);
             if('<%=strComportamiento%>' != '<%=Constante.COMPORTAMIENTO_TRANSACCIONAL%>'){
-            	byID('tipoMotivo').className = "campodisplayiz";
-            	byID('tipoMotivo').disabled = true;
+            	byID('codigoMotivo').className = "campodisplayiz";
+            	byID('codigoMotivo').disabled = true;
             }
         }
 
@@ -46,15 +46,18 @@
             cal1.time_comp = false;
             }
 
+        document.onkeydown = keyDown;
         function keyDown(DnEvents){
             k = window.event.keyCode;
             if (k == 13){
             	if(nextfield == "idTipoRespuesta"){
+            		byID('fechaAtencion').value=vuelveFecha(byID('fechaAtencion').value);
+            		cal1.popup();
             	    eval('document.forms[0].' + nextfield + '.focus()');
             	    return false;
             	}
             	if(nextfield == "tipoMotivo"){
-            	    eval('document.forms[0].' + nextfield + '.focus()');
+            		eval('document.forms[0].' + nextfield + '.focus()');
             	    return false;
             	}
             	if(nextfield == "fechaAtencion"){
@@ -90,17 +93,18 @@
                 return false;
         }
         document.onkeydown = keyDown;
+        document.oncontextmenu = function(){return false};
 
         function salir(){
         	parent.salir();
         }
-
+        
         function onCargarDetalle() {
         }
 
 	    function validaSustento(){
-	        goblalLimitText('textoComentario','numCarac',200);
-	        if (byID('textoComentario').value.length > 200){
+	        goblalLimitText('textoComentario','numCarac',1000);
+	        if (byID('textoComentario').value.length > 1000){
 	            return false;
 	        }
 	        return true;
@@ -109,7 +113,7 @@
 	    function validar(){
 	    	var frmDatos = document.frmResolucionSeguimientoCartera;
             var textoComentario = byID('textoComentario').value;
-            var tipoMotivo = byID('tipoMotivo').value;
+            var tipoMotivo = byID('codigoMotivo').value;
             var idTipoRespuesta = byID('idTipoRespuesta').value;
             var fechaAtencion = byID('fechaAtencion').value;
 
@@ -139,7 +143,7 @@
 	    function procesarEvento(idEvento){
 	    	strComportamiento = byID('strComportamiento').value;
 	    	var idTipoRespuesta = byID('idTipoRespuesta').value;
-	    	var tipoMotivo = byID('tipoMotivo').value;
+	    	var tipoMotivo = byID('codigoMotivo').value;
             if(strComportamiento != '<%=Constante.WF_COMPORTAMIENTO_TRANSACCIONAL%>'){
                 alert(m_10120);
                 return false;
@@ -168,9 +172,9 @@
 	        var url =  path + "/CR_C_Resolucion_Servlet";
 	        var params = "?action=CARGA_COMBO_DINAMICO_MOTIVO";
 	        params += "&idTipoRespuesta=" + idTipoRespuesta;
+	        params += '&idTipoMotivo=<c:out value="${beanCRSeguimientoCartera.codigoMotivo}" />';
 	        params += "&idEtapa=" + byID('idEtapa').value;
 	        params += "&time=" + new Date().getTime();
-	        
 	        ajaxRequestGET(url + params, false, function(xmldoc) {
 	          mensajeRespuestaXML(xmldoc, function(){
 	            var contenedor = byID('contenedorTipoMotivoPorRespuesta');
@@ -184,7 +188,7 @@
 
 	    function mostrarFecha(){
 
-	    	var idTipoMotivo = byID('tipoMotivo').value;
+	    	var idTipoMotivo = byID('codigoMotivo').value;
             var url =  path + "/CR_C_Resolucion_Servlet";
             var params = "?action=CONSULTA_FECHA_MOTIVO";
             params += "&idTipoMotivo=" + idTipoMotivo;
@@ -193,10 +197,11 @@
             ajaxRequestGET(url + params, false, function(xmldoc) {
               mensajeRespuestaXML(xmldoc, function(){
                 var indicadorFechaMotivo = getValor(xmldoc, 'indicadorFechaMotivo');
-
+                byID('indicadorFechaMotivo').value = indicadorFechaMotivo;
                 if(indicadorFechaMotivo == '<%=Constante.CODIGO_TIPO_MOTIVO_AMPLIACION_ATENCION%>'){
                     byID('mostrarFechaAtencion').style.visibility = "visible";
                     byID('mostrarFechaAtencion1').style.visibility = "visible";
+                    iniciarCalendario();
                 }else{
                     byID('mostrarFechaAtencion').style.visibility = "hidden";
                     byID('mostrarFechaAtencion1').style.visibility = "hidden";
@@ -209,11 +214,14 @@
   </head>
   <body onhelp="getF1();" class="colorbody" onload="cargar();" style="padding: 0px, 0px, 0px, 0px;overflow:auto;">
     <form name="frmResolucionSeguimientoCartera" id="frmResolucionSeguimientoCartera" method="post">
+    <input type="hidden" name="indicadorFechaMotivo" id="indicadorFechaMotivo">
     <input type="hidden" name="idEtapa" id="idEtapa" value="<c:out value="${requestScope.idEtapa}"/>">
     <input type="hidden" name="idMaestra" id="idMaestra">
     <input type="hidden" name="idModulo" id="idModulo" >
     <input type="hidden" name="correlativoSeguimiento" id="correlativoSeguimiento" value="<c:out value="${beanCRSeguimientoCartera.correlativoSeguimiento}"/>" >
     <input type="hidden" name="strComportamiento" id="strComportamiento" value="<c:out value="${requestScope.strComportamiento}"/>">
+    <input type="hidden" name="codigoCliente" id="codigoCliente" value="<c:out value="${beanCRSeguimientoCartera.codigoCliente}"/>" >
+    <input type="hidden" name="tipoPersona" id="tipoPersona" value="<c:out value="${beanCRSeguimientoCartera.tipoPersona}"/>" >
       <table border="0" cellpadding="0" cellspacing="2" width="99.5%" align="center" >
         <tr>
           <td height="4">
@@ -222,7 +230,7 @@
         </tr>
         <tr>
             <td class="tituloframe">
-                DETALLE
+                DATOS DE RESPUESTA
                 <input type="hidden" name="idEtapa" id="idEtapa" value="<c:out value="${requestScope.idEtapa}"/>">
                 <input type="hidden" name="idMaestra" id="idMaestra">
                 <input type="hidden" name="idModulo" id="idModulo" >
@@ -240,9 +248,9 @@
                                Respuesta
                            </td>
                            <td style="width: 25%"> 
-                               <select name="idTipoRespuesta" id="idTipoRespuesta" onchange="setMotivoPorRespuesta()" style="width: 120px;" tabindex="4" onfocus=" nextfield='textoComentario'" <%=cboIz%>>
+                               <select name="idTipoRespuesta" id="idTipoRespuesta" onchange="setMotivoPorRespuesta()" style="width: 120px;" tabindex="4"  onfocus="nextfield ='tipoMotivo'" <%=cboIz%> >
                                  <c:forEach var='beanCombo' items='${requestScope.lstTipoRespuesta}'  >
-                                   <option value="<c:out value='${beanCombo.codigo}'/>" <c:if test="${beanCombo.codigo == BeanCRMovimientoPorSeguimiento.idTipoRespuesta}">selected</c:if> >
+                                   <option value="<c:out value='${beanCombo.codigo}'/>" <c:if test="${beanCombo.codigo == beanCRSeguimientoCartera.idTipoRespuesta}">selected</c:if> >
                                      <c:out value='${beanCombo.descripcion}' />
                                    </option>
                                  </c:forEach>
@@ -253,7 +261,7 @@
                            </td>
                            <td style="width: 25%">
                                <div id="contenedorTipoMotivoPorRespuesta">
-                                   <select name="idTipoMotivo" id="idTipoMotivo" style="width: 250px;" tabindex="4" <%=cboIz%> onfocus=" nextfield='textoComentario'" />
+                                   <select name="codigoMotivo" id="codigoMotivo" style="width: 250px;" tabindex="4" <%=cboIz%> onfocus="this.select(); nextfield='textoComentario'" />
                               </div>
                            </td>
                           <td id="mostrarFechaAtencion" class="etiqueta" align="left"  valign="middle" style="width: 10%">
@@ -262,54 +270,36 @@
                            <td id="mostrarFechaAtencion1"  class="etiqueta" align="left" valign="middle" width="40%"> 
                                <input name="fechaAtencion" style="width: 75%" <%=campoCe%> tabindex="1" 
                                value="<c:out value='${requestScope.beanCRSeguimientoCartera.fechaAtencion}'/>"
-                               onkeypress="valida_especiales(this.value,'fecha')" maxlength="10" onblur="this.value=vuelveFecha(this.value);if(!esFecha(this.value)) {alert(m_0006);this.focus();return false;}"
-                               onfocus="this.select(); nextfield ='montoAlerta';"/>
+                               maxlength="10" onBlur="this.value=vuelveFecha(this.value);validarFecha('fechaAtencion');"
+                               onfocus="this.select(); nextfield ='idTipoRespuesta';"/>
                                <img id="imgFecha" style="cursor:hand" title="Seleccionar Fecha" width="16px" height="16px" src="<%=request.getContextPath()%>/UTILS/img/cal.gif" onclick="if(!byID('fechaAtencion').readOnly){cal1.popup();};"/>
                            </td>
                     </tr>
+                    <tr>
+                      <td height="4">
+                        <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
+                      </td>
+                    </tr>
+                     <tr>
+                        <td class="etiqueta" align="left"  valign="middle" style="width: 3%;padding: 0 0 30px 0" >
+                            Comentarios
+                        </td>
+                        <td colspan="5"> 
+                            <textarea name="textoComentario" id="textoComentario" style="width: 100%;height:70px;"
+                            onfocus="this.select(); field='textoComentario';" <%=campoIz%>
+                            onKeyDown="goblalLimitText('textoComentario','numCarac', 1000);" onKeyUp="goblalLimitText('textoComentario','numCarac',1000);"><c:out value="${requestScope.textoComentario}"/></textarea>
+                            <input type="hidden" name="countdown" size="3" readonly />
+                            <div style="text-align: right;" class="etiqueta">
+                               (Max. <label name="numCarac" id="numCarac"></label>&nbsp;/ 1000)
+                             </div>
+                         </td>
+                     </tr>
 	                </table>
 	                </td>
 	              </tr>
 	            </table>
 	          </td>
 		      </tr>
-              <tr>
-		          <td height="4">
-		            <img src="<%=request.getContextPath()%>/UTILS/img/t.gif" width="1" height="2">
-		          </td>
-		        </tr>
-		        <tr>
-		          <td>
-		            <table cellpadding="0" border="0" cellspacing="0" width="100%" align="center">
-		              <tr>
-		                <td align="center" valign="top" width="100%">
-		                  <table width="100%" align="center" cellspacing="0" border="0">
-		                    <tr>
-		                      <td valign="top">
-		                        <table width="100%" cellpadding="0" cellspacing="0" border="0">
-		                          <tr>
-		                              <td class="tituloframe">COMENTARIOS</td>
-		                          </tr>
-		                          <tr>
-		                             <td > 
-		                                 <textarea name="textoComentario" id="textoComentario" style="width: 100%;height:70px;"
-		                                 onfocus="this.select(); field='textoComentario';" <%=campoIz%>
-		                                 onKeyDown="goblalLimitText('textoComentario','numCarac',200);" onKeyUp="goblalLimitText('textoComentario','numCarac',200);"><c:out value="${requestScope.textoComentario}"/></textarea>
-		                                 <input type="hidden" name="countdown" size="3" readonly />
-		                                 <div style="text-align: right;" class="etiqueta">
-		                                    (Max. <label name="numCarac" id="numCarac"></label>&nbsp;/ 200)
-		                                  </div>
-		                              </td>
-		                          </tr>
-		                        </table>
-		                      </td>
-		                    </tr>
-		                  </table>
-		                </td>
-		              </tr>
-		            </table>
-		          </td>
-		        </tr>
             </table>
           </td>
         </tr>
diff --git a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/tipoDocumento/WF_T_TipoDocumento_TABLA.jsp b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/tipoDocumento/WF_T_TipoDocumento_TABLA.jsp
index 88c818d..82adfcf 100644
--- a/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/tipoDocumento/WF_T_TipoDocumento_TABLA.jsp
+++ b/DELFINWEBNEW/WebRoot/FINANCIERO/workflow/tipoDocumento/WF_T_TipoDocumento_TABLA.jsp
@@ -162,15 +162,7 @@
           }
           setFoco();
 
-          if(NumerodeFilas()<=0){
-              parent.byID('trDocumento1').style.display='none';
-              parent.byID('trDocumento2').style.display='none';
-          }else{
-              parent.byID('trDocumento1').style.display='block';
-              parent.byID('trDocumento2').style.display='block';
-          }
 
-          mostrarAdjuntarEnCheckeados();
         }
 
         function obtenerIdsWorkflow(){
diff --git a/DELFINWEBNEW/WebRoot/GENERAL/menuInformacion/GE_C_MenuInformacion_CNTR.jsp b/DELFINWEBNEW/WebRoot/GENERAL/menuInformacion/GE_C_MenuInformacion_CNTR.jsp
index 59f871c..a5aa627 100644
--- a/DELFINWEBNEW/WebRoot/GENERAL/menuInformacion/GE_C_MenuInformacion_CNTR.jsp
+++ b/DELFINWEBNEW/WebRoot/GENERAL/menuInformacion/GE_C_MenuInformacion_CNTR.jsp
@@ -140,6 +140,54 @@
           window.showModalDialog(url + params,window,prop); 
       }
       //Fin [Req.16-043]
+      
+      //Inicio [Req.S17-022] kdelacruz 18.04.2017
+      function perfilCliente(val){
+    	  var iframeValueCodigoPersona = "dialogArguments.ifrm_" + dialogArguments.byID('idEtapaPendiente').value + ".byID('codigoCliente').value";
+        var codigoCliente="";
+        codigoCliente = eval(iframeValueCodigoPersona);
+    
+        if (codigoCliente=="") return;
+        var myDate = new Date();
+        var url= "<%=request.getContextPath()%>/CL_C_PerfilCliente_Servlet?salir=N&strCodCli="+codigoCliente+"&modificarPerfil=N"+"&referrer=/DELFINWEBNEW/GENERAL/Menu.jsp&time="+myDate.getTime() ; 
+            var prop = "dialogHeight:600px;dialogWidth:800px;center:yes;help:no;resizable:no;status:no";
+        window.showModalDialog(url,window,prop);
+      }
+
+      function miDatosTitularSeguimientoCartera(){
+          var iframeValueCodigoPersona = "dialogArguments.ifrm_" + dialogArguments.byID('idEtapaPendiente').value + ".byID('codigoCliente').value";
+          var iframeValueTipoPersona = "dialogArguments.ifrm_" + dialogArguments.byID('idEtapaPendiente').value + ".byID('tipoPersona').value";
+
+          var codigoCliente = eval(iframeValueCodigoPersona);
+          var tipoPersona = eval(iframeValueTipoPersona);
+          if(!isDefined(iframeValueCodigoPersona) || isEmpty(codigoCliente)){
+              return false;
+          }
+          if(!isDefined(iframeValueTipoPersona) || isEmpty(tipoPersona)){
+              return false;
+          }
+          
+          var myDate = new Date().getTime();
+
+          if(tipoPersona == "N") {
+              url = "/DELFINWEBNEW/CL_C_PersonaNatural_Servlet";
+          } else if(tipoPersona == "J") {
+              url = "/DELFINWEBNEW/CL_C_PersonaJuridica_Servlet";
+          }
+          
+          var params ='';
+          params += '?txtCodigoPersona=' + codigoCliente;
+          params += '&condicion=SOCIO';
+          params += '&ifrm=';
+          params += '&txtCodigoSocio=';
+          params += '&strParamComportamiento=C';
+          params += '&referrer=cerrar';
+          params += '&date=' + myDate;
+
+          var prop = 'dialogWidth:805px;dialogHeight:610px;center:yes;dialogLeft:1px;dialogTop:1px;help:no;resizable:no;status:no';
+          window.showModalDialog(url + params, window, prop);
+      }
+      //Fin [Req.S17-022]
 
     </script>
   </head>
diff --git a/DELFINWEBNEW/WebRoot/REPORTES/RG00004.jasper b/DELFINWEBNEW/WebRoot/REPORTES/RG00004.jasper
new file mode 100644
index 0000000..6f337fa
--- /dev/null
+++ b/DELFINWEBNEW/WebRoot/REPORTES/RG00004.jasper
Binary files differ
diff --git a/DELFINWEBNEW/WebRoot/REPORTES/RG00004A.jasper b/DELFINWEBNEW/WebRoot/REPORTES/RG00004A.jasper
new file mode 100644
index 0000000..4b9af98
--- /dev/null
+++ b/DELFINWEBNEW/WebRoot/REPORTES/RG00004A.jasper
Binary files differ
diff --git a/DELFINWEBNEW/WebRoot/UTILS/Script/MsgValidacion.js b/DELFINWEBNEW/WebRoot/UTILS/Script/MsgValidacion.js
index cc1f14f..3b70415 100644
--- a/DELFINWEBNEW/WebRoot/UTILS/Script/MsgValidacion.js
+++ b/DELFINWEBNEW/WebRoot/UTILS/Script/MsgValidacion.js
@@ -1463,8 +1463,10 @@
 
 //Inicio [Req.S17-022] kdelacruz 04.04.2017
 var m_10127 = 'Se debe registrar el Seguimiento';
-var m_10128 = 'La actividad ya fue enviado';
+var m_10128 = 'La actividad ya fue enviada';
 var m_10131 = '�Est� seguro de continuar con el Proceso?';
+var m_10133 = 'Debe grabar primero la actividad';
+var m_10136 = 'Debe adjuntar un archivo';
 //Fin [Req.S17-022]
 
 //Inicio [Req.17-018] acnunez 28.03.2017
diff --git a/DELFINWEBNEW/WebRoot/UTILS/img/ico_delete.png b/DELFINWEBNEW/WebRoot/UTILS/img/ico_delete.png
new file mode 100644
index 0000000..af1e2f5
--- /dev/null
+++ b/DELFINWEBNEW/WebRoot/UTILS/img/ico_delete.png
Binary files differ
diff --git a/DELFINWEBNEW/WebRoot/WEB-INF/web.xml b/DELFINWEBNEW/WebRoot/WEB-INF/web.xml
index f42ceb1..497b3fb 100644
--- a/DELFINWEBNEW/WebRoot/WEB-INF/web.xml
+++ b/DELFINWEBNEW/WebRoot/WEB-INF/web.xml
@@ -24753,7 +24753,7 @@
         <servlet-name>CR_T_DatosSeguimiento_Servlet</servlet-name>
         <url-pattern>/CR_T_DatosSeguimiento_Servlet</url-pattern>
     </servlet-mapping>
-    
+
     <servlet>
         <display-name>CR_C_RegistroActividades_Servlet</display-name>
         <servlet-name>CR_C_RegistroActividades_Servlet</servlet-name>
@@ -24763,7 +24763,7 @@
         <servlet-name>CR_C_RegistroActividades_Servlet</servlet-name>
         <url-pattern>/CR_C_RegistroActividades_Servlet</url-pattern>
     </servlet-mapping>
-    
+
     <servlet>
         <display-name>CR_T_RegistroActividades_Servlet</display-name>
         <servlet-name>CR_T_RegistroActividades_Servlet</servlet-name>
@@ -24773,7 +24773,7 @@
         <servlet-name>CR_T_RegistroActividades_Servlet</servlet-name>
         <url-pattern>/CR_T_RegistroActividades_Servlet</url-pattern>
     </servlet-mapping>
-    
+
     <servlet>
         <display-name>CR_C_Resolucion_Servlet</display-name>
         <servlet-name>CR_C_Resolucion_Servlet</servlet-name>
@@ -24783,6 +24783,16 @@
         <servlet-name>CR_C_Resolucion_Servlet</servlet-name>
         <url-pattern>/CR_C_Resolucion_Servlet</url-pattern>
     </servlet-mapping>
+
+    <servlet>
+        <display-name>CR_T_DocumentosPorActividades_Servlet</display-name>
+        <servlet-name>CR_T_DocumentosPorActividades_Servlet</servlet-name>
+        <servlet-class>financ.workflow.seguimientoCartera.servlets.CR_T_DocumentosPorActividades_Servlet</servlet-class>
+    </servlet>
+    <servlet-mapping>
+        <servlet-name>CR_T_DocumentosPorActividades_Servlet</servlet-name>
+        <url-pattern>/CR_T_DocumentosPorActividades_Servlet</url-pattern>
+    </servlet-mapping>
     <!-- Fin [Req.S17-022] -->
 
     <!-- Inicio [CC17-044] agarcia 29.03.2017 -->
diff --git a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_ConsultaSeguimientoCartera_Servlet.java b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_ConsultaSeguimientoCartera_Servlet.java
index 0ac4501..8d297a8 100644
--- a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_ConsultaSeguimientoCartera_Servlet.java
+++ b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_ConsultaSeguimientoCartera_Servlet.java
@@ -18,9 +18,11 @@
 import general.servlets.GE_BaseMethodInvocation_Servlet;
 
 import java.util.ArrayList;
+import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 
+import net.sf.jasperreports.engine.JRParameter;
 import pe.com.tfc.utils.GenericBean;
 import pe.com.tfc.utils.RequestMapping;
 import pe.com.tfc.utils.ResponseType;
@@ -54,6 +56,7 @@
     private CRSeguimientoCarteraFacadeInterfaceLocal crDetalleSeguimientoFacadeInterfaceLocal;
     private CRTipoAlertaFacadeInterfaceLocal crTipoAlertaFacadeInterfaceLocal;
     private SSMenuOpcionRolFacadeInterfaceLocal ssMenuOpcionRolFacadeInterfaceLocal;
+    
 
     protected void initEJBs() throws Exception {
         wfEstadoFacadeInterfaceLocal = lookup(WFEstadoFacade.LocalJNDIName);
@@ -85,27 +88,50 @@
         listTipoAlertaFinal.add(new BeanCombo("", "TODOS", "TODOS"));
         listTipoAlertaFinal.addAll(listTipoAlerta);
 
+        List<admin.util.BeanCombo> listTipoProducto = utilAdminFacadeInterfaceLocal.lstDataCatalogo("CRDSGCA",
+                                                                                                    "C_TIPPRO");
+        List<admin.util.BeanCombo> listTipoProductoFinal = new ArrayList<admin.util.BeanCombo>(0);
+        listTipoProductoFinal.add(new admin.util.BeanCombo("", "TODOS", "TODOS"));
+        listTipoProductoFinal.addAll(listTipoProducto);
+
         String indicadorPermisoConsulta = ssMenuOpcionRolFacadeInterfaceLocal.validarPermisoMenuOpcion("WF_SEG_CAR_CON",
                                                                                                        getBeanParametrosAuditoria(servletParams));
-        indicadorPermisoConsulta = _equiv(indicadorPermisoConsulta, "1") ? "S" : "N";
+        indicadorPermisoConsulta = _equiv(indicadorPermisoConsulta,
+                                          "1") ? Constante.ESTADO_REGISTRO_VIGENTE : Constante.ESTADO_REGISTRO_NOVIGENTE;
+
+        String indicadorPermisoConsultaGyS = ssMenuOpcionRolFacadeInterfaceLocal.validarPermisoMenuOpcion("WF_SEG_CAR_CON_GYS",
+                                                                                                          getBeanParametrosAuditoria(servletParams));
+        indicadorPermisoConsultaGyS = _equiv(indicadorPermisoConsultaGyS,
+                                             "1") ? Constante.ESTADO_REGISTRO_VIGENTE : Constante.ESTADO_REGISTRO_NOVIGENTE;
+
+        List<BeanWFEstado> listBeanWFEstado = wfEstadoFacadeInterfaceLocal.listarCboEstado(idModulo,
+                                                                                           beanParametrosAuditoria);
+        List<BeanWFEstado> listBeanWFEstadoFinal = new ArrayList<BeanWFEstado>(0);
+        for (BeanWFEstado beanWFEstado : listBeanWFEstado) {
+            if (!_equiv(Constante.ESTADO_REGISTRO_VIGENTE,
+                        indicadorPermisoConsultaGyS) && _inList(beanWFEstado.getKeyEstado(),
+                                                                "REGISTRADO_SEG_CARTERA",
+                                                                "ANULADO_SEG_CARTERA")) {
+                continue;
+            }
+            listBeanWFEstadoFinal.add(beanWFEstado);
+        }
 
         String indicadorGerenteZonal = utilAdminFacadeInterfaceLocal.validarGerenteZonal(codigoUsuario,
                                                                                          beanParametrosAuditoria);
         String indicadorGerenteAgencia = utilAdminFacadeInterfaceLocal.validarGerenteAgencia(codigoUsuario,
                                                                                              beanParametrosAuditoria);
 
-        List<BeanWFEstado> listBeanWFEstado = wfEstadoFacadeInterfaceLocal.listarCboEstado(idModulo,
-                                                                                           beanParametrosAuditoria);
-
         List<BeanWFEtapa> listBeanWFEtapa = wfEtapaFacadeInterfaceLocal.listarTodasEtapa(idModulo,
                                                                                          beanParametrosAuditoria);
 
         BeanCBAgencia beanCBAgencia = utilAdminFacadeInterfaceLocal.obtenerAgenciaPorCodigo(Constante.ID_TFC,
                                                                                             codigoAgencia,
-                                                                                            getBeanParametrosAuditoria(servletParams));
+                                                                                            beanParametrosAuditoria);
 
         BeanCBUsuarios beanCBUsuarios = cbUsuarioFacadeLocal.findByCodigo(codigoAsesor);
 
+        String fechaProcesoInicio = FormatoFecha.dateToStringDDMMYYYYY(FormatoFecha.getPrimerDiaDelMes(FormatoFecha.stringToUtilDate(fechaProceso)));
         String fechaProcesoFin = FormatoFecha.dateToStringDDMMYYYYY(FormatoFecha.getUltimoDiaDelMes(FormatoFecha.stringToUtilDate(fechaProceso)));
 
         setRequestAttribute(servletParams, "indicadorPermisoConsulta", indicadorPermisoConsulta);
@@ -115,12 +141,13 @@
         setRequestAttribute(servletParams, "descripcionAgencia", beanCBAgencia.getDescripcion());
         setRequestAttribute(servletParams, "codigoAsesor", codigoAsesor);
         setRequestAttribute(servletParams, "descripcionAsesor", beanCBUsuarios.getNombreCompleto());
-        setRequestAttribute(servletParams, "fechaProcesoInicio", fechaProceso);
+        setRequestAttribute(servletParams, "fechaProcesoInicio", fechaProcesoInicio);
         setRequestAttribute(servletParams, "fechaProcesoFin", fechaProcesoFin);
 
+        setRequestAttribute(servletParams, "listTipoProducto", listTipoProductoFinal);
         setRequestAttribute(servletParams, "listTipoAlerta", listTipoAlertaFinal);
         setRequestAttribute(servletParams, "listBeanWFEtapa", listBeanWFEtapa);
-        setRequestAttribute(servletParams, "listBeanWFEstado", listBeanWFEstado);
+        setRequestAttribute(servletParams, "listBeanWFEstado", listBeanWFEstadoFinal);
         setRequestAttribute(servletParams, "idModulo", idModulo);
         forward(servletParams);
     }
@@ -137,6 +164,7 @@
         String codigoAsesor = getParameter(servletParams, "codigoAsesor");
         String codigoCliente = getParameter(servletParams, "codigoCliente");
         String codigoEstado = getParameter(servletParams, "codigoEstado");
+        String codigoTipoProducto = getParameter(servletParams, "codigoTipoProducto");
 
         // Indica si es el final
         String fin = "0";
@@ -164,6 +192,7 @@
         genericBean.addProperty("codigoAsesor", codigoAsesor);
         genericBean.addProperty("codigoCliente", codigoCliente);
         genericBean.addProperty("codigoEstado", codigoEstado);
+        genericBean.addProperty("codigoTipoProducto", codigoTipoProducto);
         genericBean.addProperty("usuarioConsulta", beanParametrosAuditoria.getUsuarioInsercion());
         genericBean.addProperty("pagina", intPagina);
 
@@ -185,10 +214,11 @@
                                "fechaAsignada",
                                "fechaAtencion",
                                "descripcionEstado",
-                               "",
-                               "",
-                               "",
-                               "");
+                               "fechaUltimaActividad",
+                               "comentarioUltimaActividad",
+                               "fechaResolucion",
+                               "comentarioResolucion",
+                               "tiempoTranscurrido");
         }
 
         if (pos_fin + 1 > totalRegistros) {
@@ -205,4 +235,43 @@
 
         forward(servletParams);
     }
+
+    @RequestMapping(value = "REPORTE_BANDEJA_SEGUIMIENTO_CARTERA")
+    private void exportarReporteHojaResumen(final ServletParams servletParams) throws Exception {
+
+        String formatoReporte = getParameter(servletParams, "formatoReporte");
+        String fechaAsignacionInicial = getParameter(servletParams, "fechaAsignacionInicial", "%");
+        String fechaAsignacionFinal = getParameter(servletParams, "fechaAsignacionFinal", "%");
+        String fechaAtencionInicial = getParameter(servletParams, "fechaAtencionInicial", "%");
+        String fechaAtencionFinal = getParameter(servletParams, "fechaAtencionFinal", "%");
+        String codigoTipoAlerta = getParameter(servletParams, "codigoTipoAlerta", "%");
+        String codigoAgencia = getParameter(servletParams, "codigoAgencia", "%");
+        String codigoAsesor = getParameter(servletParams, "codigoAsesor", "%");
+        String codigoCliente = getParameter(servletParams, "codigoCliente", "%");
+        String codigoEstado = getParameter(servletParams, "codigoEstado", "%");
+        String codigoTipoProducto = getParameter(servletParams, "codigoTipoProducto", "%");
+
+        final String archivoJasper = "RG00004.jasper";
+
+        final Map<String, Object> parameters = new HashMap<String, Object>(0);
+
+        parameters.put("fechaAsignacionInicial", fechaAsignacionInicial);
+        parameters.put("fechaAsignacionFinal", fechaAsignacionFinal);
+        parameters.put("fechaAtencionInicial", fechaAtencionInicial);
+        parameters.put("fechaAtencionFinal", fechaAtencionFinal);
+        parameters.put("codigoTipoAlerta", codigoTipoAlerta);
+        parameters.put("codigoAgencia", codigoAgencia);
+        parameters.put("codigoAsesor", codigoAsesor);
+        parameters.put("codigoCliente", codigoCliente);
+        parameters.put("codigoEstado", codigoEstado);
+        parameters.put("codigoTipoProducto", codigoTipoProducto);
+        parameters.put("usuarioConsulta", getBeanParametrosAuditoria(servletParams).getUsuarioInsercion());
+
+        parameters.put(JRParameter.REPORT_LOCALE, admin.util.Constante.LOCALE_REPORTE);
+        if (_equiv(formatoReporte, Constante.TIPO_ARCHIVO_REPORTE_EXCEL)) {
+            parameters.put("IS_IGNORE_PAGINATION", true);
+        }
+
+        exportarJasper(servletParams, archivoJasper, parameters, formatoReporte);
+    }
 }
diff --git a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_RegistroActividades_Servlet.java b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_RegistroActividades_Servlet.java
index 28860b5..cee6745 100644
--- a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_RegistroActividades_Servlet.java
+++ b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_RegistroActividades_Servlet.java
@@ -81,6 +81,7 @@
                                                                                         beanParametrosAuditoria);
 
             beanCRSeguimientoCartera = crSeguimientoCarteraFacadeInterfaceLocal.obtenerSeguimientoCarteraPorIdMaestra(idMaestra,
+                                                                                                                      idEtapa,
                                                                                                                       beanParametrosAuditoria);
 
             beanCRMovimientoPorSeguimiento = crMovimientoPorSeguimientoFacadeInterfaceLocal.listarMovimientoSeguimientoUltimoRegistro(beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
@@ -126,17 +127,38 @@
         listBeanCRActividadSeguimientoCartera = (List<BeanCRActividadSeguimientoCartera>) mapRespuesta.get("listBeanCRActividadSeguimientoCartera");
         totalRegistros = (Long) mapRespuesta.get("cantReg");
 
-        myData = getMyData(listBeanCRActividadSeguimientoCartera,
-                           "correlativoActividad",
-                           "correlativoSeguimiento",
-                           "codigoIndicadorEnvio",
-                           "fechaActividad",
-                           "tipoActividad",
-                           "contactoActividad",
-                           "comentarioActividad",
-                           "indicadorEnvio",
-                           "");
-        setRequestAttribute(servletParams, "myData", myData);
+        String strEnlace = "";
+        String variables = "";
+        BeanCRActividadSeguimientoCartera beanCRActividadSeguimientoCartera;
+        StringBuilder sbMyData = new StringBuilder();
+
+        for (int i = 0; i < listBeanCRActividadSeguimientoCartera.size(); i++) {
+            beanCRActividadSeguimientoCartera = listBeanCRActividadSeguimientoCartera.get(i);
+
+            strEnlace = CADENA_VACIA;
+            variables = "'" + beanCRActividadSeguimientoCartera.getCodigoIndicadorEnvio() + "','" + beanCRActividadSeguimientoCartera.getCorrelativoActividad() + "'";
+            if (!_isEmpty(beanCRActividadSeguimientoCartera.getCorrelativoActividad())) {
+                strEnlace = "<img id='idCargarDocumentos' style='cursor:hand' title='Ver Documentos' width=15 height=15 src='" + servletParams.getRequest().getContextPath() + "/UTILS/img/folder_download.png' onclick=parent.cargarDocumentos(" + variables + ")>";
+            }
+            sbMyData.append("[");
+
+            sbMyData.append("\"" + _toBlankObject(beanCRActividadSeguimientoCartera.getCorrelativoActividad()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRActividadSeguimientoCartera.getCorrelativoSeguimiento()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRActividadSeguimientoCartera.getCodigoIndicadorEnvio()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRActividadSeguimientoCartera.getFechaActividad()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRActividadSeguimientoCartera.getTipoActividad()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRActividadSeguimientoCartera.getContactoActividad()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRActividadSeguimientoCartera.getComentarioActividad()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRActividadSeguimientoCartera.getIndicadorEnvio()) + "\",");
+            sbMyData.append("\"" + strEnlace + "\"");
+
+            sbMyData.append("]");
+
+            if ((i < listBeanCRActividadSeguimientoCartera.size() - 1)) {
+                sbMyData.append(",");
+            }
+        }
+        setRequestAttribute(servletParams, "myData", sbMyData.toString());
 
         if (pos_fin + 1 > totalRegistros) {
             fin = "1";
diff --git a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_Resolucion_Servlet.java b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_Resolucion_Servlet.java
index 8ed4e8a..8dde345 100644
--- a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_Resolucion_Servlet.java
+++ b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_C_Resolucion_Servlet.java
@@ -3,14 +3,17 @@
 import financ.seguimientoCartera.beans.BeanCRMotivoSeguimientoCartera;
 import financ.seguimientoCartera.beans.BeanCRMovimientoPorSeguimiento;
 import financ.seguimientoCartera.beans.BeanCRSeguimientoCartera;
+import financ.seguimientoCartera.facade.CRCargaAlertaFacade;
 import financ.seguimientoCartera.facade.CRMotivoSeguimientoCarteraFacade;
 import financ.seguimientoCartera.facade.CRMovimientoPorSeguimientoFacade;
 import financ.seguimientoCartera.facade.CRSeguimientoCarteraFacade;
+import financ.seguimientoCartera.local.CRCargaAlertaFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRMotivoSeguimientoCarteraFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRMovimientoPorSeguimientoFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRSeguimientoCarteraFacadeInterfaceLocal;
 import financ.util.BeanCombo;
 import financ.util.Constante;
+import financ.util.FormatoFecha;
 import financ.util.local.UtilFacadeIntrefaceLocal;
 import financ.util.session.UtilFacade;
 import financ.workflow.bean.BeanWFMaestra;
@@ -20,9 +23,11 @@
 
 import java.util.List;
 
+import pe.com.tfc.utils.ErrorControladoException;
 import pe.com.tfc.utils.RequestMapping;
 import pe.com.tfc.utils.ResponseType;
 import admin.contab.beans.BeanParametrosAuditoria;
+import admin.util.ConstantesErrores;
 
 /**
  * CR_C_Resolucion_Servlet
@@ -43,6 +48,7 @@
     private CRMovimientoPorSeguimientoFacadeInterfaceLocal crMovimientoPorSeguimientoFacadeInterfaceLocal;
     private UtilFacadeIntrefaceLocal utilFacadeIntrefaceLocal;
     private CRMotivoSeguimientoCarteraFacadeInterfaceLocal crMotivoSeguimientoCarteraFacadeInterfaceLocal;
+    private CRCargaAlertaFacadeInterfaceLocal crCargaAlertaFacadeInterfaceLocal;
 
     protected void initEJBs() throws Exception {
         wfMovimientosFacadeInterfaceLocal = lookup(WFMovimientosFacade.LocalJNDIName);
@@ -50,6 +56,7 @@
         crMovimientoPorSeguimientoFacadeInterfaceLocal = lookup(CRMovimientoPorSeguimientoFacade.LocalJNDIName);
         utilFacadeIntrefaceLocal = lookup(UtilFacade.LocalJNDIName);
         crMotivoSeguimientoCarteraFacadeInterfaceLocal = lookup(CRMotivoSeguimientoCarteraFacade.LocalJNDIName);
+        crCargaAlertaFacadeInterfaceLocal = lookup(CRCargaAlertaFacade.LocalJNDIName);
     }
 
     @Override
@@ -64,6 +71,7 @@
         String idEtapa = getParameter(servletParams, "idEtapa");
         String idTipoMotivo = getParameter(servletParams, "idTipoMotivo");
         String combo = "";
+        System.out.println(idTipoMotivo);
 
         List<BeanCRMotivoSeguimientoCartera> listBeanCRMotivoSeguimientoCartera = crMotivoSeguimientoCarteraFacadeInterfaceLocal.listarPorTipoResputa(idTipoRespuesta,
                                                                                                                                                       idEtapa,
@@ -72,7 +80,7 @@
                                                             "idMotivoSeguimiento",
                                                             "descripcionMotivo");
 
-        combo = armarComboDinamico(listTipoMotivo, "tipoMotivo", "mostrarFecha", "width: 80%;", idTipoMotivo, false);
+        combo = armarComboDinamico(listTipoMotivo, "codigoMotivo", "mostrarFecha", "width: 80%;", idTipoMotivo, false);
         final StringBuilder sbRespuesta = new StringBuilder();
         sbRespuesta.append("<codigoError>" + NO_ERROR + "</codigoError>");
         sbRespuesta.append("<contenedorTipoMotivoPorRespuesta>" + combo + "</contenedorTipoMotivoPorRespuesta>");
@@ -97,6 +105,7 @@
                                                                                                beanParametrosAuditoria);
 
             beanCRSeguimientoCartera = crSeguimientoCarteraFacadeInterfaceLocal.obtenerSeguimientoCarteraPorIdMaestra(idMaestra,
+                                                                                                                      idEtapa,
                                                                                                                       beanParametrosAuditoria);
 
             beanCRMovimientoPorSeguimiento = crMovimientoPorSeguimientoFacadeInterfaceLocal.listarMovimientoSeguimientoUltimoRegistro(beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
@@ -104,8 +113,8 @@
                                                                                                                                       beanParametrosAuditoria);
             setRequestAttribute(servletParams, "textoComentario", textoComentario);
             setRequestAttribute(servletParams, "beanCRMovimientoPorSeguimiento", beanCRMovimientoPorSeguimiento);
-            setRequestAttribute(servletParams, "beanCRSeguimientoCartera", beanCRSeguimientoCartera);
             setRequestAttribute(servletParams, "lstTipoRespuesta", lstTipoRespuesta);
+            setRequestAttribute(servletParams, "beanCRSeguimientoCartera", beanCRSeguimientoCartera);
         }
 
         setRequestAttribute(servletParams, "idEtapa", idEtapa);
@@ -121,9 +130,11 @@
         String textoComentario = getParameter(servletParams, "textoComentario");
         String idMotivoSeguimiento = getParameter(servletParams, "idTipoMotivo");
         String idTipoRespuesta = getParameter(servletParams, "idTipoRespuesta");
-
         BeanCRSeguimientoCartera beanCRSeguimientoCartera = mapearBean(servletParams, BeanCRSeguimientoCartera.class);
 
+        if (!FormatoFecha.stringToDateddMMyyyy(beanCRSeguimientoCartera.getFechaAtencion()).after(beanParametrosAuditoria.getFechaProceso())) {
+            throw new ErrorControladoException(ConstantesErrores.ERROR_11175);
+        }
         crSeguimientoCarteraFacadeInterfaceLocal.procesarResolucion(beanWFMaestra,
                                                                     idEvento,
                                                                     textoComentario,
@@ -136,13 +147,14 @@
         sbRespuesta.append("<codigoError>" + NO_ERROR + "</codigoError>");
         responseXML(servletParams, sbRespuesta.toString());
     }
-    
+
     @RequestMapping(value = "CONSULTA_FECHA_MOTIVO", responseType = ResponseType.XML)
     protected void consultaMotivo(final ServletParams servletParams) throws Exception {
         BeanParametrosAuditoria beanParametrosAuditoria = getBeanParametrosAuditoria(servletParams);
         String idTipoMotivo = getParameter(servletParams, "idTipoMotivo");
 
-        BeanCRMotivoSeguimientoCartera beanCRMotivoSeguimientoCartera = crMotivoSeguimientoCarteraFacadeInterfaceLocal.consultaMotivo(idTipoMotivo, beanParametrosAuditoria);
+        BeanCRMotivoSeguimientoCartera beanCRMotivoSeguimientoCartera = crMotivoSeguimientoCarteraFacadeInterfaceLocal.consultaMotivo(idTipoMotivo,
+                                                                                                                                      beanParametrosAuditoria);
         final StringBuilder sbRespuesta = new StringBuilder();
         sbRespuesta.append("<indicadorFechaMotivo>" + beanCRMotivoSeguimientoCartera.getIndicadorFechaMotivo() + "</indicadorFechaMotivo>");
         sbRespuesta.append("<codigoError>" + NO_ERROR + "</codigoError>");
diff --git a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_DatosSeguimiento_Servlet.java b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_DatosSeguimiento_Servlet.java
index afeadec..6c4e989 100644
--- a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_DatosSeguimiento_Servlet.java
+++ b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_DatosSeguimiento_Servlet.java
@@ -4,8 +4,10 @@
 import financ.creditos.local.CRCuentaCreditoFacadeInterfaceLocal;
 import financ.seguimientoCartera.beans.BeanCRSeguimientoCartera;
 import financ.seguimientoCartera.beans.BeanCRTipoAlerta;
+import financ.seguimientoCartera.facade.CRCargaAlertaFacade;
 import financ.seguimientoCartera.facade.CRSeguimientoCarteraFacade;
 import financ.seguimientoCartera.facade.CRTipoAlertaFacade;
+import financ.seguimientoCartera.local.CRCargaAlertaFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRSeguimientoCarteraFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRTipoAlertaFacadeInterfaceLocal;
 import financ.util.BeanCombo;
@@ -48,6 +50,7 @@
     private WFMovimientosFacadeInterfaceLocal wfMovimientosFacadeInterfaceLocal;
     private CRCuentaCreditoFacadeInterfaceLocal crCuentaCreditoFacadeInterfaceLocal;
     private CBAgenciaInterfaceLocal cbAgenciaInterfaceLocal;
+    private CRCargaAlertaFacadeInterfaceLocal crCargaAlertaFacadeInterfaceLocal;
 
     protected void initEJBs() throws Exception {
         CRSeguimientoCarteraFacadeInterfaceLocal = lookup(CRSeguimientoCarteraFacade.LocalJNDIName);
@@ -56,6 +59,7 @@
         crTipoAlertaFacadeInterfaceLocal = lookup(CRTipoAlertaFacade.LocalJNDIName);
         wfMovimientosFacadeInterfaceLocal = lookup(WFMovimientosFacade.LocalJNDIName);
         crCuentaCreditoFacadeInterfaceLocal = lookup(CRCuentaCreditoFacade.LocalJNDIName);
+        crCargaAlertaFacadeInterfaceLocal = lookup(CRCargaAlertaFacade.LocalJNDIName);
         cbAgenciaInterfaceLocal = lookup("CBAgenciaSession/local");
     }
 
@@ -70,9 +74,12 @@
         BeanParametrosAuditoria beanParametrosAuditoria = getBeanParametrosAuditoria(servletParams);
         String idEtapa = getParameter(servletParams, "idEtapa");
         String idMaestra = getParameter(servletParams, "idMaestra");
-        BeanCRSeguimientoCartera beanCRSeguimientoCartera;
+        BeanCRSeguimientoCartera beanCRSeguimientoCartera = new BeanCRSeguimientoCartera();
+        ;
         String comportamiento = getParameter(servletParams, "comportamiento");
 
+        beanCRSeguimientoCartera.setFechaAlerta(financ.util.FormatoFecha.dateToStringDDMMYYYYY(beanParametrosAuditoria.getFechaProceso()));
+        beanCRSeguimientoCartera.setFechaAtencion(financ.util.FormatoFecha.dateToStringDDMMYYYYY(beanParametrosAuditoria.getFechaProceso()));
         if (!_isEmpty(idMaestra)) {
             String textoComentario = wfMovimientosFacadeInterfaceLocal.obtenerUltimoComentario(idMaestra,
                                                                                                idEtapa,
@@ -82,6 +89,7 @@
                                                                                          beanParametrosAuditoria);
 
             beanCRSeguimientoCartera = CRSeguimientoCarteraFacadeInterfaceLocal.obtenerSeguimientoCarteraPorIdMaestra(idMaestra,
+                                                                                                                      CADENA_VACIA,
                                                                                                                       beanParametrosAuditoria);
 
             setRequestAttribute(servletParams, "textoComentario", textoComentario);
@@ -93,9 +101,14 @@
 
         final List<BeanCombo> lstCalificacionSBS = new ArrayList<BeanCombo>(0);
         lstCalificacionSBS.addAll(utilFacadeIntrefaceLocal.lstCalificacionSBS());
+        
+        List<BeanCombo> lstProductos = utilFacadeIntrefaceLocal.lstDataCatalogo("CRDSGCA",
+                                                                                "C_TIPPRO",
+                                                                                false);
 
         setRequestAttribute(servletParams, "lstCalificacionSBS", lstCalificacionSBS);
         setRequestAttribute(servletParams, "lstBeanCRTipoAlerta", lstBeanCRTipoAlerta);
+        setRequestAttribute(servletParams, "lstProductos", lstProductos);
         setRequestAttribute(servletParams, "idEtapa", idEtapa);
         setRequestAttribute(servletParams, "strComportamiento", comportamiento);
         forward(servletParams);
@@ -108,13 +121,16 @@
         BeanWFMaestra beanWFMaestra = mapearBean(servletParams, BeanWFMaestra.class);
         BeanCRSeguimientoCartera beanCRSeguimientoCartera = mapearBean(servletParams, BeanCRSeguimientoCartera.class);
 
+        crCargaAlertaFacadeInterfaceLocal.validarRegistroCargaIndividual(beanCRSeguimientoCartera,
+                                                                         beanParametrosAuditoria);
+
         String idMaestra = CRSeguimientoCarteraFacadeInterfaceLocal.guardarSeguimientoCartera(beanCRSeguimientoCartera,
                                                                                               beanWFMaestra,
                                                                                               idEvento,
                                                                                               beanCRSeguimientoCartera.getComentario(),
                                                                                               beanParametrosAuditoria);
         beanWFMaestra = wfMaestraFacadeInterfaceLocal.consultarMaestra(idMaestra, beanParametrosAuditoria);
-        beanCRSeguimientoCartera = CRSeguimientoCarteraFacadeInterfaceLocal.obtenerSeguimientoCartera(idMaestra,
+        beanCRSeguimientoCartera = CRSeguimientoCarteraFacadeInterfaceLocal.obtenerSeguimientoCartera(beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
                                                                                                       beanParametrosAuditoria);
 
         final StringBuilder sbRespuesta = new StringBuilder();
diff --git a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_DocumentosPorActividades_Servlet.java b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_DocumentosPorActividades_Servlet.java
new file mode 100644
index 0000000..6228238
--- /dev/null
+++ b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_DocumentosPorActividades_Servlet.java
@@ -0,0 +1,176 @@
+package financ.workflow.seguimientoCartera.servlets;
+
+import financ.seguimientoCartera.beans.BeanCRDocumentosPorActividad;
+import financ.seguimientoCartera.facade.CRDocumentosPorActividadFacade;
+import financ.seguimientoCartera.local.CRDocumentosPorActividadFacadeInterfaceLocal;
+import financ.util.BeanCombo;
+import financ.util.Constante;
+import financ.util.Paginacion;
+import financ.util.local.UtilFacadeIntrefaceLocal;
+import financ.util.session.UtilFacade;
+import general.servlets.GE_BaseMethodInvocation_Servlet;
+
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+
+import pe.com.tfc.utils.RequestMapping;
+import pe.com.tfc.utils.ResponseType;
+import admin.contab.beans.BeanParametrosAuditoria;
+
+/**
+ * CR_T_DocumentosPorActividades_Servlet
+ * 
+ * @author kdelacruz
+ * @since [Req.17-022] 29.03.2017
+ */
+
+public class CR_T_DocumentosPorActividades_Servlet extends GE_BaseMethodInvocation_Servlet {
+
+    /**
+     * 
+     */
+    private static final long serialVersionUID = -8637921303056588610L;
+    private static final String URL_DATOS_DOCUMENTOS_ACTIVIDADES = Constante.RUTA_WORKFLOW + "seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_CNTR.jsp";
+    private static final String UR_TABLA_DETALLE_DOCUMENTOS_ACTIVIDADES = Constante.RUTA_WORKFLOW + "seguimientoCartera/etapa/actividades/CR_T_RegistroDocumentosPorActividades_TABLA.jsp";
+
+    private CRDocumentosPorActividadFacadeInterfaceLocal crDocumentosPorActividadFacadeInterfaceLocal;
+    private UtilFacadeIntrefaceLocal utilFacadeInterfaceLocal;
+
+    protected void initEJBs() throws Exception {
+        crDocumentosPorActividadFacadeInterfaceLocal = lookup(CRDocumentosPorActividadFacade.LocalJNDIName);
+        utilFacadeInterfaceLocal = lookup(UtilFacade.LocalJNDIName);
+    }
+
+    @Override
+    protected void execute(ServletParams servletParams) throws Exception {
+        // TODO Auto-generated method stub
+
+    }
+
+    @RequestMapping(value = "MOSTRAR_DETALLE", responseType = ResponseType.HTML, url = URL_DATOS_DOCUMENTOS_ACTIVIDADES)
+    protected void mostrarDetalle(final ServletParams servletParams) throws Exception {
+        BeanParametrosAuditoria beanParametrosAuditoria = getBeanParametrosAuditoria(servletParams);
+        String idActividad = getParameter(servletParams, "correlativoActividad");
+        String comportamiento = getParameter(servletParams, "comportamiento");
+        String indicadorEnvio = getParameter(servletParams, "indicadorEnvio");
+
+        final List<BeanCombo> lstTiposDeDocumentos = new ArrayList<BeanCombo>(0);
+
+        lstTiposDeDocumentos.addAll(utilFacadeInterfaceLocal.lstComboGenericoByNombreCombo(admin.util.Constante.SEGUIMIENTO_CARTERA_COMBO_GENERICO_TIPO_DOCUMENTO,
+                                                                                           beanParametrosAuditoria));
+
+        setRequestAttribute(servletParams, "strComportamiento", comportamiento);
+        setRequestAttribute(servletParams, "idActividad", idActividad);
+        setRequestAttribute(servletParams, "lstTiposDeDocumentos", lstTiposDeDocumentos);
+        setRequestAttribute(servletParams, "indicadorEnvio", indicadorEnvio);
+
+        forward(servletParams);
+    }
+
+    @RequestMapping(value = "GUARDAR_DOCUMENTO", url = URL_DATOS_DOCUMENTOS_ACTIVIDADES)
+    protected void guardarDocumento(ServletParams servletParams) throws Exception {
+        BeanParametrosAuditoria beanParametrosAuditoria = getBeanParametrosAuditoria(servletParams);
+        String cboTipoDocumento = getParameter(servletParams, "cboTipoDocumento");
+        String textoComentario = getParameter(servletParams, "textoComentario");
+        String idActividad = getParameter(servletParams, "idActividad");
+        String idFileTMP = getParameter(servletParams, "idFileTMP");
+
+        crDocumentosPorActividadFacadeInterfaceLocal.guardarDocumentoPorActividad(idFileTMP,
+                                                                                  idActividad,
+                                                                                  cboTipoDocumento,
+                                                                                  textoComentario,
+                                                                                  beanParametrosAuditoria);
+
+        final StringBuilder sbRespuesta = new StringBuilder();
+        sbRespuesta.append("<codigoError>" + NO_ERROR + "</codigoError>");
+        responseXML(servletParams, sbRespuesta.toString());
+    }
+
+    @RequestMapping(value = "BORRAR_DOCUMENTO", url = URL_DATOS_DOCUMENTOS_ACTIVIDADES)
+    protected void borrarDocumento(ServletParams servletParams) throws Exception {
+        BeanParametrosAuditoria beanParametrosAuditoria = getBeanParametrosAuditoria(servletParams);
+        String idCorrelativo = getParameter(servletParams, "idCorrelativo");
+        String idFile = getParameter(servletParams, "idFile");
+
+        crDocumentosPorActividadFacadeInterfaceLocal.borrarRegistroDocumentoPorActividad(idCorrelativo,
+                                                                                         idFile,
+                                                                                         beanParametrosAuditoria);
+
+        final StringBuilder sbRespuesta = new StringBuilder();
+        sbRespuesta.append("<codigoError>" + NO_ERROR + "</codigoError>");
+        responseXML(servletParams, sbRespuesta.toString());
+    }
+
+    @RequestMapping(value = "CARGAR_DETALLE", responseType = ResponseType.HTML, url = UR_TABLA_DETALLE_DOCUMENTOS_ACTIVIDADES)
+    protected void cargarDetalle(final ServletParams servletParams) throws Exception {
+        BeanParametrosAuditoria beanParametrosAuditoria = getBeanParametrosAuditoria(servletParams);
+        String idActividad = getParameter(servletParams, "idActividad");
+        final String strPagina = getParameter(servletParams, "hid_pagina", "1");
+
+        final int cantReg = Paginacion.NUM_REG;
+        final int intPagina = _toInteger(strPagina);
+        final int pos_ini = (intPagina - 1) * cantReg;
+        int pos_fin = intPagina * cantReg;
+        Long totalRegistros = new Long(0);
+        String fin = "0";
+        String myData = "";
+
+        List<BeanCRDocumentosPorActividad> listBeanCRDocumentosPorActividad;
+
+        final Map<String, Object> mapRespuesta = crDocumentosPorActividadFacadeInterfaceLocal.listarDocumentosPorActividad(idActividad,
+                                                                                                                           _toInteger(strPagina),
+                                                                                                                           beanParametrosAuditoria);
+
+        listBeanCRDocumentosPorActividad = (List<BeanCRDocumentosPorActividad>) mapRespuesta.get("listBeanCRDocumentosPorActividad");
+        totalRegistros = (Long) mapRespuesta.get("cantReg");
+
+        String strEnlace = "";
+        String strEnlace1 = "";
+        BeanCRDocumentosPorActividad beanCRDocumentosPorActividad;
+        StringBuilder sbMyData = new StringBuilder();
+
+        for (int i = 0; i < listBeanCRDocumentosPorActividad.size(); i++) {
+            beanCRDocumentosPorActividad = listBeanCRDocumentosPorActividad.get(i);
+
+            strEnlace = CADENA_VACIA;
+            if (!_isEmpty(beanCRDocumentosPorActividad.getIdFile())) {
+                strEnlace = "<img id='idDescargar' style='cursor:hand' title='Descargar' width=15 height=15 src='" + servletParams.getRequest().getContextPath() + "/UTILS/img/download.png' onclick=downloadFile('" + beanCRDocumentosPorActividad.getIdFile() + "')>";
+                strEnlace1 = "<img id='idEliminar' style='cursor:hand' title='Eliminar' width=15 height=15 src='" + servletParams.getRequest().getContextPath() + "/UTILS/img/ico_delete.png' onclick=parent.borrarArchivo('" + beanCRDocumentosPorActividad.getCorrelativoDocumentoXActividad() + "','" + beanCRDocumentosPorActividad.getIdFile() + "')>";
+            }
+            sbMyData.append("[");
+
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getCorrelativoDocumentoXActividad()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getIdActividad()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getIdFile()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getTipoDocumento()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getDescripcionTipoDocumento()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getNombreFile()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getExtensionFile()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getTamanioFile()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getFechaRegistro()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getUsuarioRegistro()) + "\",");
+            sbMyData.append("\"" + _toBlankObject(beanCRDocumentosPorActividad.getComentarioDocumento()) + "\",");
+            sbMyData.append("\"" + strEnlace + "\",");
+            sbMyData.append("\"" + strEnlace1 + "\"");
+
+            sbMyData.append("]");
+
+            if ((i < listBeanCRDocumentosPorActividad.size() - 1)) {
+                sbMyData.append(",");
+            }
+        }
+
+        if (pos_fin + 1 > totalRegistros) {
+            fin = "1";
+            pos_fin = totalRegistros.intValue();
+        }
+        setRequestAttribute(servletParams, "myData", sbMyData.toString());
+        setRequestAttribute(servletParams, "inicio", _toStr(pos_ini));
+        setRequestAttribute(servletParams, "fin", _toStr(pos_fin));
+        setRequestAttribute(servletParams, "indFin", fin);
+        setRequestAttribute(servletParams, "total", _toStr(totalRegistros));
+        forward(servletParams);
+    }
+
+}
diff --git a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_RegistroActividades_Servlet.java b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_RegistroActividades_Servlet.java
index e4142c7..72e3048 100644
--- a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_RegistroActividades_Servlet.java
+++ b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_RegistroActividades_Servlet.java
@@ -57,6 +57,7 @@
         String idMaestra = getParameter(servletParams, "idMaestra");
         String comportamiento = getParameter(servletParams, "strComportamiento");
         String idActividad = getParameter(servletParams, "idActividad");
+        String indicadorEnvio = getParameter(servletParams, "indicadorEnvio");
 
         if (!_isEmpty(idActividad)) {
             BeanCRActividadSeguimientoCartera beanCRActividadSeguimientoCartera = crActividadSeguimientoCarteraFacadeInterfaceLocal.consultarActividad(idActividad,
@@ -73,6 +74,7 @@
         setRequestAttribute(servletParams, "idMaestra", idMaestra);
         setRequestAttribute(servletParams, "idEtapa", idEtapa);
         setRequestAttribute(servletParams, "strComportamiento", comportamiento);
+        setRequestAttribute(servletParams, "indicadorEnvio", indicadorEnvio);
         forward(servletParams);
     }
 
@@ -83,13 +85,15 @@
                                                                                          BeanCRActividadSeguimientoCartera.class);
         String idMaestra = getParameter(servletParams, "idMaestra");
         BeanCRSeguimientoCartera beanCRSeguimientoCartera = crSeguimientoCarteraFacadeInterfaceLocal.obtenerSeguimientoCarteraPorIdMaestra(idMaestra,
+                                                                                                                                           CADENA_VACIA,
                                                                                                                                            beanParametrosAuditoria);
 
-        crActividadSeguimientoCarteraFacadeInterfaceLocal.registrarActividad(beanCRActividadSeguimientoCartera,
-                                                                             beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
-                                                                             beanParametrosAuditoria);
+        String idActividad = crActividadSeguimientoCarteraFacadeInterfaceLocal.registrarActividad(beanCRActividadSeguimientoCartera,
+                                                                                                  beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
+                                                                                                  beanParametrosAuditoria);
 
         final StringBuilder sbRespuesta = new StringBuilder();
+        sbRespuesta.append("<idActividad>" + idActividad + "</idActividad>");
         sbRespuesta.append("<codigoError>" + NO_ERROR + "</codigoError>");
         responseXML(servletParams, sbRespuesta.toString());
     }
@@ -128,5 +132,4 @@
         sbRespuesta.append("<codigoError>" + NO_ERROR + "</codigoError>");
         responseXML(servletParams, sbRespuesta.toString());
     }
-
 }
diff --git a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_SeguimientoCarteraCargaAlerta_Servlet.java b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_SeguimientoCarteraCargaAlerta_Servlet.java
index 85c00cd..6d5108c 100644
--- a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_SeguimientoCarteraCargaAlerta_Servlet.java
+++ b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_SeguimientoCarteraCargaAlerta_Servlet.java
@@ -55,6 +55,7 @@
         String chkReproceso = getParameter(servletParams, "chkReproceso");
 
         GenericBean genericBean = new GenericBean();
+        
         genericBean.addProperty("fechaProceso", fechaProceso);
         genericBean.addProperty("chkReproceso", chkReproceso);
 
diff --git a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_SeguimientoCarteraDetalleCarga_Servlet.java b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_SeguimientoCarteraDetalleCarga_Servlet.java
index 71faac5..d2947da 100644
--- a/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_SeguimientoCarteraDetalleCarga_Servlet.java
+++ b/DELFINWEBNEW/src/financ/workflow/seguimientoCartera/servlets/CR_T_SeguimientoCarteraDetalleCarga_Servlet.java
@@ -6,9 +6,11 @@
 import financ.seguimientoCartera.facade.CRTipoAlertaFacade;
 import financ.seguimientoCartera.local.CRSeguimientoCarteraFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRTipoAlertaFacadeInterfaceLocal;
+import financ.util.BeanCombo;
 import financ.util.Constante;
 import general.servlets.GE_BaseMethodInvocation_Servlet;
 
+import java.util.ArrayList;
 import java.util.List;
 import java.util.Map;
 
@@ -29,31 +31,39 @@
     private static final long serialVersionUID = 6821785426438159287L;
     private static final String PATH_DETALLE_CARGA = "/FINANCIERO/workflow/seguimientoCartera/carga/";
     private static final String URL_MOSTRAR_CONTENEDOR = PATH_DETALLE_CARGA + "CR-T-SeguimientoCarteraDetalleCarga_CHILD.jsp";
-    private static final String URL_TABLA_DETALLE = Constante.RUTA_WORKFLOW + "seguimientoCartera/carga/CR-T-SeguimientoCarteraDetalleCarga_TABLA.jsp";
-    
-    private CRTipoAlertaFacadeInterfaceLocal crTipoAlertaFacadeInterfaceLocal;
+    private static final String URL_TABLA_DETALLE = Constante.RUTA_WORKFLOW + "seguimientoCartera/carga/CR_T_SeguimientoCarteraDetalleCarga_TABLA.jsp";
 
     private CRSeguimientoCarteraFacadeInterfaceLocal crSeguimientoCarteraFacadeInterfaceLocal;
-    
+
+    private CRTipoAlertaFacadeInterfaceLocal crTipoAlertaFacadeInterfaceLocal;
+
     protected void initEJBs() throws Exception {
-        crTipoAlertaFacadeInterfaceLocal = lookup(CRTipoAlertaFacade.LocalJNDIName);
         crSeguimientoCarteraFacadeInterfaceLocal = lookup(CRSeguimientoCarteraFacade.LocalJNDIName);
+        crTipoAlertaFacadeInterfaceLocal = lookup(CRTipoAlertaFacade.LocalJNDIName);
     }
 
     @RequestMapping(value = "MOSTRAR_CONTENEDOR", responseType = ResponseType.HTML, url = URL_MOSTRAR_CONTENEDOR)
     protected void mostrarContenedor(ServletParams servletParams) throws Exception {
         BeanParametrosAuditoria beanParametrosAuditoria = getBeanParametrosAuditoria(servletParams);
+        String idLote = getParameter(servletParams, "idLote");
 
         List<BeanCRTipoAlerta> listBeanCRTipoAlerta = crTipoAlertaFacadeInterfaceLocal.lstTipoAlerta(beanParametrosAuditoria);
+        List<BeanCombo> listTipoAlerta = parseListBeanCombo(listBeanCRTipoAlerta,
+                                                            "idTipoAlerta",
+                                                            "descripcionTipoAlerta");
+        List<BeanCombo> listTipoAlertaFinal = new ArrayList<BeanCombo>(0);
+        listTipoAlertaFinal.add(new BeanCombo("", "TODOS", "TODOS"));
+        listTipoAlertaFinal.addAll(listTipoAlerta);
 
-        setRequestAttribute(servletParams, "listBeanCRTipoAlerta", listBeanCRTipoAlerta);
+        setRequestAttribute(servletParams, "listTipoAlerta", listTipoAlertaFinal);
+        setRequestAttribute(servletParams, "idLote", idLote);
         forward(servletParams);
     }
-    
+
     @Override
     protected void execute(ServletParams servletParams) throws Exception {
     }
-    
+
     @RequestMapping(value = "CARGAR_DETALLE", responseType = ResponseType.HTML, url = URL_TABLA_DETALLE)
     protected void cargarDetalle(ServletParams servletParams) throws Exception {
 
@@ -65,6 +75,7 @@
         String codigoAgencia = getParameter(servletParams, "codigoAgencia");
         String codigoAsesor = getParameter(servletParams, "codigoAsesor");
         String codigoCliente = getParameter(servletParams, "codigoCliente");
+        String idLote = getParameter(servletParams, "idLote");
 
         String fin = "0";
 
@@ -73,7 +84,6 @@
 
         int cantReg = _toInteger(strCanPag);
         int intPagina = _toInteger(strPagina);
-        // Posiciones inicial y final
         int pos_ini = (intPagina - 1) * cantReg;
         int pos_fin = intPagina * cantReg;
         Long totalRegistros = new Long(0);
@@ -89,21 +99,25 @@
         genericBean.addProperty("codigoAgencia", codigoAgencia);
         genericBean.addProperty("codigoAsesor", codigoAsesor);
         genericBean.addProperty("codigoCliente", codigoCliente);
+        genericBean.addProperty("idLote", idLote);
         genericBean.addProperty("pagina", intPagina);
 
-        Map<String, Object> mapRespuesta = crSeguimientoCarteraFacadeInterfaceLocal.buscarSeguimientoCartera(genericBean, beanParametrosAuditoria);
+        Map<String, Object> mapRespuesta = crSeguimientoCarteraFacadeInterfaceLocal.buscarSeguimientoCarteraByIdLote(genericBean,
+                                                                                                             beanParametrosAuditoria);
 
-        List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera = (List<BeanCRSeguimientoCartera>) mapRespuesta.get("lstBeanCRSeguimientoCartera");
+        List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera = (List<BeanCRSeguimientoCartera>) mapRespuesta.get("listBeanCRSeguimientoCartera");
         totalRegistros = (Long) mapRespuesta.get("cantReg");
         String myData = "";
         if (!_isEmpty(lstBeanCRSeguimientoCartera)) {
             myData = getMyData(lstBeanCRSeguimientoCartera,
-                               "agenciaAsignada",
-                               "usuarioAsignado",
+                               "descripcionAgencia",
+                               "nombreUsuarioAsignado",
                                "nombreCliente",
                                "descripcionTipoAlerta",
                                "montoAlerta",
-                               "fechaAtencion");
+                               "fechaAtencion",
+                               "numeroCredito",
+                               "descripcionProducto");
         }
 
         if (pos_fin + 1 > totalRegistros) {
diff --git a/DELFINWEBNEW/src/general/utils/tags/botonesDelfinWeb.properties b/DELFINWEBNEW/src/general/utils/tags/botonesDelfinWeb.properties
index 055eadb..5f6a270 100644
--- a/DELFINWEBNEW/src/general/utils/tags/botonesDelfinWeb.properties
+++ b/DELFINWEBNEW/src/general/utils/tags/botonesDelfinWeb.properties
@@ -1437,8 +1437,9 @@
 BT_GrabarSeguimiento.gif=Grabar@@G
 BT_AnularSeguimiento.gif=Anular@@G
 BT_EnviarSeguimiento.gif=Enviar@@G
-BT_AprobarSeguimiento.gif=Aprobar@@G
-BT_DevolverSeguimiento.gif=Devolver@@G
+BT_EnviarResolucion.gif=Enviar@@G
+BT_ObservarResolucion.gif=Observar@@G
+BT_Subir_P.gif=Subir Archivo@@P
 #Fin [Req.S17-022]
 #Inicio [Req.S17-022] rsanchez 03.04.2017
 BT_AutorizarLotesSeguimiento.gif=Autorizar@@G
diff --git a/FINANCIERONEW/.classpath b/FINANCIERONEW/.classpath
index 6a9e136..21e7ae4 100644
--- a/FINANCIERONEW/.classpath
+++ b/FINANCIERONEW/.classpath
@@ -1,20 +1,30 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<classpath>
-	<classpathentry kind="src" path="src"/>
-	<classpathentry exported="true" kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.j2eedt.core.MYECLIPSE_JAVAEE_5_CONTAINER"/>
-	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_CORE"/>
-	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_JAXB2"/>
-	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_HTTP_CLIENT"/>
-	<classpathentry combineaccessrules="false" kind="src" path="/ADMINISTRATIVONEW"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE_TOOLS"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_CORE"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_EXTRAS"/>
-	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_EM"/>
-	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/WEB-INF/lib/poi-3.0.1-FINAL-20070705.jar"/>
-	<classpathentry kind="lib" path="classes12.jar"/>
-	<classpathentry kind="lib" path="com.ibm.mqjms.jar"/>
-	<classpathentry kind="lib" path="jboss-annotations-ejb3.jar"/>
-	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/WEB-INF/lib/jasperreports-3.0.0.jar"/>
-	<classpathentry kind="output" path="classes"/>
-</classpath>
\ No newline at end of file
+<?xml version="1.0" encoding="UTF-8"?>
+<classpath>
+	<classpathentry kind="src" path="src"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.j2eedt.core.MYECLIPSE_JAVAEE_5_CONTAINER"/>
+	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_CORE"/>
+	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_JAXB2"/>
+	<classpathentry kind="con" path="melibrary.com.genuitec.eclipse.ws.xfire.MYECLIPSE_XFIRE_HTTP_CLIENT"/>
+	<classpathentry combineaccessrules="false" kind="src" path="/ADMINISTRATIVONEW"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE_TOOLS"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_CORE"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_EXTRAS"/>
+	<classpathentry exported="true" kind="con" path="melibrary.com.genuitec.eclipse.hibernate.MYECLIPSE_HIBERNATE3_2_EM"/>
+	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/WEB-INF/lib/poi-3.0.1-FINAL-20070705.jar"/>
+	<classpathentry kind="lib" path="classes12.jar"/>
+	<classpathentry kind="lib" path="com.ibm.mqjms.jar"/>
+	<classpathentry kind="lib" path="jboss-annotations-ejb3.jar"/>
+	<classpathentry kind="lib" path="/DELFINWEBNEW/WebRoot/WEB-INF/lib/jasperreports-3.0.0.jar"/>
+	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/jdk1.6.0_07">
+		<attributes>
+			<attribute name="owner.project.facets" value="java"/>
+		</attributes>
+	</classpathentry>
+	<classpathentry kind="con" path="org.eclipse.jst.server.core.container/org.jboss.ide.eclipse.as.core.server.runtime.runtimeTarget/JBoss 4.2 Runtime">
+		<attributes>
+			<attribute name="owner.project.facets" value="jst.ejb"/>
+		</attributes>
+	</classpathentry>
+	<classpathentry kind="con" path="org.eclipse.jst.j2ee.internal.module.container"/>
+	<classpathentry kind="output" path="classes"/>
+</classpath>
diff --git a/FINANCIERONEW/.project b/FINANCIERONEW/.project
index ad8cb28..2acfbb5 100644
--- a/FINANCIERONEW/.project
+++ b/FINANCIERONEW/.project
@@ -1,40 +1,48 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<projectDescription>
-	<name>FINANCIERONEW</name>
-	<comment></comment>
-	<projects>
-	</projects>
-	<buildSpec>
-		<buildCommand>
-			<name>org.eclipse.jdt.core.javabuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>com.genuitec.eclipse.j2eedt.core.DeploymentDescriptorValidator</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>org.eclipse.dali.core.persistenceBuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>org.eclipse.wst.validation.validationbuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-		<buildCommand>
-			<name>com.genuitec.eclipse.ast.deploy.core.DeploymentBuilder</name>
-			<arguments>
-			</arguments>
-		</buildCommand>
-	</buildSpec>
-	<natures>
-		<nature>com.genuitec.eclipse.ast.deploy.core.deploymentnature</nature>
-		<nature>com.genuitec.eclipse.j2eedt.core.ejbnature</nature>
-		<nature>org.eclipse.dali.core.persistenceNature</nature>
-		<nature>org.eclipse.jdt.core.javanature</nature>
-	</natures>
-</projectDescription>
+<?xml version="1.0" encoding="UTF-8"?>
+<projectDescription>
+	<name>FINANCIERONEW</name>
+	<comment></comment>
+	<projects>
+	</projects>
+	<buildSpec>
+		<buildCommand>
+			<name>org.eclipse.wst.common.project.facet.core.builder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.jdt.core.javabuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>com.genuitec.eclipse.j2eedt.core.DeploymentDescriptorValidator</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.dali.core.persistenceBuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>org.eclipse.wst.validation.validationbuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+		<buildCommand>
+			<name>com.genuitec.eclipse.ast.deploy.core.DeploymentBuilder</name>
+			<arguments>
+			</arguments>
+		</buildCommand>
+	</buildSpec>
+	<natures>
+		<nature>org.eclipse.jem.workbench.JavaEMFNature</nature>
+		<nature>org.eclipse.wst.common.modulecore.ModuleCoreNature</nature>
+		<nature>com.genuitec.eclipse.ast.deploy.core.deploymentnature</nature>
+		<nature>com.genuitec.eclipse.j2eedt.core.ejbnature</nature>
+		<nature>org.eclipse.dali.core.persistenceNature</nature>
+		<nature>org.eclipse.jdt.core.javanature</nature>
+		<nature>org.eclipse.wst.common.project.facet.core.nature</nature>
+	</natures>
+</projectDescription>
diff --git a/FINANCIERONEW/src/financ/cierre/facade/CICierreDiarioFacade.java b/FINANCIERONEW/src/financ/cierre/facade/CICierreDiarioFacade.java
index 75479ff..11cc155 100644
--- a/FINANCIERONEW/src/financ/cierre/facade/CICierreDiarioFacade.java
+++ b/FINANCIERONEW/src/financ/cierre/facade/CICierreDiarioFacade.java
@@ -1,11 +1,11 @@
 package financ.cierre.facade;
 
-import static financ.util.Constante.CODIGO_CONSTANTE_IND_NO_EJECUCION_ASIENTO;
+import static financ.util.Constante.CADENA_VACIA;
 import static financ.util.Constante.CODIGO_CONSTANTE_EJECUCION_PROCESO_TRADING;
-import static financ.util.Constante.IND_NO_EJECUCION_ASIENTO_SI;
+import static financ.util.Constante.CODIGO_CONSTANTE_IND_NO_EJECUCION_ASIENTO;
 import static financ.util.Constante.IND_EJECUCION_PROCESO_TRADING_SI;
 import static financ.util.Constante.IND_NO_EJECUCION_ASIENTO_NO;
-import static financ.util.Constante.CADENA_VACIA;
+import static financ.util.Constante.IND_NO_EJECUCION_ASIENTO_SI;
 
 import java.sql.CallableStatement;
 import java.sql.Connection;
@@ -56,7 +56,6 @@
 import financ.cierre.local.CICierreDiarioFacadeInterfaceLocal;
 import financ.cierre.local.CICierreMensualProcFacadeInterfaceLocal;
 import financ.cierre.local.CIValidaCierreFacadeInterfaceLocal;
-import financ.clientes.beans.BeanCLBusquedaPosicionCliente;
 import financ.creditos.local.CRCreditoDebitoAutomaticoFacadeInterfaceLocal;
 import financ.creditos.local.CRProcesosCierreDiarioInterfaceLocal;
 import financ.cuentaspasivas.local.CPDepositoPlazoFijoPostCierreFacadeInterfaceLocal;
@@ -65,6 +64,7 @@
 import financ.operaciones.local.OPAbonoCargoInstitucionesFacadeInterfaceLocal;
 import financ.operaciones.local.OPBNGeneralesFacadeInterfaceLocal;
 import financ.operaciones.local.OPDetalleTransaccionesConciliarFacadeInterfaceLocal;
+import financ.seguimientoCartera.local.CRSeguimientoCarteraFacadeInterfaceLocal;
 import financ.util.FormatoFecha;
 
 /**
@@ -154,6 +154,9 @@
     //[Req.S17-003] kdelacruz 24.01.2017
     @EJB
     private GEMailSenderFacadeInterfaceLocal geMailSenderFacadeInterfaceLocal;
+    //[Req.S17-022] kdelacruz 18.04.2017
+    @EJB
+    private CRSeguimientoCarteraFacadeInterfaceLocal crSeguimientoCarteraFacadeInterfaceLocal;
     
 	public static String NO_ERROR = "000";
 	
@@ -193,7 +196,6 @@
 				String strIndReprocesos = String.valueOf(fila[6]);
 				
 				Long  lnCntEjecutadoAlaFechaProceso= new Long("0");
-					
 				try {
 					//gfernandez 10.01.2012 [Ticket 840]
 					if(strIndReprocesos.equals("N")){
@@ -606,7 +608,13 @@
 //                strError = procesarEnvioAutomaticoVencimientoAdeudos(codigoEmpresa, fechaCierre, beanParametrosAuditoria);
 //            }
             //Fin [Req.S17-003]
-            
+
+          // Inicio[Req.S17-022] kdelacruz 18.04.2017
+          if(codigoProceso.equals(cbProcesosInterfaceLocal.obtieneCodigoProceso(Constante.CODIGO_PROCESO_ENVIO_CORREO_SEGUIMIENTO_CARTERA))){
+              strError = procesarEnvioAutomaticoCorreosSeguimientoCartera(codigoEmpresa, fechaCierre, beanParametrosAuditoria);
+          }
+          //Fin [Req.S17-022]
+
             //[Req.S16-030] jhernandez Anexo 15B - Fondeo Estable/Inestable 07.02.17
             if(codigoProceso.equals(cbProcesosInterfaceLocal.obtieneCodigoProceso(admin.util.Constante.CODIGO_PROCESO_CONSOLIDACION_DATA_FONDEO_EI))){
                 strError = consolidaDataFondeoEstableInestable(codigoEmpresa, fechaCierre, beanParametrosAuditoria);
@@ -2572,4 +2580,101 @@
         return strError;
     }
     // Fin [Req.S16-030]
+    
+    
+ // Inicio [Req.S17-022] kdelacruz 18.04.2017
+    public String procesarEnvioAutomaticoCorreosSeguimientoCartera(String codigoEmpresa,
+                                                                   String fechaCierre,
+                                                                   BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String strError = NO_ERROR;
+        BeanParametrosLog beanParametrosLog = new BeanParametrosLog();
+        String identificadorProcesoBatch = "";
+        try {
+            /********** REGISTRO INICIO PROCESO EN LOG ***********/
+            beanParametrosLog.setParametrosAuditoriaBean(beanParametrosAuditoria);
+            beanParametrosLog.setEstadoProceso(Constante.ESTADO_EN_COLA);
+            beanParametrosLog.setMensaje("Iniciando el Proceso.");
+            beanParametrosLog.setFechaProcesoSistema(beanParametrosAuditoria.getFechaProceso());
+            identificadorProcesoBatch = cbManagerLogInterfaceLocal.crearLogBatch(cbProcesosInterfaceLocal.obtieneCodigoProcesoIndependiente(Constante.CODIGO_PROCESO_ENVIO_CORREO_SEGUIMIENTO_CARTERA),
+                                                                                 beanParametrosLog);
+            /*****************************************************/
+
+            SimpleDateFormat sdfHora = new SimpleDateFormat("hh:mm:ss:SSS");
+            Calendar cal = Calendar.getInstance();
+            Date fecha = cal.getTime();
+            String hora = sdfHora.format(fecha);
+            System.out.println("Hora:" + hora);
+            beanParametrosAuditoria.setFechaInsercion(fecha);
+            strError = envioAutomaticoCorreoSeguimientoCartera(codigoEmpresa, fechaCierre, beanParametrosAuditoria);
+
+            strError = "1";
+
+            /**************** REGISTRO FINAL PROCESO EN LOG ****************************/
+            beanParametrosLog = new BeanParametrosLog();
+            beanParametrosLog.setParametrosAuditoriaBean(beanParametrosAuditoria);
+
+            if (strError.equals(NO_ERROR)) {
+                beanParametrosLog.setEstadoProceso(Constante.ESTADO_FINALIZADO);
+                beanParametrosLog.setMensaje("El Proceso a finalizado correctamente");
+                beanParametrosLog.setRegistrosProcesadosCorrectamente(1);
+                beanParametrosLog.setRegistrosProcesadosConError(0);
+                beanParametrosLog.setRegistrosProcesados(1);
+            } else {
+                beanParametrosLog.setEstadoProceso(Constante.ESTADO_FINALIZADO_ERROR);
+                beanParametrosLog.setMensaje("El Proceso a finalizado con errores");
+                beanParametrosLog.setRegistrosProcesadosCorrectamente(0);
+                beanParametrosLog.setRegistrosProcesadosConError(1);
+                beanParametrosLog.setRegistrosProcesados(0);
+                cbManagerLogInterfaceLocal.grabarLogDeProceso(beanParametrosAuditoria,
+                                                              "1",
+                                                              null,
+                                                              null,
+                                                              "Error al enviar los correos",
+                                                              new java.util.Date(),
+                                                              FormatoFecha.obtenerHora(),
+                                                              0,
+                                                              1,
+                                                              1,
+                                                              1,
+                                                              1,
+                                                              Constante.ESTADO_EN_PROCESO,
+                                                              identificadorProcesoBatch,
+                                                              Constante.TIPO_ERR_PROC);
+            }
+
+            beanParametrosLog.setIdentificadorProcesoBatch(identificadorProcesoBatch);
+            beanParametrosLog.setParametrosAuditoriaBean(beanParametrosAuditoria);
+            beanParametrosLog.setLlave1(beanParametrosAuditoria.getFechaProceso() + "");
+            beanParametrosLog.setFechaInicioProcesoRegistro(new Date());
+            beanParametrosLog.setHoraInicioProcesoRegistro(FormatoFecha.obtenerHora());
+            beanParametrosLog.setRegistrosConsultados(1);
+            beanParametrosLog.setTotalRegistroAProcesar(1);
+            cbManagerLogInterfaceLocal.registrarLogBatch(beanParametrosLog.getIdentificadorProcesoBatch(),
+                                                         Constante.TIPO_LOG_PROC,
+                                                         beanParametrosLog);
+
+            cbManagerLogInterfaceLocal.cerrarLogBatch(identificadorProcesoBatch, beanParametrosLog);
+            /******************************************************************************/
+        } catch (Exception e) {
+            strError = "1";
+            beanParametrosLog.setEstadoProceso(Constante.ESTADO_FINALIZADO_ERROR);
+            cbManagerLogInterfaceLocal.cerrarLogBatch(identificadorProcesoBatch, beanParametrosLog);
+        }
+        return strError;
+    }
+    
+    private String envioAutomaticoCorreoSeguimientoCartera(String codigoEmpresa,
+                                                            String fechaCierre,
+                                                            BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String strError = NO_ERROR;
+        try {
+            crSeguimientoCarteraFacadeInterfaceLocal.envioCorreoMasivoPorEstadoYAsesor(beanParametrosAuditoria);
+        } catch (Exception e) {
+            strError = ConstantesErrores.ERROR_NO_CONTROLADO;
+            e.printStackTrace();
+        }
+
+        return strError;
+    }
+    // Fin [Req.S17-022]
 }
diff --git a/FINANCIERONEW/src/financ/cierre/local/CICierreDiarioFacadeInterfaceLocal.java b/FINANCIERONEW/src/financ/cierre/local/CICierreDiarioFacadeInterfaceLocal.java
index 857ceb1..ed2af4f 100644
--- a/FINANCIERONEW/src/financ/cierre/local/CICierreDiarioFacadeInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/cierre/local/CICierreDiarioFacadeInterfaceLocal.java
@@ -5,10 +5,7 @@
 
 import javax.ejb.Local;
 
-import org.jboss.logging.Logger;
-
 import admin.contab.beans.BeanParametrosAuditoria;
-import financ.cierre.facade.CICierreDiarioFacade;
 
 @Local
 public interface CICierreDiarioFacadeInterfaceLocal {
@@ -82,4 +79,17 @@
 	public String procesarEnvioAutomaticoVencimientoAdeudos(String codigoEmpresa,
                                                             String fechaCierre,
                                                             BeanParametrosAuditoria beanParametrosAuditoria)throws Exception;
+	
+	/**
+	 * @autor kdelacruz
+     * @since [Req.S17-022] 18.04.2017
+	 * @param codigoEmpresa
+	 * @param fechaCierre
+	 * @param beanParametrosAuditoria
+	 * @return
+	 * @throws Exception
+	 */
+	public String procesarEnvioAutomaticoCorreosSeguimientoCartera(String codigoEmpresa,
+                                                                   String fechaCierre,
+                                                                   BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 }
diff --git a/FINANCIERONEW/src/financ/creditos/facade/CRCuentaCreditoFacade.java b/FINANCIERONEW/src/financ/creditos/facade/CRCuentaCreditoFacade.java
index aa47b6a..c45fee4 100644
--- a/FINANCIERONEW/src/financ/creditos/facade/CRCuentaCreditoFacade.java
+++ b/FINANCIERONEW/src/financ/creditos/facade/CRCuentaCreditoFacade.java
@@ -11058,7 +11058,7 @@
         String codigoAgencia = CADENA_VACIA;
         try {
             listCRCuentaCredito = crCuentaCreditoInterfaceLocal.findByCodigoClienteEstadoCredito(codigoCliente,
-                                                                                                 "VG",
+                                                                                                 Constante.ESTADO_CREDITO_VIGENTE,
                                                                                                  "1");
             for (CRCuentaCredito crCuentaCredito : listCRCuentaCredito) {
                 codigoAgencia = crCuentaCredito.getCodigoAgencia();
diff --git a/FINANCIERONEW/src/financ/email/facade/GEMailSenderFacade.java b/FINANCIERONEW/src/financ/email/facade/GEMailSenderFacade.java
index 309c124..7ef53fb 100644
--- a/FINANCIERONEW/src/financ/email/facade/GEMailSenderFacade.java
+++ b/FINANCIERONEW/src/financ/email/facade/GEMailSenderFacade.java
@@ -12,6 +12,7 @@
 import pe.com.tfc.utils.PropertyParams;
 import admin.contab.beans.BeanParametrosAuditoria;
 import admin.contab.entity.CBUsuario;
+import admin.contab.local.CBAgenciaInterfaceLocal;
 import admin.contab.local.CBUsuarioInterfaceLocal;
 import admin.email.beans.BeanCBMailSend;
 import admin.email.beans.BeanCBMailSend.CBMailConfig;
@@ -27,7 +28,9 @@
 import financ.creditos.local.CRMotivoXEstadoResolucionCreditoInterfaceLocal;
 import financ.creditos.local.CRSolicitudCreditoInterfaceLocal;
 import financ.email.local.GEMailSenderFacadeInterfaceLocal;
+import financ.seguimientoCartera.beans.BeanCRSeguimientoCartera;
 import financ.util.Constante;
+import financ.util.FormatoFecha;
 import financ.workflow.entity.WFDocumentos;
 import financ.workflow.entity.WFEstado;
 import financ.workflow.entity.WFEtapa;
@@ -80,6 +83,9 @@
     private WFDocumentosInterfaceLocal wfDocumentosInterfaceLocal;
     @EJB
     private WFTipoDocumentoInterfaceLocal wfTipoDocumentoInterfaceLocal;
+    //[Req.S17-022] kdelacruz 19.04.2017
+    @EJB
+    private CBAgenciaInterfaceLocal cbAgenciaInterfaceLocal;
 
     public void enviarMailResolucionSolicitudCredito(String numeroSolicitud,
                                                      String estadoResolucion,
@@ -293,7 +299,6 @@
             listaDocumentos = "Se env�an los siguientes documentos:</br><ul>" + listaDoc + "</ul>";
         }
 
-        
         String mensaje = beanCBMailTemplate.getMensaje().replace("WF_ESTADO", descripcionEstado).replace("NOMBRE_CLIENTE", wfLegal.getClPersonas().getNombreoRazonSocial())
                         .replace("DNI_CLIENTE", wfLegal.getClPersonas().getNumeroDocumentoIdentidad())
                         .replace("WF_COMENTARIOS", textoComentario)
@@ -345,4 +350,272 @@
         }
         return listDocumentosHTML;
     }
+
+    // Inicio [Req.S17-022] kdelacruz 11.04.2017
+    public void enviarMailClientesPorAsesor(String nombreCompleto,
+                                            List<String> listaDestinatarios,
+                                            List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                            BeanParametrosAuditoria beanParametrosAuditoria) {
+        String modulo = "GEMailSenderFacade.enviarMailReporteVencAdeudos()";
+        String usuarioInsercion = beanParametrosAuditoria.getUsuarioInsercion();
+        try {
+            enviarMailClientesPorAsesorInterno(nombreCompleto,
+                                               listaDestinatarios,
+                                               lstBeanCRSeguimientoCartera,
+                                               beanParametrosAuditoria);
+        } catch (Exception e) {
+            handlerError(e, usuarioInsercion, modulo);
+        }
+    }
+
+    private void enviarMailClientesPorAsesorInterno(String nombreCompleto,
+                                                    List<String> listaDestinatarios,
+                                                    List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                                    BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        BeanCBMailTemplate beanCBMailTemplate = cbMailSenderFacadeInterfaceLocal.obtenerConfiguracionEnvioPorCodigoModuloReferencia(Constante.WF_SEGUIMIENTO_CARTERA_CODIGO_MODULO_ASIGNACION);
+        if (_isEmpty(beanCBMailTemplate) || !_equiv(beanCBMailTemplate.getEstadoRegistro(),
+                                                    Constante.ESTADO_REGISTRO_VIGENTE)) {
+            return;
+        }
+        CBMailConfig cbMailConfig = cbMailSenderFacadeInterfaceLocal.obtenerDatosConfiguracion(beanParametrosAuditoria);
+        cbMailConfig.setNombreModulo(beanCBMailTemplate.getCodigoModuloReferencia());
+        cbMailConfig.setCorreoDeEnvio(beanCBMailTemplate.getMailEnvio());
+        cbMailConfig.setPasswordCorreoEnvio(beanCBMailTemplate.getPasswordEnvio());
+        cbMailConfig.setIncluirCopiaASiMismo(false);
+        cbMailConfig.setIncluyeAdjunto(true);
+
+        String tablaBloqueos = CADENA_VACIA;
+
+        List<GenericBean> listColumnas = new ArrayList<GenericBean>(0);
+        MailHTML mailHTML = new MailHTML();
+        listColumnas.add(mailHTML.addColumna("nombreCliente", "Nombre de Clientes"));
+        listColumnas.add(mailHTML.addColumna("descripcionTipoAlerta", "Tipo de Alerta"));
+        listColumnas.add(mailHTML.addColumna("montoAlerta", "Monto de Alerta"));
+        listColumnas.add(mailHTML.addColumna("fechaAtencion", "Fecha de Atenci�n"));
+        
+        
+
+        tablaBloqueos = mailHTML.getHTMLTable(lstBeanCRSeguimientoCartera,
+                                              true,
+                                              Constante.ORIENTACION_TABLA_HTML_HORIZONTAL,
+                                              listColumnas);
+
+        String asunto = beanCBMailTemplate.getAsunto();
+
+        String mensaje = beanCBMailTemplate.getMensaje();
+
+        mensaje = mensaje.replace("TABLA_DETALLE_SEGUIMIENTO", tablaBloqueos).replace("NOMBRE_COMPLETO", nombreCompleto);
+
+        BeanCBMailSend.CBMailBody cbMailBody;
+        cbMailBody = new BeanCBMailSend.CBMailBody();
+        cbMailBody.setFechaEnvio(beanParametrosAuditoria.getFechaProceso());
+        cbMailBody.setAsunto(asunto);
+        cbMailBody.setMensaje(mensaje);
+        cbMailBody.addCorreoDestino(listaDestinatarios);
+
+        BeanCBMailSend beanCBMailSend = new BeanCBMailSend();
+        beanCBMailSend.setCbMailConfig(cbMailConfig);
+        beanCBMailSend.setCbMailBody(cbMailBody);
+        beanCBMailSend.setBeanParametrosAuditoria(beanParametrosAuditoria);
+
+        cbMailSenderFacadeInterfaceLocal.enviarMail(beanCBMailSend, beanParametrosAuditoria);
+    }
+
+    public void enviarMailSegCarAprobadoDevuelto(String nombreCompleto,
+                                                 List<String> listaDestinatarios,
+                                                 List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                                 BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "GEMailSenderFacade.enviarMailSegCarAprobadoDevuelto()";
+        String usuarioInsercion = beanParametrosAuditoria.getUsuarioInsercion();
+        try {
+            enviarMailSegCarAprobadoDevueltoInterno(nombreCompleto,
+                                                    listaDestinatarios,
+                                                    lstBeanCRSeguimientoCartera,
+                                                    beanParametrosAuditoria);
+        } catch (Exception e) {
+            handlerError(e, usuarioInsercion, modulo);
+        }
+    }
+
+    private void enviarMailSegCarAprobadoDevueltoInterno(String nombreCompleto,
+                                                         List<String> listaDestinatarios,
+                                                         List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                                         BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        BeanCBMailTemplate beanCBMailTemplate = cbMailSenderFacadeInterfaceLocal.obtenerConfiguracionEnvioPorCodigoModuloReferencia(Constante.WF_SEGUIMIENTO_CARTERA_CODIGO_MODULO_APROBACION_DEVOLUACION);
+        if (_isEmpty(beanCBMailTemplate) || !_equiv(beanCBMailTemplate.getEstadoRegistro(),
+                                                    Constante.ESTADO_REGISTRO_VIGENTE)) {
+            return;
+        }
+        CBMailConfig cbMailConfig = cbMailSenderFacadeInterfaceLocal.obtenerDatosConfiguracion(beanParametrosAuditoria);
+        cbMailConfig.setNombreModulo(beanCBMailTemplate.getCodigoModuloReferencia());
+        cbMailConfig.setCorreoDeEnvio(beanCBMailTemplate.getMailEnvio());
+        cbMailConfig.setPasswordCorreoEnvio(beanCBMailTemplate.getPasswordEnvio());
+        cbMailConfig.setIncluirCopiaASiMismo(false);
+        cbMailConfig.setIncluyeAdjunto(true);
+
+        String tablaBloqueos = CADENA_VACIA;
+
+        List<GenericBean> listColumnas = new ArrayList<GenericBean>(0);
+        MailHTML mailHTML = new MailHTML();
+        listColumnas.add(mailHTML.addColumna("nombreCliente", "Nombre de Cliente"));
+        listColumnas.add(mailHTML.addColumna("descripcionEstado", "Respuesta GyS"));
+        listColumnas.add(mailHTML.addColumna("motivoSeguimientoCartera", "Motivo"));
+        listColumnas.add(mailHTML.addColumna("fechaAtencion", "Fecha de Atenci�n"));
+
+        tablaBloqueos = mailHTML.getHTMLTable(lstBeanCRSeguimientoCartera,
+                                              true,
+                                              Constante.ORIENTACION_TABLA_HTML_HORIZONTAL,
+                                              listColumnas);
+
+        String asunto = beanCBMailTemplate.getAsunto().replace("DIA_HOY", FormatoFecha.dateToStringDDMMYYYYY(beanParametrosAuditoria.getFechaProceso()));
+
+        String mensaje = beanCBMailTemplate.getMensaje();
+
+        mensaje = mensaje.replace("TABLA_DETALLE_SEGUIMIENTO_OBSERVADO_FINALIZADO", tablaBloqueos).replace("NOMBRE_COMPLETO", nombreCompleto);
+
+        BeanCBMailSend.CBMailBody cbMailBody;
+        cbMailBody = new BeanCBMailSend.CBMailBody();
+        cbMailBody.setFechaEnvio(beanParametrosAuditoria.getFechaProceso());
+        cbMailBody.setAsunto(asunto);
+        cbMailBody.setMensaje(mensaje);
+        cbMailBody.addCorreoDestino(listaDestinatarios);
+
+        BeanCBMailSend beanCBMailSend = new BeanCBMailSend();
+        beanCBMailSend.setCbMailConfig(cbMailConfig);
+        beanCBMailSend.setCbMailBody(cbMailBody);
+        beanCBMailSend.setBeanParametrosAuditoria(beanParametrosAuditoria);
+
+        cbMailSenderFacadeInterfaceLocal.enviarMail(beanCBMailSend, beanParametrosAuditoria);
+    }
+
+    public void enviarMailSegCarAtencion(String destinatario,
+                                           List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                           BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "GEMailSenderFacade.enviarMailSegCarAprobadoDevuelto()";
+        String usuarioInsercion = beanParametrosAuditoria.getUsuarioInsercion();
+        try {
+            enviarMailSegCarAtencionInterno(destinatario, lstBeanCRSeguimientoCartera, beanParametrosAuditoria);
+        } catch (Exception e) {
+            handlerError(e, usuarioInsercion, modulo);
+        }
+    }
+
+
+    private void enviarMailSegCarAtencionInterno(String destinatario,
+                                                   List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                                   BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+
+        BeanCBMailTemplate beanCBMailTemplate = cbMailSenderFacadeInterfaceLocal.obtenerConfiguracionEnvioPorCodigoModuloReferencia(Constante.WF_SEGUIMIENTO_CARTERA_CODIGO_MODULO_RESOLUCION);
+        if (_isEmpty(beanCBMailTemplate) || !_equiv(beanCBMailTemplate.getEstadoRegistro(),
+                                                    Constante.ESTADO_REGISTRO_VIGENTE)) {
+            return;
+        }
+        CBMailConfig cbMailConfig = cbMailSenderFacadeInterfaceLocal.obtenerDatosConfiguracion(beanParametrosAuditoria);
+        cbMailConfig.setNombreModulo(beanCBMailTemplate.getCodigoModuloReferencia());
+        cbMailConfig.setCorreoDeEnvio(beanCBMailTemplate.getMailEnvio());
+        cbMailConfig.setPasswordCorreoEnvio(beanCBMailTemplate.getPasswordEnvio());
+        cbMailConfig.setIncluirCopiaASiMismo(false);
+        cbMailConfig.setIncluyeAdjunto(true);
+
+        String tablaBloqueos = CADENA_VACIA;
+
+        List<GenericBean> listColumnas = new ArrayList<GenericBean>(0);
+        MailHTML mailHTML = new MailHTML();
+        listColumnas.add(mailHTML.addColumna("descripcionAgencia", "Agencia"));
+        listColumnas.add(mailHTML.addColumna("descripcionTipoAlerta", "Tipo de Alerta"));
+        listColumnas.add(mailHTML.addColumna("cantidadAlertas", "Cantidad de Alertas"));
+
+        tablaBloqueos = mailHTML.getHTMLTable(lstBeanCRSeguimientoCartera,
+                                              true,
+                                              Constante.ORIENTACION_TABLA_HTML_HORIZONTAL,
+                                              listColumnas);
+
+        String asunto = beanCBMailTemplate.getAsunto().replace("DIA_HOY", FormatoFecha.dateToStringDDMMYYYYY(beanParametrosAuditoria.getFechaProceso()));
+
+        String mensaje = beanCBMailTemplate.getMensaje();
+
+        mensaje = mensaje.replace("TABLA_DETALLE_SEGUIMIENTO_ATENDIDAS", tablaBloqueos).replace("DIA_HOY", FormatoFecha.dateToStringDDMMYYYYY(beanParametrosAuditoria.getFechaProceso()));
+
+        BeanCBMailSend.CBMailBody cbMailBody;
+        cbMailBody = new BeanCBMailSend.CBMailBody();
+        cbMailBody.setFechaEnvio(beanParametrosAuditoria.getFechaProceso());
+        cbMailBody.setAsunto(asunto);
+        cbMailBody.setMensaje(mensaje);
+        cbMailBody.addCorreoDestino(destinatario);
+
+        BeanCBMailSend beanCBMailSend = new BeanCBMailSend();
+        beanCBMailSend.setCbMailConfig(cbMailConfig);
+        beanCBMailSend.setCbMailBody(cbMailBody);
+        beanCBMailSend.setBeanParametrosAuditoria(beanParametrosAuditoria);
+
+        cbMailSenderFacadeInterfaceLocal.enviarMail(beanCBMailSend, beanParametrosAuditoria);
+    }
+
+
+    public void enviarMailSegCarIncumplimiento(String nombreCompleto,
+                                               List<String> listaDestinatarios,
+                                               List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                               BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "GEMailSenderFacade.enviarMailSegCarIncumplimiento()";
+        String usuarioInsercion = beanParametrosAuditoria.getUsuarioInsercion();
+        try {
+            enviarMailSegCarIncumplimientoInterno(nombreCompleto,
+                                                  listaDestinatarios, lstBeanCRSeguimientoCartera, beanParametrosAuditoria);
+        } catch (Exception e) {
+            handlerError(e, usuarioInsercion, modulo);
+        }
+    }
+
+    private void enviarMailSegCarIncumplimientoInterno(String nombreCompleto,
+                                                       List<String> listaDestinatarios,
+                                                       List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                                       BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+
+        BeanCBMailTemplate beanCBMailTemplate = cbMailSenderFacadeInterfaceLocal.obtenerConfiguracionEnvioPorCodigoModuloReferencia(Constante.WF_SEGUIMIENTO_CARTERA_CODIGO_MODULO_INCUMPLIMIENTO);
+        if (_isEmpty(beanCBMailTemplate) || !_equiv(beanCBMailTemplate.getEstadoRegistro(),
+                                                    Constante.ESTADO_REGISTRO_VIGENTE)) {
+            return;
+        }
+        CBMailConfig cbMailConfig = cbMailSenderFacadeInterfaceLocal.obtenerDatosConfiguracion(beanParametrosAuditoria);
+        cbMailConfig.setNombreModulo(beanCBMailTemplate.getCodigoModuloReferencia());
+        cbMailConfig.setCorreoDeEnvio(beanCBMailTemplate.getMailEnvio());
+        cbMailConfig.setPasswordCorreoEnvio(beanCBMailTemplate.getPasswordEnvio());
+        cbMailConfig.setIncluirCopiaASiMismo(false);
+        cbMailConfig.setIncluyeAdjunto(true);
+
+        String tablaBloqueos = CADENA_VACIA;
+
+        List<GenericBean> listColumnas = new ArrayList<GenericBean>(0);
+        MailHTML mailHTML = new MailHTML();
+        listColumnas.add(mailHTML.addColumna("nombreCliente", "Nombre de Clientes"));
+        listColumnas.add(mailHTML.addColumna("descripcionTipoAlerta", "Tipo de Alerta"));
+        listColumnas.add(mailHTML.addColumna("fechaAtencion", "Fecha de Atenci�n"));
+        listColumnas.add(mailHTML.addColumna("diasIncumplimiento", "D�as de Incumplimiento"));
+
+        tablaBloqueos = mailHTML.getHTMLTable(lstBeanCRSeguimientoCartera,
+                                              true,
+                                              Constante.ORIENTACION_TABLA_HTML_HORIZONTAL,
+                                              listColumnas);
+
+        String asunto = beanCBMailTemplate.getAsunto();
+
+        String mensaje = beanCBMailTemplate.getMensaje();
+
+        mensaje = mensaje.replace("TABLA_DETALLE_SEGUIMIENTO_INCUMPLIMIENTO", tablaBloqueos).replace("NOMBRE_COMPLETO", nombreCompleto);
+
+        BeanCBMailSend.CBMailBody cbMailBody;
+        cbMailBody = new BeanCBMailSend.CBMailBody();
+        cbMailBody.setFechaEnvio(beanParametrosAuditoria.getFechaProceso());
+        cbMailBody.setAsunto(asunto);
+        cbMailBody.setMensaje(mensaje);
+        cbMailBody.addCorreoDestino(listaDestinatarios);
+
+        BeanCBMailSend beanCBMailSend = new BeanCBMailSend();
+        beanCBMailSend.setCbMailConfig(cbMailConfig);
+        beanCBMailSend.setCbMailBody(cbMailBody);
+        beanCBMailSend.setBeanParametrosAuditoria(beanParametrosAuditoria);
+
+        cbMailSenderFacadeInterfaceLocal.enviarMail(beanCBMailSend, beanParametrosAuditoria);
+    }
+    // Fin [Req.S17-022]
 }
diff --git a/FINANCIERONEW/src/financ/email/local/GEMailSenderFacadeInterfaceLocal.java b/FINANCIERONEW/src/financ/email/local/GEMailSenderFacadeInterfaceLocal.java
index 3b9dc05..6fe8408 100644
--- a/FINANCIERONEW/src/financ/email/local/GEMailSenderFacadeInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/email/local/GEMailSenderFacadeInterfaceLocal.java
@@ -4,9 +4,9 @@
 
 import javax.ejb.Local;
 
-import financ.cierre.beans.BeanCIVencimientosAdeudos;
-import financ.workflow.bean.BeanWFMaestra;
 import admin.contab.beans.BeanParametrosAuditoria;
+import financ.cierre.beans.BeanCIVencimientosAdeudos;
+import financ.seguimientoCartera.beans.BeanCRSeguimientoCartera;
 
 /**
  * GEMailSenderFacadeInterfaceLocal
@@ -14,6 +14,7 @@
  * @author gmeza
  * @since [CC16-081] 05.12.2016
  * @since [Req.S17-003] kdelacruz 24.01.2017
+ * @since [Req.S17-022] kdelacruz 18.04.2017
  */
 
 @Local
@@ -66,6 +67,60 @@
                                         String textoComentario,
                                         String idRuta,
                                         String codigoModuloReferencia,
-                                        BeanParametrosAuditoria beanParametrosAuditoria) throws Exception ;
+                                        BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 11.04.2017
+     * @param nombreCompleto
+     * @param listaDestinatarios
+     * @param lstBeanCRSeguimientoCartera
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void enviarMailClientesPorAsesor(String nombreCompleto,
+                                            List<String> listaDestinatarios,
+                                            List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                            BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 11.04.2017
+     * @param nombreCompleto
+     * @param listaDestinatarios
+     * @param lstBeanCRSeguimientoCartera
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void enviarMailSegCarAprobadoDevuelto(String nombreCompleto,
+                                                 List<String> listaDestinatarios,
+                                                 List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                                 BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 11.04.2017
+     * @param destinatario
+     * @param lstBeanCRSeguimientoCartera
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void enviarMailSegCarAtencion(String destinatario,
+                                         List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                         BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 17.04.2017
+     * @param nombreCompleto
+     * @param listaDestinatarios
+     * @param lstBeanCRSeguimientoCartera
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void enviarMailSegCarIncumplimiento(String nombreCompleto,
+                                               List<String> listaDestinatarios,
+                                               List<BeanCRSeguimientoCartera> lstBeanCRSeguimientoCartera,
+                                               BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRCargaAlerta.java b/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRCargaAlerta.java
index 1c91c45..0855882 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRCargaAlerta.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRCargaAlerta.java
@@ -38,6 +38,10 @@
     private String codigoCalificacionSBS;
     @ImporterProperty(position = 11, optional = true, description = "Comentario")
     private String comentario;
+    @ImporterProperty(position = 12, optional = true, description = "N�mero Cr�dito")
+    private String numeroCredito;
+    @ImporterProperty(position = 13, optional = true, description = "Tipo Producto")
+    private String tipoProducto;
 
     private String codigoCliente;
 
@@ -147,4 +151,24 @@
         this.comentario = comentario;
     }
 
+    
+    public String getNumeroCredito() {
+        return numeroCredito;
+    }
+
+    
+    public void setNumeroCredito(String numeroCredito) {
+        this.numeroCredito = numeroCredito;
+    }
+
+    
+    public String getTipoProducto() {
+        return tipoProducto;
+    }
+
+    
+    public void setTipoProducto(String tipoProducto) {
+        this.tipoProducto = tipoProducto;
+    }
+    
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRDocumentosPorActividad.java b/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRDocumentosPorActividad.java
index 2557c09..5203643 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRDocumentosPorActividad.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRDocumentosPorActividad.java
@@ -22,6 +22,12 @@
     private String idFile;
     private String tipoDocumento;
     private String comentarioDocumento;
+    private String nombreFile;
+    private String extensionFile;
+    private String tamanioFile;
+    private String fechaRegistro;
+    private String usuarioRegistro;
+    private String descripcionTipoDocumento;
 
     public String getCorrelativoDocumentoXActividad() {
         return correlativoDocumentoXActividad;
@@ -63,4 +69,52 @@
         this.comentarioDocumento = comentarioDocumento;
     }
 
+    public String getNombreFile() {
+        return nombreFile;
+    }
+
+    public void setNombreFile(String nombreFile) {
+        this.nombreFile = nombreFile;
+    }
+
+    public String getExtensionFile() {
+        return extensionFile;
+    }
+
+    public void setExtensionFile(String extensionFile) {
+        this.extensionFile = extensionFile;
+    }
+
+    public String getTamanioFile() {
+        return tamanioFile;
+    }
+
+    public void setTamanioFile(String tamanioFile) {
+        this.tamanioFile = tamanioFile;
+    }
+
+    public String getFechaRegistro() {
+        return fechaRegistro;
+    }
+
+    public void setFechaRegistro(String fechaRegistro) {
+        this.fechaRegistro = fechaRegistro;
+    }
+
+    public String getUsuarioRegistro() {
+        return usuarioRegistro;
+    }
+
+    public void setUsuarioRegistro(String usuarioRegistro) {
+        this.usuarioRegistro = usuarioRegistro;
+    }
+
+    public String getDescripcionTipoDocumento() {
+        return descripcionTipoDocumento;
+    }
+
+    public void setDescripcionTipoDocumento(String descripcionTipoDocumento) {
+        this.descripcionTipoDocumento = descripcionTipoDocumento;
+    }
+
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRSeguimientoCartera.java b/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRSeguimientoCartera.java
index fa1ba27..3181a04 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRSeguimientoCartera.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/beans/BeanCRSeguimientoCartera.java
@@ -31,6 +31,23 @@
     private String codigoCalificacionSBS;
     private String descripcionEstado;
     private String comentario;
+    private String indicadorEnvioCorreo;
+    private String motivoSeguimientoCartera;
+    private String diasIncumplimiento;
+    private String cantidadAlertas;
+    private String numeroCredito;
+    private String tipoProducto;
+    private String descripcionProducto;
+    private String horaAsignacion;
+    private String tipoPersona;
+    private String fechaUltimaActividad;
+    private String comentarioUltimaActividad;
+    private String fechaResolucion;
+    private String comentarioResolucion;
+    private String tiempoTranscurrido;
+
+    private String idTipoRespuesta;
+    private String codigoMotivo;
 
     public String getCorrelativoSeguimiento() {
         return correlativoSeguimiento;
@@ -200,4 +217,132 @@
         this.comentario = comentario;
     }
 
+    public String getIndicadorEnvioCorreo() {
+        return indicadorEnvioCorreo;
+    }
+
+    public void setIndicadorEnvioCorreo(String indicadorEnvioCorreo) {
+        this.indicadorEnvioCorreo = indicadorEnvioCorreo;
+    }
+
+    public String getMotivoSeguimientoCartera() {
+        return motivoSeguimientoCartera;
+    }
+
+    public void setMotivoSeguimientoCartera(String motivoSeguimientoCartera) {
+        this.motivoSeguimientoCartera = motivoSeguimientoCartera;
+    }
+
+    public String getDiasIncumplimiento() {
+        return diasIncumplimiento;
+    }
+
+    public void setDiasIncumplimiento(String diasIncumplimiento) {
+        this.diasIncumplimiento = diasIncumplimiento;
+    }
+
+    public String getCantidadAlertas() {
+        return cantidadAlertas;
+    }
+
+    public void setCantidadAlertas(String cantidadAlertas) {
+        this.cantidadAlertas = cantidadAlertas;
+    }
+
+    public String getTipoPersona() {
+        return tipoPersona;
+    }
+
+    public void setTipoPersona(String tipoPersona) {
+        this.tipoPersona = tipoPersona;
+    }
+
+    public String getNumeroCredito() {
+        return numeroCredito;
+    }
+
+    public void setNumeroCredito(String numeroCredito) {
+        this.numeroCredito = numeroCredito;
+    }
+
+    public String getTipoProducto() {
+        return tipoProducto;
+    }
+
+    public void setTipoProducto(String tipoProducto) {
+        this.tipoProducto = tipoProducto;
+    }
+
+    public String getDescripcionProducto() {
+        return descripcionProducto;
+    }
+
+    public void setDescripcionProducto(String descripcionProducto) {
+        this.descripcionProducto = descripcionProducto;
+    }
+
+    public String getHoraAsignacion() {
+        return horaAsignacion;
+    }
+
+    public void setHoraAsignacion(String horaAsignacion) {
+        this.horaAsignacion = horaAsignacion;
+    }
+
+    public String getComentarioUltimaActividad() {
+        return comentarioUltimaActividad;
+    }
+
+    public void setComentarioUltimaActividad(String comentarioUltimaActividad) {
+        this.comentarioUltimaActividad = comentarioUltimaActividad;
+    }
+
+    public String getFechaResolucion() {
+        return fechaResolucion;
+    }
+
+    public void setFechaResolucion(String fechaResolucion) {
+        this.fechaResolucion = fechaResolucion;
+    }
+
+    public String getComentarioResolucion() {
+        return comentarioResolucion;
+    }
+
+    public void setComentarioResolucion(String comentarioResolucion) {
+        this.comentarioResolucion = comentarioResolucion;
+    }
+
+    public String getTiempoTranscurrido() {
+        return tiempoTranscurrido;
+    }
+
+    public void setTiempoTranscurrido(String tiempoTranscurrido) {
+        this.tiempoTranscurrido = tiempoTranscurrido;
+    }
+
+    public String getFechaUltimaActividad() {
+        return fechaUltimaActividad;
+    }
+
+    public void setFechaUltimaActividad(String fechaUltimaActividad) {
+        this.fechaUltimaActividad = fechaUltimaActividad;
+    }
+
+    public String getIdTipoRespuesta() {
+        return idTipoRespuesta;
+    }
+
+    public void setIdTipoRespuesta(String idTipoRespuesta) {
+        this.idTipoRespuesta = idTipoRespuesta;
+    }
+
+    public String getCodigoMotivo() {
+        return codigoMotivo;
+    }
+
+    public void setCodigoMotivo(String codigoMotivo) {
+        this.codigoMotivo = codigoMotivo;
+    }
+
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/entity/CRSeguimientoCartera.java b/FINANCIERONEW/src/financ/seguimientoCartera/entity/CRSeguimientoCartera.java
index 960d700..4bfeab7 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/entity/CRSeguimientoCartera.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/entity/CRSeguimientoCartera.java
@@ -9,6 +9,8 @@
 import javax.persistence.JoinColumn;
 import javax.persistence.ManyToOne;
 import javax.persistence.Table;
+import javax.persistence.Temporal;
+import javax.persistence.TemporalType;
 
 import pe.com.tfc.utils.Auditable;
 import financ.clientes.entity.CLPersonas;
@@ -43,6 +45,10 @@
     private Double montoProvision;
     private Double interesDevengado;
     private String comentario;
+    private String indicadorEnvioCorreo;
+    private String numeroCredito;
+    private String tipoProducto;
+    private String horaAsignacion;
 
     private CLPersonas clPersonas; //cliente 
     private CRTipoAlerta crTipoAlerta;
@@ -85,7 +91,8 @@
         this.agenciaAsignada = agenciaAsignada;
     }
 
-    @Column(name = "D_FECASG", length = 7)
+    @Temporal(TemporalType.TIMESTAMP)
+    @Column(name = "D_FECASG")
     public Date getFechaAsignacion() {
         return fechaAsignacion;
     }
@@ -187,7 +194,7 @@
     public void setCrCalificacionCreditoSbs(CRCalificacionCreditoSbs crCalificacionCreditoSbs) {
         this.crCalificacionCreditoSbs = crCalificacionCreditoSbs;
     }
-    
+
     @Column(name = "C_COMENT", nullable = false, length = 1000)
     public String getComentario() {
         return comentario;
@@ -196,4 +203,40 @@
     public void setComentario(String comentario) {
         this.comentario = comentario;
     }
+
+    @Column(name = "C_INDECO", nullable = false, length = 1)
+    public String getIndicadorEnvioCorreo() {
+        return indicadorEnvioCorreo;
+    }
+
+    public void setIndicadorEnvioCorreo(String indicadorEnvioCorreo) {
+        this.indicadorEnvioCorreo = indicadorEnvioCorreo;
+    }
+
+    @Column(name = "C_NUMCRE", nullable = false, length = 15)
+    public String getNumeroCredito() {
+        return numeroCredito;
+    }
+
+    public void setNumeroCredito(String numeroCredito) {
+        this.numeroCredito = numeroCredito;
 }
+    @Column(name = "C_TIPPRO", nullable = false, length = 3)
+    public String getTipoProducto() {
+        return tipoProducto;
+    }
+
+    public void setTipoProducto(String tipoProducto) {
+        this.tipoProducto = tipoProducto;
+    }
+
+    @Column(name = "C_HORASG", length = 15)
+    public String getHoraAsignacion() {
+        return horaAsignacion;
+    }
+
+    public void setHoraAsignacion(String horaAsignacion) {
+        this.horaAsignacion = horaAsignacion;
+    }
+    
+}
\ No newline at end of file
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRActividadSeguimientoCarteraFacade.java b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRActividadSeguimientoCarteraFacade.java
index 0b5319e..4603c58 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRActividadSeguimientoCarteraFacade.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRActividadSeguimientoCarteraFacade.java
@@ -126,6 +126,33 @@
         return mapRespuesta;
     }
 
+    public BeanCRActividadSeguimientoCartera obtenerUltimaActividad(final String idSeguimiento,
+                                                                    final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        final String modulo = "CRActividadSeguimientoCarteraFacade.obtenerUltimaActividad()";
+        List<CRActividadSeguimientoCartera> listCRActividadSeguimientoCartera;
+        BeanCRActividadSeguimientoCartera beanCRActividadSeguimientoCartera = null;
+        PropertyParams propertyParams;
+
+        try {
+
+            propertyParams = new PropertyParams();
+            propertyParams.addProperty("crSeguimientoCartera.correlativoSeguimiento", idSeguimiento);
+            propertyParams.addProperty("estadoRegistro", Constante.INDICADOR_ESTADO_ACTIVO);
+            propertyParams.addPropertyOrder("correlativoActividad", true);
+            propertyParams.setMaxResults(1);
+
+            listCRActividadSeguimientoCartera = crActividadSeguimientoCarteraInterfaceLocal.findByProperties(propertyParams);
+
+            if (!_isEmpty(listCRActividadSeguimientoCartera)) {
+                beanCRActividadSeguimientoCartera = getBeanCRActividadSeguimientoCartera(listCRActividadSeguimientoCartera.get(0));
+            }
+
+        } catch (final Exception e) {
+            throw handlerError(e, beanParametrosAuditoria.getUsuarioInsercion(), modulo);
+        }
+        return beanCRActividadSeguimientoCartera;
+    }
+
     public BeanCRActividadSeguimientoCartera consultarActividad(String idActividad,
                                                                 BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
         final String modulo = "CRActividadSeguimientoCarteraFacade.obtenerDetalleSeguimientoCartera()";
@@ -155,15 +182,18 @@
         return beanCRActividadSeguimientoCartera;
     }
 
-    public void registrarActividad(BeanCRActividadSeguimientoCartera beanCRActividadSeguimientoCartera,
-                                   String idSeguimientoCartera,
-                                   BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+    public String registrarActividad(BeanCRActividadSeguimientoCartera beanCRActividadSeguimientoCartera,
+                                     String idSeguimientoCartera,
+                                     BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
         final String modulo = "CRActividadSeguimientoCarteraFacade.registrarActividad()";
         final String usuarioInsercion = beanParametrosAuditoria.getUsuarioInsercion();
         CRActividadSeguimientoCartera crActividadSeguimientoCartera;
+        CRSeguimientoCartera crSeguimientoCartera;
         String correlativoActividad;
+        String correlativoSeguimiento = CADENA_VACIA;
         try {
             if (!_isEmpty(beanCRActividadSeguimientoCartera.getCorrelativoActividad())) {
+                correlativoActividad = beanCRActividadSeguimientoCartera.getCorrelativoActividad();
                 crActividadSeguimientoCartera = crActividadSeguimientoCarteraInterfaceLocal.findById(beanCRActividadSeguimientoCartera.getCorrelativoActividad());
 
                 crActividadSeguimientoCartera.setComentarioActividad(beanCRActividadSeguimientoCartera.getComentarioActividad());
@@ -174,6 +204,8 @@
                 setModificacionAuditoria(crActividadSeguimientoCartera, beanParametrosAuditoria);
 
                 crActividadSeguimientoCarteraInterfaceLocal.update(crActividadSeguimientoCartera);
+
+                correlativoSeguimiento = crActividadSeguimientoCartera.getCrSeguimientoCartera().getCorrelativoSeguimiento();
             } else {
                 crActividadSeguimientoCartera = new CRActividadSeguimientoCartera();
                 correlativoActividad = generarCorrelativo("CRDSGAC", 15, beanParametrosAuditoria);
@@ -185,9 +217,10 @@
                 crActividadSeguimientoCartera.setFechaActividad(financ.util.FormatoFecha.stringToDateddMMyyyy(beanCRActividadSeguimientoCartera.getFechaActividad()));
                 crActividadSeguimientoCartera.setIndicadorEnvio(Constante.INDICADOR_NO_ENVIADO);
 
-                CRSeguimientoCartera crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(idSeguimientoCartera);
+                crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(idSeguimientoCartera);
                 if (!_isEmpty(crSeguimientoCartera)) {
                     crActividadSeguimientoCartera.setCrSeguimientoCartera(crSeguimientoCartera);
+                    correlativoSeguimiento = crSeguimientoCartera.getCorrelativoSeguimiento();
                 }
 
                 crActividadSeguimientoCartera.setEstadoRegistro(Constante.ESTADO_REGISTRO_VIGENTE);
@@ -195,12 +228,18 @@
 
                 crActividadSeguimientoCarteraInterfaceLocal.save(crActividadSeguimientoCartera);
             }
+
+            crSeguimientoCarteraFacadeInterfaceLocal.actualizarEstadoEnvioCorreoSeguimientoCartera(correlativoSeguimiento,
+                                                                                                   Constante.INDICADOR_ENVIADO,
+                                                                                                   beanParametrosAuditoria);
         } catch (final Exception e) {
             throw handlerError(e, usuarioInsercion, modulo);
         }
+        return correlativoActividad;
     }
 
-    public void eliminarActividad(String correlativoActividad, BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+    public void eliminarActividad(String correlativoActividad,
+                                  BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
         final String modulo = "CRActividadSeguimientoCarteraFacade.eliminarActividad()";
         final String usuarioInsercion = beanParametrosAuditoria.getUsuarioInsercion();
         CRActividadSeguimientoCartera crActividadSeguimientoCartera;
@@ -212,6 +251,10 @@
             setModificacionAuditoria(crActividadSeguimientoCartera, beanParametrosAuditoria);
 
             crActividadSeguimientoCarteraInterfaceLocal.update(crActividadSeguimientoCartera);
+
+            crSeguimientoCarteraFacadeInterfaceLocal.actualizarEstadoEnvioCorreoSeguimientoCartera(crActividadSeguimientoCartera.getCrSeguimientoCartera().getCorrelativoSeguimiento(),
+                                                                                                   Constante.INDICADOR_ENVIADO,
+                                                                                                   beanParametrosAuditoria);
         } catch (final Exception e) {
             throw handlerError(e, usuarioInsercion, modulo);
         }
@@ -249,16 +292,22 @@
                                                                                            beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
                                                                                            idTipoRespuesta,
                                                                                            beanParametrosAuditoria);
+
+            crSeguimientoCarteraFacadeInterfaceLocal.actualizarEstadoEnvioCorreoSeguimientoCartera(beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
+                                                                                                   Constante.INDICADOR_NO_ENVIADO,
+                                                                                                   beanParametrosAuditoria);
         } catch (Exception e) {
             throw handlerError(e, usuario, modulo);
         }
     }
 
-    private void actualizarIndicadorEnvio(String idMaestra, BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+    private void actualizarIndicadorEnvio(String idMaestra,
+                                          BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
 
         List<CRActividadSeguimientoCartera> listCRActividadSeguimientoCartera;
         PropertyParams propertyParams;
         BeanCRSeguimientoCartera crSeguimientoCartera = crSeguimientoCarteraFacadeInterfaceLocal.obtenerSeguimientoCarteraPorIdMaestra(idMaestra,
+                                                                                                                                       CADENA_VACIA,
                                                                                                                                        beanParametrosAuditoria);
         propertyParams = new PropertyParams();
         propertyParams.addProperty("crSeguimientoCartera.correlativoSeguimiento",
@@ -274,5 +323,4 @@
         }
 
     }
-
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRCargaAlertaFacade.java b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRCargaAlertaFacade.java
index fec56f5..737442d 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRCargaAlertaFacade.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRCargaAlertaFacade.java
@@ -7,10 +7,13 @@
 import javax.ejb.Stateless;
 
 import pe.com.tfc.utils.AbstractHandlerProcess;
+import pe.com.tfc.utils.ErrorControladoException;
 import pe.com.tfc.utils.GenericBean;
 import admin.contab.beans.BeanParametrosAuditoria;
 import admin.contab.beans.BeanParametrosLog;
+import admin.contab.entity.CBCatalogoCheckConstraint;
 import admin.contab.entity.CBUsuario;
+import admin.contab.local.CBCatalogoCheckConstraintInterfaceLocal;
 import admin.contab.local.CBUsuarioInterfaceLocal;
 import admin.util.ConstantesErrores;
 import financ.clientes.entity.CLClientes;
@@ -32,6 +35,8 @@
 import financ.seguimientoCartera.local.CRTipoAlertaInterfaceLocal;
 import financ.util.Constante;
 import financ.util.FormatoFecha;
+import pe.com.tfc.utils.AbstractHandlerProcess;
+import pe.com.tfc.utils.GenericBean;
 
 /**
  * CRCargaAlertaFacade
@@ -60,6 +65,8 @@
     private CRTipoAlertaInterfaceLocal crTipoAlertaInterfaceLocal;
     @EJB
     private CRCalificacionCreditoSbsInterfaceLocal crCalificacionCreditoSbsInterfaceLocal;
+    @EJB
+    private CBCatalogoCheckConstraintInterfaceLocal cbCatalogoCheckConstraintInterfaceLocal;
 
     public void enviar(List<BeanCRCargaAlerta> lstBeanCRCargaAlerta,
                        GenericBean genericBean,
@@ -173,6 +180,9 @@
                     beanCRSeguimientoCartera.setUsuarioAsignado(beanCRCargaAlerta.getUsuarioAsignado());
                     beanCRSeguimientoCartera.setCodigoCalificacionSBS(beanCRCargaAlerta.getCodigoCalificacionSBS());
                     beanCRSeguimientoCartera.setComentario(beanCRCargaAlerta.getComentario());
+                    beanCRSeguimientoCartera.setNumeroCredito(beanCRCargaAlerta.getNumeroCredito());
+                    beanCRSeguimientoCartera.setTipoProducto(beanCRCargaAlerta.getTipoProducto());
+                    beanCRSeguimientoCartera.setHoraAsignacion(FormatoFecha.obtenerHora());
 
                     crSeguimientoCarteraFacadeInterfaceLocal.guardarDetalleMasivo(beanCRSeguimientoCartera,
                                                                                   beanParametrosAuditoria);
@@ -205,6 +215,88 @@
         }
 
     }
+    
+    public void validarRegistroCargaIndividual(BeanCRSeguimientoCartera beanCRSeguimientoCartera,
+                                               BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+
+        String codigoAgencia;
+        //EXISTENCIA DE CLIENTE
+        CLPersonas clPersonas = clPersonasInterfaceLocal.findById(beanCRSeguimientoCartera.getCodigoCliente());
+
+        if (_isEmpty(clPersonas)) {
+            throw new ErrorControladoException(ConstantesErrores.ERROR_1988);
+        } else {
+            CLClientes clCliente = clClientesInterfaceLocal.findById(clPersonas.getCodigoPersona());
+
+            if (_isEmpty(clCliente)) {
+                throw new ErrorControladoException(ConstantesErrores.ERROR_1834);
+            } else {
+                beanCRSeguimientoCartera.setCodigoCliente(clCliente.getCodigoCliente());
+
+                List<CRCuentaCredito> lstCRCuentaCredito = new ArrayList<CRCuentaCredito>();
+                lstCRCuentaCredito = crCuentaCreditoInterfaceLocal.findByCodigoClienteEstadoCredito(clCliente.getCodigoCliente(),
+                                                                                                    Constante.ESTADO_CREDITO_VIGENTE,
+                                                                                                    "1");
+                if (_isEmpty(lstCRCuentaCredito)) {
+                    throw new ErrorControladoException(ConstantesErrores.ERROR_11174);
+                } else {
+                  //Pertenencia y vigencia del n�mero de cr�dito al cliente especificado
+                    String numeroCredito = null;
+                    for(CRCuentaCredito crCuentaCredito : lstCRCuentaCredito){
+                        if(_equiv(crCuentaCredito.getNumeroCredito(), beanCRSeguimientoCartera.getNumeroCredito())){
+                            numeroCredito = beanCRSeguimientoCartera.getNumeroCredito();
+                        }
+                    }
+                    if(_isEmpty(numeroCredito)){
+                        throw new ErrorControladoException(ConstantesErrores.ERROR_11186);
+                    }
+                    codigoAgencia = lstCRCuentaCredito.get(0).getCodigoAgencia();
+                    beanCRSeguimientoCartera.setCodigoAgencia(codigoAgencia);
+                }
+            }
+        }
+
+        List<CBCatalogoCheckConstraint> lstCBCatalogoCheckConstraint = cbCatalogoCheckConstraintInterfaceLocal.findByTablaCampo("CRDSGCA", "C_TIPPRO");
+        String codigoProducto = null;
+        for(CBCatalogoCheckConstraint cbCatalogoCheckConstraint : lstCBCatalogoCheckConstraint){
+            if(_equiv(beanCRSeguimientoCartera.getTipoProducto(), cbCatalogoCheckConstraint.getId().getValorConstraint())){
+                codigoProducto = cbCatalogoCheckConstraint.getId().getValorConstraint();
+            }
+        }
+        if(_isEmpty(codigoProducto)){
+            throw new ErrorControladoException(ConstantesErrores.ERROR_11187);
+        }
+        
+        //FECHA DE ATENCION
+        if (!FormatoFecha.stringToDateddMMyyyy(beanCRSeguimientoCartera.getFechaAtencion()).after(beanParametrosAuditoria.getFechaProceso())) {
+            throw new ErrorControladoException(ConstantesErrores.ERROR_11175);
+        }
+
+        //USUARIO ASIGNADO
+        CBUsuario cbUsuario = cbUsuarioInterfaceLocal.findById(beanCRSeguimientoCartera.getUsuarioAsignado());
+        if (_isEmpty(cbUsuario)) {
+            throw new ErrorControladoException(ConstantesErrores.ERROR_983);
+        } else {
+            if (!_isEmpty(codigoAgencia)) {
+                List<CBUsuario> listCBUsuario = cbUsuarioInterfaceLocal.lstUsuariosfindByCodigoAgenciaCodigoEmpresaEstadoRegistro(Constante.ID_TFC,
+                                                                                                                                  codigoAgencia,
+                                                                                                                                  cbUsuario.getCodigoUsuario());
+                if (_isEmpty(listCBUsuario)) {
+                    throw new ErrorControladoException(ConstantesErrores.ERROR_11176);
+                }
+            }
+        }
+
+        CRTipoAlerta crTipoAlerta = crTipoAlertaInterfaceLocal.findById(beanCRSeguimientoCartera.getCodigoTipoAlerta());
+        if (_isEmpty(crTipoAlerta)) {
+            throw new ErrorControladoException(ConstantesErrores.ERROR_11177);
+        }
+
+        CRCalificacionCreditoSbs crCalificacionCreditoSbs = crCalificacionCreditoSbsInterfaceLocal.findById(beanCRSeguimientoCartera.getCodigoCalificacionSBS());
+        if (_isEmpty(crCalificacionCreditoSbs)) {
+            throw new ErrorControladoException(ConstantesErrores.ERROR_11177);
+        }
+    }
 
     private List<String> validarRegistro(BeanCRCargaAlerta beanCRCargaAlerta,
                                          BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
@@ -233,12 +325,32 @@
                 if (_isEmpty(lstCRCuentaCredito)) {
                     lstErrores.add(ConstantesErrores.ERROR_11174);
                 } else {
+                    //Pertenencia y vigencia del n�mero de cr�dito al cliente especificado
+                    String numeroCredito = null;
+                    for(CRCuentaCredito crCuentaCredito : lstCRCuentaCredito){
+                        if(_equiv(crCuentaCredito.getNumeroCredito(), beanCRCargaAlerta.getNumeroCredito())){
+                            numeroCredito = beanCRCargaAlerta.getNumeroCredito();
+                        }
+                    }
+                    if(_isEmpty(numeroCredito)){
+                        lstErrores.add(ConstantesErrores.ERROR_11186);
+                    }
                     codigoAgencia = lstCRCuentaCredito.get(0).getCodigoAgencia();
                     beanCRCargaAlerta.setCodigoAgencia(codigoAgencia);
                 }
             }
         }
 
+        List<CBCatalogoCheckConstraint> lstCBCatalogoCheckConstraint = cbCatalogoCheckConstraintInterfaceLocal.findByTablaCampo("CRDSGCA", "C_TIPPRO");
+        String codigoProducto = null;
+        for(CBCatalogoCheckConstraint cbCatalogoCheckConstraint : lstCBCatalogoCheckConstraint){
+            if(_equiv(beanCRCargaAlerta.getTipoProducto(), cbCatalogoCheckConstraint.getId().getValorConstraint())){
+                codigoProducto = cbCatalogoCheckConstraint.getId().getValorConstraint();
+            }
+        }
+        if(_isEmpty(codigoProducto)){
+            lstErrores.add(ConstantesErrores.ERROR_11187);
+        }
         //FECHA DE ATENCION
         if (!beanCRCargaAlerta.getFechaAtencion().after(beanParametrosAuditoria.getFechaProceso())) {
             lstErrores.add(ConstantesErrores.ERROR_11175);
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRDocumentosPorActividadFacade.java b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRDocumentosPorActividadFacade.java
index 11a6bcb..57a796d 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRDocumentosPorActividadFacade.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRDocumentosPorActividadFacade.java
@@ -1,12 +1,32 @@
 package financ.seguimientoCartera.facade;
 
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
 import javax.ejb.EJB;
 import javax.ejb.Stateless;
 
 import pe.com.tfc.utils.AbstractFacade;
+import pe.com.tfc.utils.PropertyParams;
+import admin.contab.beans.BeanParametrosAuditoria;
+import admin.util.BeanCombo;
+import admin.util.Constante;
+import admin.util.local.UtilAdminFacadeInterfaceLocal;
+import financ.seguimientoCartera.beans.BeanCRDocumentosPorActividad;
+import financ.seguimientoCartera.entity.CRActividadSeguimientoCartera;
 import financ.seguimientoCartera.entity.CRDocumentosPorActividad;
+import financ.seguimientoCartera.entity.CRSeguimientoCartera;
+import financ.seguimientoCartera.local.CRActividadSeguimientoCarteraInterfaceLocal;
 import financ.seguimientoCartera.local.CRDocumentosPorActividadFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRDocumentosPorActividadInterfaceLocal;
+import financ.seguimientoCartera.local.CRSeguimientoCarteraFacadeInterfaceLocal;
+import financ.seguimientoCartera.local.CRSeguimientoCarteraInterfaceLocal;
+import financ.util.Paginacion;
+import financ.util.file.entity.CBFile;
+import financ.util.file.local.CBFileFacadeInterfaceLocal;
+import financ.util.file.local.CBFileInterfaceLocal;
 
 /**
  * CRDocumentosPorActividadFacade
@@ -22,5 +42,146 @@
 
     @EJB
     private CRDocumentosPorActividadInterfaceLocal crDocumentosPorActividadInterfaceLocal;
+    @EJB
+    private CBFileFacadeInterfaceLocal cbFileFacadeInterfaceLocal;
+    @EJB
+    private CBFileInterfaceLocal cbFileInterfaceLocal;
+    @EJB
+    private CRActividadSeguimientoCarteraInterfaceLocal crActividadSeguimientoCarteraInterfaceLocal;
+    @EJB
+    private UtilAdminFacadeInterfaceLocal utilAdminFacadeInterfaceLocal;
+    @EJB
+    private CRSeguimientoCarteraInterfaceLocal crSeguimientoCarteraInterfaceLocal;
+    @EJB
+    private CRSeguimientoCarteraFacadeInterfaceLocal crSeguimientoCarteraFacadeInterfaceLocal;
 
+    public Map<String, Object> listarDocumentosPorActividad(final String idActividad,
+                                                            final Integer pagina,
+                                                            final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        Long cantReg = 0L;
+        int inicio;
+
+        final String modulo = "CRDocumentosPorActividadFacade.listarDocumentosPorActividad()";
+        List<CRDocumentosPorActividad> listCRDocumentosPorActividad;
+        final Map<String, Object> mapRespuesta = new HashMap<String, Object>();
+        final List<BeanCRDocumentosPorActividad> listBeanCRDocumentosPorActividad = new ArrayList<BeanCRDocumentosPorActividad>(0);
+        PropertyParams propertyParams;
+        try {
+            inicio = (pagina - 1) * Paginacion.NUM_REG;
+
+            propertyParams = new PropertyParams();
+            propertyParams.addProperty("crActividadSeguimientoCartera.correlativoActividad", idActividad);
+            propertyParams.addProperty("estadoRegistro", Constante.INDICADOR_ESTADO_ACTIVO);
+            propertyParams.addPropertyOrder("correlativoDocumentoXActividad", true);
+            propertyParams.setFirstResult(inicio);
+            propertyParams.setMaxResults(Paginacion.NUM_REG);
+
+            cantReg = crDocumentosPorActividadInterfaceLocal.countByProperties(propertyParams);
+            listCRDocumentosPorActividad = crDocumentosPorActividadInterfaceLocal.findByProperties(propertyParams);
+
+            for (final CRDocumentosPorActividad crDocumentosPorActividad : listCRDocumentosPorActividad) {
+                listBeanCRDocumentosPorActividad.add(get(crDocumentosPorActividad, beanParametrosAuditoria));
+            }
+
+            mapRespuesta.put("listBeanCRDocumentosPorActividad", listBeanCRDocumentosPorActividad);
+            mapRespuesta.put("cantReg", cantReg);
+        } catch (final Exception e) {
+            throw handlerError(e, beanParametrosAuditoria.getUsuarioInsercion(), modulo);
+        }
+        return mapRespuesta;
+    }
+
+    public void guardarDocumentoPorActividad(String idFile,
+                                             String idActividad,
+                                             String cboTipoDocumento,
+                                             String textoComentario,
+                                             BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "CRDocumentosPorActividadFacade.guardarDocumentoPorActividad()";
+        String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        String correlativoFile;
+        String correlativoDocumentoPorActividad;
+        CRDocumentosPorActividad crDocumentosPorActividad;
+        try {
+            correlativoFile = cbFileFacadeInterfaceLocal.guardarFromTemporal(idFile, beanParametrosAuditoria);
+            crDocumentosPorActividad = new CRDocumentosPorActividad();
+
+            correlativoDocumentoPorActividad = generarCorrelativo("CRDACDO", 15, beanParametrosAuditoria);
+            crDocumentosPorActividad.setCorrelativoDocumentoXActividad(correlativoDocumentoPorActividad);
+
+            CBFile cbFile = cbFileInterfaceLocal.findById(correlativoFile);
+            if (!_isEmpty(cbFile)) {
+                crDocumentosPorActividad.setCbFile(cbFile);
+            }
+            CRActividadSeguimientoCartera crActividadSeguimientoCartera = crActividadSeguimientoCarteraInterfaceLocal.findById(idActividad);
+            if (!_isEmpty(crActividadSeguimientoCartera)) {
+                crDocumentosPorActividad.setCrActividadSeguimientoCartera(crActividadSeguimientoCartera);
+            }
+            crDocumentosPorActividad.setTipoDocumento(cboTipoDocumento);
+            crDocumentosPorActividad.setComentarioDocumento(textoComentario);
+            crDocumentosPorActividad.setEstadoRegistro(Constante.ESTADO_REGISTRO_VIGENTE);
+            setInsercionAuditoria(crDocumentosPorActividad, beanParametrosAuditoria);
+
+            crDocumentosPorActividadInterfaceLocal.update(crDocumentosPorActividad);
+        } catch (Exception e) {
+            throw handlerError(e, usuario, modulo);
+        }
+    }
+
+    public void borrarRegistroDocumentoPorActividad(String idCorrelativo,
+                                                    String idFile,
+                                                    BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "CRDocumentosPorActividadFacade.borrarRegistroDocumentoPorActividad()";
+        String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        CRDocumentosPorActividad crDocumentosPorActividad;
+        CRSeguimientoCartera crSeguimientoCartera;
+        try {
+
+            crDocumentosPorActividad = crDocumentosPorActividadInterfaceLocal.findById(idCorrelativo);
+            crDocumentosPorActividad.setCbFile(null);
+            crDocumentosPorActividad.setEstadoRegistro(Constante.ESTADO_REGISTRO_NO_VIGENTE);
+            setModificacionAuditoria(crDocumentosPorActividad, beanParametrosAuditoria);
+            crDocumentosPorActividadInterfaceLocal.update(crDocumentosPorActividad);
+
+            cbFileInterfaceLocal.delete(idFile);
+
+            crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(crDocumentosPorActividad.getCrActividadSeguimientoCartera().getCrSeguimientoCartera().getCorrelativoSeguimiento());
+            crSeguimientoCartera.setIndicadorEnvioCorreo(Constante.INDICADOR_ENVIADO);
+            setModificacionAuditoria(crSeguimientoCartera, beanParametrosAuditoria);
+            crSeguimientoCarteraInterfaceLocal.update(crSeguimientoCartera);
+        } catch (Exception e) {
+            throw handlerError(e, usuario, modulo);
+        }
+
+    }
+
+    private BeanCRDocumentosPorActividad get(CRDocumentosPorActividad crDocumentosPorActividad,
+                                             BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        BeanCRDocumentosPorActividad beanCRDocumentosPorActividad = new BeanCRDocumentosPorActividad();
+        if (_isEmpty(crDocumentosPorActividad)) {
+            return beanCRDocumentosPorActividad;
+        }
+
+        beanCRDocumentosPorActividad.setComentarioDocumento(crDocumentosPorActividad.getComentarioDocumento());
+        beanCRDocumentosPorActividad.setCorrelativoDocumentoXActividad(crDocumentosPorActividad.getCorrelativoDocumentoXActividad());
+        beanCRDocumentosPorActividad.setIdActividad(crDocumentosPorActividad.getCrActividadSeguimientoCartera().getCorrelativoActividad());
+
+        beanCRDocumentosPorActividad.setTipoDocumento(crDocumentosPorActividad.getTipoDocumento());
+        BeanCombo beanCombo = utilAdminFacadeInterfaceLocal.obtenerOpcionComboGenerico(admin.util.Constante.SEGUIMIENTO_CARTERA_COMBO_GENERICO_TIPO_DOCUMENTO,
+                                                                                       crDocumentosPorActividad.getTipoDocumento(),
+                                                                                       beanParametrosAuditoria);
+        if (!_isEmpty(beanCombo.getDescripcion())) {
+            beanCRDocumentosPorActividad.setDescripcionTipoDocumento(beanCombo.getDescripcion());
+        }
+        beanCRDocumentosPorActividad.setIdFile(crDocumentosPorActividad.getCbFile().getIdFile());
+        CBFile cbFile = cbFileInterfaceLocal.findById(crDocumentosPorActividad.getCbFile().getIdFile());
+        if (!_isEmpty(cbFile)) {
+            beanCRDocumentosPorActividad.setNombreFile(cbFile.getNombre());
+            Long size = cbFile.getSize() / 1024L;
+            beanCRDocumentosPorActividad.setExtensionFile(cbFile.getExtension());
+            beanCRDocumentosPorActividad.setTamanioFile(size.toString() + " KB");
+            beanCRDocumentosPorActividad.setFechaRegistro(financ.util.FormatoFecha.dateToStringDDMMYYYYY(cbFile.getFechaInsercion()));
+            beanCRDocumentosPorActividad.setUsuarioRegistro(cbFile.getUsuarioInsercion());
+        }
+        return beanCRDocumentosPorActividad;
+    }
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRMaestroSeguimientoFacade.java b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRMaestroSeguimientoFacade.java
index 48e1b9e..1b7c9e2 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRMaestroSeguimientoFacade.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRMaestroSeguimientoFacade.java
@@ -107,7 +107,6 @@
         cbCatalogoCheckConstraint = cbCatalogoCheckConstraintInterfaceLocal.findById(new CBCatalogoCheckConstraintId("CRMSGCA", "C_CODEST", crMaestroSeguimiento.getCodigoEstado()));
         if (!_isEmpty(cbCatalogoCheckConstraint)) {
             beanCRMaestroSeguimiento.setDescripcionEstado(cbCatalogoCheckConstraint.getDescripcion());
-            ;
         }
 
         return beanCRMaestroSeguimiento;
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRMovimientoPorSeguimientoFacade.java b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRMovimientoPorSeguimientoFacade.java
index 6b282bc..e83295b 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRMovimientoPorSeguimientoFacade.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRMovimientoPorSeguimientoFacade.java
@@ -57,7 +57,7 @@
             propertyParams.addProperty("wfMovimientos.wfEtapaFinal.idEtapa", idEtapa);
             propertyParams.addProperty("estadoRegistro", Constante.INDICADOR_SI);
             propertyParams.setMaxResults(1);
-            propertyParams.setOrderBy(true, "crSeguimientoCartera.correlativoSeguimiento");
+            propertyParams.setOrderBy(true, "idMovimientoSeguimiento");
             listCRMovimientoPorSeguimiento = crMovimientoPorSeguimientoInterfaceLocal.findByProperties(propertyParams);
 
             for (final CRMovimientoPorSeguimiento crMovimientoPorSeguimiento : listCRMovimientoPorSeguimiento) {
@@ -74,10 +74,12 @@
         if (_isEmpty(crMovimientoPorSeguimiento)) {
             return beanCRMovimientoPorSeguimiento;
         }
-
+        beanCRMovimientoPorSeguimiento.setIdSeguimientoMovimiento(crMovimientoPorSeguimiento.getIdMovimientoSeguimiento());
         beanCRMovimientoPorSeguimiento.setIdMovimiento(crMovimientoPorSeguimiento.getWfMovimientos().getIdMovimiento());
         beanCRMovimientoPorSeguimiento.setIdSeguimientoCartera(crMovimientoPorSeguimiento.getCrSeguimientoCartera().getCorrelativoSeguimiento());
-        beanCRMovimientoPorSeguimiento.setIdTipoMotivo(crMovimientoPorSeguimiento.getCrMotivoSeguimientoCartera().getIdMotivoSeguimiento());
+        if(!_isEmpty(crMovimientoPorSeguimiento.getCrMotivoSeguimientoCartera())){
+            beanCRMovimientoPorSeguimiento.setIdTipoMotivo(crMovimientoPorSeguimiento.getCrMotivoSeguimientoCartera().getIdMotivoSeguimiento());
+        }
         beanCRMovimientoPorSeguimiento.setIdTipoRespuesta(crMovimientoPorSeguimiento.getIdTipoRespuesta());
 
         return beanCRMovimientoPorSeguimiento;
@@ -96,7 +98,6 @@
         try {
             correlativo = generarCorrelativo("CRDSGMV", 15, beanParametrosAuditoria);
             crMovimientoPorSeguimiento.setIdMovimientoSeguimiento(correlativo);
-            crMovimientoPorSeguimiento.setIdTipoRespuesta(Constante.CODIGO_TIPO_RESPUESTA_ENVIADO);
 
             CRSeguimientoCartera crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(idSeguimientoCartera);
             crMovimientoPorSeguimiento.setCrSeguimientoCartera(crSeguimientoCartera);
@@ -106,6 +107,11 @@
 
             WFMovimientos wfMovimientos = wfMovimientosInterfaceLocal.findById(idMovimiento);
             crMovimientoPorSeguimiento.setWfMovimientos(wfMovimientos);
+            if(!_isEmpty(idTipoRespuesta)){
+                crMovimientoPorSeguimiento.setIdTipoRespuesta(idTipoRespuesta);
+            }else{
+                crMovimientoPorSeguimiento.setIdTipoRespuesta(Constante.CODIGO_TIPO_RESPUESTA_ENVIADO);
+            }
 
             crMovimientoPorSeguimiento.setEstadoRegistro(Constante.ESTADO_REGISTRO_VIGENTE);
             setInsercionAuditoria(crMovimientoPorSeguimiento, beanParametrosAuditoria);
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRSeguimientoCarteraFacade.java b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRSeguimientoCarteraFacade.java
index 214fe03..1687e7e 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRSeguimientoCarteraFacade.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/facade/CRSeguimientoCarteraFacade.java
@@ -1,6 +1,7 @@
 package financ.seguimientoCartera.facade;
 
 import java.util.ArrayList;
+import java.util.Date;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
@@ -14,34 +15,55 @@
 import admin.contab.beans.BeanParametrosAuditoria;
 import admin.contab.entity.CBAgencia;
 import admin.contab.entity.CBAgenciaId;
+import admin.contab.entity.CBCatalogoCheckConstraint;
+import admin.contab.entity.CBCatalogoCheckConstraintId;
+import admin.contab.entity.CBRegionesAgencia;
 import admin.contab.entity.CBUsuario;
 import admin.contab.local.CBAgenciaInterfaceLocal;
+import admin.contab.local.CBCatalogoCheckConstraintInterfaceLocal;
+import admin.contab.local.CBRegionesAgenciaInterfaceLocal;
 import admin.contab.local.CBUsuarioInterfaceLocal;
-import admin.util.FormatoFecha;
+import admin.util.local.UtilAdminFacadeInterfaceLocal;
 import financ.clientes.entity.CLPersonas;
 import financ.clientes.local.CLClientesInterfaceLocal;
+import financ.clientes.local.CLEmailsPersonasFacadeInterfaceLocal;
 import financ.clientes.local.CLPersonasInterfaceLocal;
 import financ.creditos.entity.CRCalificacionCreditoSbs;
 import financ.creditos.local.CRCalificacionCreditoSbsInterfaceLocal;
+import financ.email.local.GEMailSenderFacadeInterfaceLocal;
+import financ.seguimientoCartera.beans.BeanCRActividadSeguimientoCartera;
+import financ.seguimientoCartera.beans.BeanCRMovimientoPorSeguimiento;
 import financ.seguimientoCartera.beans.BeanCRSeguimientoCartera;
 import financ.seguimientoCartera.entity.CRMaestroSeguimiento;
+import financ.seguimientoCartera.entity.CRMovimientoPorSeguimiento;
 import financ.seguimientoCartera.entity.CRSeguimientoCartera;
 import financ.seguimientoCartera.entity.CRTipoAlerta;
+import financ.seguimientoCartera.local.CRActividadSeguimientoCarteraFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRMovimientoPorSeguimientoFacadeInterfaceLocal;
+import financ.seguimientoCartera.local.CRMovimientoPorSeguimientoInterfaceLocal;
 import financ.seguimientoCartera.local.CRSeguimientoCarteraFacadeInterfaceLocal;
 import financ.seguimientoCartera.local.CRSeguimientoCarteraInterfaceLocal;
 import financ.seguimientoCartera.local.CRTipoAlertaInterfaceLocal;
 import financ.util.Constante;
+import financ.util.FormatoFecha;
 import financ.util.Paginacion;
+import financ.workflow.bean.BeanWFEstado;
+import financ.workflow.bean.BeanWFEtapa;
+import financ.workflow.bean.BeanWFEvento;
 import financ.workflow.bean.BeanWFEventoPorEtapa;
 import financ.workflow.bean.BeanWFMaestra;
+import financ.workflow.bean.BeanWFMovimientos;
 import financ.workflow.entity.WFEvento;
 import financ.workflow.entity.WFMaestra;
+import financ.workflow.local.WFEstadoFacadeInterfaceLocal;
+import financ.workflow.local.WFEtapaFacadeInterfaceLocal;
+import financ.workflow.local.WFEventoFacadeInterfaceLocal;
 import financ.workflow.local.WFEventoInterfaceLocal;
 import financ.workflow.local.WFEventoPorEtapaFacadeInterfaceLocal;
 import financ.workflow.local.WFMaestraFacadeInterfaceLocal;
 import financ.workflow.local.WFMaestraInterfaceLocal;
 import financ.workflow.local.WFModuloFacadeInterfaceLocal;
+import financ.workflow.local.WFMovimientosFacadeInterfaceLocal;
 import financ.workflow.local.WFRutaFacadeInterfaceLocal;
 
 /**
@@ -84,10 +106,31 @@
     private WFEventoInterfaceLocal wfEventoInterfaceLocal;
     @EJB
     private WFModuloFacadeInterfaceLocal wfModuloFacadeInterfaceLocal;
+    @EJB
+    private WFEventoFacadeInterfaceLocal wfEventoFacadeInterfaceLocal;
+    @EJB
+    private GEMailSenderFacadeInterfaceLocal geMailSenderFacadeInterfaceLocal;
+    @EJB
+    private CLEmailsPersonasFacadeInterfaceLocal clEmailsPersonasFacadeInterfaceLocal;
+    @EJB
+    private WFEstadoFacadeInterfaceLocal wfEstadoFacadeInterfaceLocal;
+    @EJB
+    private CBRegionesAgenciaInterfaceLocal cbRegionesAgenciaInterfaceLocal;
+    @EJB
+    private CBCatalogoCheckConstraintInterfaceLocal cbCatalogoCheckConstraintInterfaceLocal;
+    @EJB
+    private WFMovimientosFacadeInterfaceLocal wfMovimientosFacadeInterfaceLocal;
+    @EJB
+    private UtilAdminFacadeInterfaceLocal utilAdminFacadeInterfaceLocal;
+    @EJB
+    private CRMovimientoPorSeguimientoInterfaceLocal crMovimientoPorSeguimientoInterfaceLocal;
+    @EJB
+    private WFEtapaFacadeInterfaceLocal wfEtapaFacadeInterfaceLocal;
+
+    private CRActividadSeguimientoCarteraFacadeInterfaceLocal crActividadSeguimientoCarteraFacadeInterfaceLocal;
 
     public void guardarDetalleMasivo(BeanCRSeguimientoCartera beanCRSeguimientoCartera,
                                      BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
-
         CRSeguimientoCartera crSeguimientoCartera;
         String correlativoSeguimientoCartera;
 
@@ -99,14 +142,17 @@
 
             crSeguimientoCartera.setTipoSeguimiento(beanCRSeguimientoCartera.getIdTipoSeguimiento());
             crSeguimientoCartera.setIdLote(beanCRSeguimientoCartera.getIdLote());
-            crSeguimientoCartera.setFechaAlerta(FormatoFecha.stringToDate(beanCRSeguimientoCartera.getFechaAlerta()));
+            crSeguimientoCartera.setFechaAlerta(FormatoFecha.stringToUtilDate(beanCRSeguimientoCartera.getFechaAlerta()));
             crSeguimientoCartera.setMontoAlerta(beanCRSeguimientoCartera.getMontoAlerta());
-            crSeguimientoCartera.setFechaAtencion(FormatoFecha.stringToDate(beanCRSeguimientoCartera.getFechaAtencion()));
+            crSeguimientoCartera.setFechaAtencion(FormatoFecha.stringToUtilDate(beanCRSeguimientoCartera.getFechaAtencion()));
             crSeguimientoCartera.setMontoProvision(beanCRSeguimientoCartera.getMontoProvision());
             crSeguimientoCartera.setInteresDevengado(beanCRSeguimientoCartera.getInteresDevengado());
             crSeguimientoCartera.setAgenciaAsignada(beanCRSeguimientoCartera.getCodigoAgencia());
             crSeguimientoCartera.setFechaAsignacion(financ.util.FormatoFecha.stringToDateddMMyyyy(beanCRSeguimientoCartera.getFechaAsignada()));
             crSeguimientoCartera.setUsuarioAsignado(beanCRSeguimientoCartera.getUsuarioAsignado());
+            crSeguimientoCartera.setIndicadorEnvioCorreo(Constante.ESTADO_REGISTRO_NOVIGENTE);
+            crSeguimientoCartera.setNumeroCredito(beanCRSeguimientoCartera.getNumeroCredito());
+            crSeguimientoCartera.setTipoProducto(beanCRSeguimientoCartera.getTipoProducto());
 
             CLPersonas clPersonas = clPersonasInterfaceLocal.findById(beanCRSeguimientoCartera.getCodigoCliente());
             crSeguimientoCartera.setClPersonas(clPersonas);
@@ -131,6 +177,7 @@
     }
 
     public BeanCRSeguimientoCartera obtenerSeguimientoCarteraPorIdMaestra(String idMaestra,
+                                                                          String idEtapa,
                                                                           BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
         final String modulo = "CRDetalleSeguimientoFacade.obtenerDetalleSeguimientoCartera()";
         List<CRSeguimientoCartera> listCRSeguimientoCartera = new ArrayList<CRSeguimientoCartera>(0);
@@ -139,13 +186,17 @@
         PropertyParams propertyParams;
 
         try {
+            crActividadSeguimientoCarteraFacadeInterfaceLocal = lookup(CRActividadSeguimientoCarteraFacade.LocalJNDIName);
+
             propertyParams = new PropertyParams();
             propertyParams.setMaxResults(1);
             propertyParams.addProperty("wfMaestra.idMaestra", idMaestra);
             listCRSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findByProperties(propertyParams);
 
             for (final CRSeguimientoCartera crSeguimientoCartera : listCRSeguimientoCartera) {
-                beanCRSeguimientoCartera = getBeanCRSeguimientoCartera(crSeguimientoCartera, beanParametrosAuditoria);
+                beanCRSeguimientoCartera = getBeanCRSeguimientoCartera(crSeguimientoCartera,
+                                                                       idEtapa,
+                                                                       beanParametrosAuditoria);
             }
         } catch (final Exception e) {
             throw handlerError(e, beanParametrosAuditoria.getUsuarioInsercion(), modulo);
@@ -160,8 +211,12 @@
         BeanCRSeguimientoCartera BeanCRSeguimientoCartera = null;
         CRSeguimientoCartera crSeguimientoCartera;
         try {
+            crActividadSeguimientoCarteraFacadeInterfaceLocal = lookup(CRActividadSeguimientoCarteraFacade.LocalJNDIName);
+
             crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(correlativoSeguimiento);
-            BeanCRSeguimientoCartera = getBeanCRSeguimientoCartera(crSeguimientoCartera, beanParametrosAuditoria);
+            BeanCRSeguimientoCartera = getBeanCRSeguimientoCartera(crSeguimientoCartera,
+                                                                   crSeguimientoCartera.getWfMaestra().getWfEtapa().getIdEtapa(),
+                                                                   beanParametrosAuditoria);
         } catch (Exception e) {
             throw handlerError(e, usuario, modulo);
         }
@@ -169,8 +224,15 @@
     }
 
     private BeanCRSeguimientoCartera getBeanCRSeguimientoCartera(CRSeguimientoCartera crSeguimientoCartera,
+                                                                 String idEtapa,
                                                                  BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String tiempoTranscurrido;
+        BeanWFMovimientos beanWFMovimientos = null;
+        BeanCRActividadSeguimientoCartera beanCRActividadSeguimientoCartera;
         BeanCRSeguimientoCartera beanCRSeguimientoCartera = new BeanCRSeguimientoCartera();
+        CBCatalogoCheckConstraint cbCatalogoCheckConstraint;
+        Date fechaFin;
+        String horaFin;
         if (_isEmpty(crSeguimientoCartera)) {
             return beanCRSeguimientoCartera;
         }
@@ -196,8 +258,14 @@
             beanCRSeguimientoCartera.setNombreUsuarioAsignado(cbUsuario.getNombreCompleto());
         }
 
+        cbCatalogoCheckConstraint = cbCatalogoCheckConstraintInterfaceLocal.findById(new CBCatalogoCheckConstraintId("CRDSGCA", "C_TIPPRO", crSeguimientoCartera.getTipoProducto()));
+        if (!_isEmpty(cbCatalogoCheckConstraint)) {
+            beanCRSeguimientoCartera.setDescripcionProducto(cbCatalogoCheckConstraint.getDescripcion());
+        }
+
         beanCRSeguimientoCartera.setCodigoCliente(crSeguimientoCartera.getClPersonas().getCodigoPersona());
         beanCRSeguimientoCartera.setNombreCliente(crSeguimientoCartera.getClPersonas().getNombreoRazonSocial());
+        beanCRSeguimientoCartera.setTipoPersona(crSeguimientoCartera.getClPersonas().getClTipoPersona().getCodigoTipoPersona());
 
         beanCRSeguimientoCartera.setFechaAlerta(financ.util.FormatoFecha.dateToStringDDMMYYYYY(crSeguimientoCartera.getFechaAlerta()));
         beanCRSeguimientoCartera.setMontoAlerta(crSeguimientoCartera.getMontoAlerta());
@@ -208,11 +276,61 @@
         beanCRSeguimientoCartera.setInteresDevengado(crSeguimientoCartera.getInteresDevengado());
         beanCRSeguimientoCartera.setCodigoCalificacionSBS(crSeguimientoCartera.getCrCalificacionCreditoSbs().getCalificacionSbs());
         beanCRSeguimientoCartera.setComentario(crSeguimientoCartera.getComentario());
+        beanCRSeguimientoCartera.setNumeroCredito(crSeguimientoCartera.getNumeroCredito());
+        beanCRSeguimientoCartera.setTipoProducto(crSeguimientoCartera.getTipoProducto());
 
-        if (!_isEmpty(crSeguimientoCartera.getWfMaestra())) {
-            BeanWFMaestra beanWFMaestra = wfMaestraFacadeInterfaceLocal.consultarMaestra(crSeguimientoCartera.getWfMaestra().getIdMaestra(),
-                                                                                         beanParametrosAuditoria);
-            beanCRSeguimientoCartera.setDescripcionEstado(beanWFMaestra.getDescripcionEstado());
+        if(!_isEmpty(crSeguimientoCartera.getWfMaestra())){
+            beanWFMovimientos = wfMovimientosFacadeInterfaceLocal.obtenerUltimoMovimiento(crSeguimientoCartera.getWfMaestra().getIdMaestra(),
+                                                                                          beanParametrosAuditoria);
+        }
+        fechaFin = crSeguimientoCartera.getFechaAsignacion();
+        horaFin = financ.util.FormatoFecha.obtenerHora();
+        if (!_isEmpty(beanWFMovimientos)) {
+
+            beanCRSeguimientoCartera.setDescripcionEstado(beanWFMovimientos.getDescripcionEstadoFinal());
+
+            if (_equiv(beanWFMovimientos.getKeyEstadoFinal(), Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_FINALIZADO)) {
+                beanCRSeguimientoCartera.setFechaResolucion(FormatoFecha.dateUtilToStringDDMMYYYY(beanWFMovimientos.getFechaProceso()));
+                beanCRSeguimientoCartera.setComentarioResolucion(beanWFMovimientos.getTextoComentario());
+                fechaFin = beanWFMovimientos.getFechaProceso();
+                horaFin = beanWFMovimientos.getHoraProceso();
+            }
+
+            if (!_equiv(beanWFMovimientos.getKeyEstadoFinal(), Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_REGISTRADO)) {
+                beanCRActividadSeguimientoCartera = crActividadSeguimientoCarteraFacadeInterfaceLocal.obtenerUltimaActividad(crSeguimientoCartera.getCorrelativoSeguimiento(),
+                                                                                                                             beanParametrosAuditoria);
+                if (!_isEmpty(beanCRActividadSeguimientoCartera)) {
+                    beanCRSeguimientoCartera.setFechaUltimaActividad(beanCRActividadSeguimientoCartera.getFechaActividad());
+                    beanCRSeguimientoCartera.setComentarioUltimaActividad(beanCRActividadSeguimientoCartera.getComentarioActividad());
+                }
+            }
+        }
+
+        if (!_isEmpty(fechaFin)) {
+            tiempoTranscurrido = utilAdminFacadeInterfaceLocal.obtenerTiempoTranscurrido(crSeguimientoCartera.getFechaAsignacion(),
+                                                                                         fechaFin,
+                                                                                         crSeguimientoCartera.getHoraAsignacion(),
+                                                                                         horaFin,
+                                                                                         crSeguimientoCartera.getAgenciaAsignada());
+            beanCRSeguimientoCartera.setTiempoTranscurrido(tiempoTranscurrido);
+        }
+
+        beanCRSeguimientoCartera.setIndicadorEnvioCorreo(crSeguimientoCartera.getIndicadorEnvioCorreo());
+
+        if (!_isEmpty(idEtapa)) {
+            BeanCRMovimientoPorSeguimiento beanCRMovimientoPorSeguimiento = crMovimientoPorSeguimientoFacadeInterfaceLocal.listarMovimientoSeguimientoUltimoRegistro(crSeguimientoCartera.getCorrelativoSeguimiento(),
+                                                                                                                                                                     idEtapa,
+                                                                                                                                                                     beanParametrosAuditoria);
+
+            if (!_isEmpty(beanCRMovimientoPorSeguimiento)) {
+                beanCRSeguimientoCartera.setIdTipoRespuesta(beanCRMovimientoPorSeguimiento.getIdTipoRespuesta());
+                beanCRSeguimientoCartera.setCodigoMotivo(beanCRMovimientoPorSeguimiento.getIdTipoMotivo());
+
+                CRMovimientoPorSeguimiento crMovimientoPorSeguimiento = crMovimientoPorSeguimientoInterfaceLocal.findById(beanCRMovimientoPorSeguimiento.getIdSeguimientoMovimiento());
+                if (!_isEmpty(crMovimientoPorSeguimiento) && !_isEmpty(crMovimientoPorSeguimiento.getCrMotivoSeguimientoCartera())) {
+                    beanCRSeguimientoCartera.setMotivoSeguimientoCartera(crMovimientoPorSeguimiento.getCrMotivoSeguimientoCartera().getDescripcionMotivo());
+                }
+            }
         }
 
         return beanCRSeguimientoCartera;
@@ -224,9 +342,9 @@
                                             String textoComentario,
                                             BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
 
-        String modulo = "CRDetalleSeguimientoFacade.guardarDetalleSeguimientoCartera()";
+        String modulo = "CRDetalleSeguimientoFacade.guardarSeguimientoCartera()";
         String usuario = beanParametrosAuditoria.getUsuarioInsercion();
-        CRSeguimientoCartera crSeguimientoCartera;
+        CRSeguimientoCartera crSeguimientoCartera = null;
         String idRuta;
         WFMaestra wfMaestra;
         String idMaestra;
@@ -269,14 +387,17 @@
 
                     crSeguimientoCartera.setTipoSeguimiento(Constante.CODIGO_TIPO_SEGUIMIENTO_INDIVIDUAL);
                     crSeguimientoCartera.setIdLote(CADENA_VACIA);
-                    crSeguimientoCartera.setFechaAlerta(FormatoFecha.stringToDate(beanCRSeguimientoCartera.getFechaAlerta()));
+                    crSeguimientoCartera.setFechaAlerta(FormatoFecha.stringToUtilDate(beanCRSeguimientoCartera.getFechaAlerta()));
                     crSeguimientoCartera.setMontoAlerta(beanCRSeguimientoCartera.getMontoAlerta());
-                    crSeguimientoCartera.setFechaAtencion(FormatoFecha.stringToDate(beanCRSeguimientoCartera.getFechaAtencion()));
+                    crSeguimientoCartera.setFechaAtencion(FormatoFecha.stringToUtilDate(beanCRSeguimientoCartera.getFechaAtencion()));
                     crSeguimientoCartera.setMontoProvision(beanCRSeguimientoCartera.getMontoProvision());
                     crSeguimientoCartera.setInteresDevengado(beanCRSeguimientoCartera.getInteresDevengado());
                     crSeguimientoCartera.setAgenciaAsignada(beanCRSeguimientoCartera.getCodigoAgencia());
                     crSeguimientoCartera.setUsuarioAsignado(beanCRSeguimientoCartera.getUsuarioAsignado());
                     crSeguimientoCartera.setComentario(beanCRSeguimientoCartera.getComentario());
+                    crSeguimientoCartera.setIndicadorEnvioCorreo(Constante.INDICADOR_NO_ENVIADO);
+                    crSeguimientoCartera.setNumeroCredito(beanCRSeguimientoCartera.getNumeroCredito());
+                    crSeguimientoCartera.setTipoProducto(beanCRSeguimientoCartera.getTipoProducto());
 
                     CLPersonas clPersonas = clPersonasInterfaceLocal.findById(beanCRSeguimientoCartera.getCodigoCliente());
                     crSeguimientoCartera.setClPersonas(clPersonas);
@@ -295,9 +416,9 @@
                     crSeguimientoCartera = new CRSeguimientoCartera();
                     crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(beanCRSeguimientoCartera.getCorrelativoSeguimiento());
 
-                    crSeguimientoCartera.setFechaAlerta(FormatoFecha.stringToDate(beanCRSeguimientoCartera.getFechaAlerta()));
+                    crSeguimientoCartera.setFechaAlerta(FormatoFecha.stringToUtilDate(beanCRSeguimientoCartera.getFechaAlerta()));
                     crSeguimientoCartera.setMontoAlerta(beanCRSeguimientoCartera.getMontoAlerta());
-                    crSeguimientoCartera.setFechaAtencion(FormatoFecha.stringToDate(beanCRSeguimientoCartera.getFechaAtencion()));
+                    crSeguimientoCartera.setFechaAtencion(FormatoFecha.stringToUtilDate(beanCRSeguimientoCartera.getFechaAtencion()));
                     crSeguimientoCartera.setMontoProvision(beanCRSeguimientoCartera.getMontoProvision());
                     crSeguimientoCartera.setInteresDevengado(beanCRSeguimientoCartera.getInteresDevengado());
                     crSeguimientoCartera.setAgenciaAsignada(beanCRSeguimientoCartera.getCodigoAgencia());
@@ -320,6 +441,7 @@
                 crSeguimientoCartera = new CRSeguimientoCartera();
                 crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(beanCRSeguimientoCartera.getCorrelativoSeguimiento());
                 crSeguimientoCartera.setFechaAsignacion(beanParametrosAuditoria.getFechaProceso());
+                crSeguimientoCartera.setHoraAsignacion(FormatoFecha.obtenerHora());
                 setModificacionAuditoria(crSeguimientoCartera, beanParametrosAuditoria);
                 crSeguimientoCarteraInterfaceLocal.update(crSeguimientoCartera);
 
@@ -327,8 +449,10 @@
                 wfMaestra.setUsuarioAtiende(beanCRSeguimientoCartera.getUsuarioAsignado());
                 setModificacionAuditoria(wfMaestra, beanParametrosAuditoria);
                 wfMaestraInterfaceLocal.update(wfMaestra);
+            } else {
+                crSeguimientoCartera = new CRSeguimientoCartera();
+                crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(beanCRSeguimientoCartera.getCorrelativoSeguimiento());
             }
-
             String correlativoMovimiento = wfMaestraFacadeInterfaceLocal.procesarEvento(idMaestra,
                                                                                         beanWFMaestra.getIdEtapa(),
                                                                                         beanWFEventoPorEtapa.getIdEventoPorEtapa(),
@@ -343,6 +467,8 @@
                                                                                                beanParametrosAuditoria);
             }
 
+            beanCRSeguimientoCartera.setCorrelativoSeguimiento(crSeguimientoCartera.getCorrelativoSeguimiento());
+
         } catch (Exception e) {
             throw handlerError(e, usuario, modulo);
         }
@@ -356,21 +482,67 @@
         Map<String, Object> mapRespuesta = new HashMap<String, Object>(0);
         List<CRSeguimientoCartera> listCRDetalleSeguimiento;
         Long cantReg;
-        int inicio, pagina;
+        int inicio = 0, fin = 0, pagina = 0;
         try {
+            crActividadSeguimientoCarteraFacadeInterfaceLocal = lookup(CRActividadSeguimientoCarteraFacade.LocalJNDIName);
 
-            pagina = genericBean.getProperty("pagina", Integer.class);
-            inicio = (pagina - 1) * Paginacion.NUM_REG;
+            if (!_isEmpty(genericBean.getProperty("pagina", Integer.class)) && genericBean.getProperty("pagina",
+                                                                                                       Integer.class) > 0) {
+                pagina = genericBean.getProperty("pagina", Integer.class);
+                inicio = (pagina - 1) * Paginacion.NUM_REG;
+                fin = Paginacion.NUM_REG;
+            }
 
             cantReg = crSeguimientoCarteraInterfaceLocal.countSeguimientoCartera(genericBean);
             listCRDetalleSeguimiento = crSeguimientoCarteraInterfaceLocal.findSeguimientoCartera(genericBean,
                                                                                                  inicio,
-                                                                                                 Paginacion.NUM_REG);
+                                                                                                 fin);
 
             if (!_isEmpty(listCRDetalleSeguimiento)) {
 
                 for (CRSeguimientoCartera crSeguimientoCartera : listCRDetalleSeguimiento) {
                     listBeanCRDetalleSeguimientoCartera.add(getBeanCRSeguimientoCartera(crSeguimientoCartera,
+                                                                                        CADENA_VACIA,
+                                                                                        beanParametrosAuditoria));
+                }
+
+            }
+
+            mapRespuesta.put("cantReg", cantReg);
+            mapRespuesta.put("listBeanCRSeguimientoCartera", listBeanCRDetalleSeguimientoCartera);
+
+        } catch (Exception e) {
+            throw handlerError(e,
+                               beanParametrosAuditoria.getUsuarioInsercion(),
+                               "CRSeguimientoCarteraFacade.buscarSeguimientoCartera()");
+        }
+        return mapRespuesta;
+    }
+
+    public Map<String, Object> buscarSeguimientoCarteraByIdLote(GenericBean genericBean,
+                                                                BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        List<BeanCRSeguimientoCartera> listBeanCRDetalleSeguimientoCartera = new ArrayList<BeanCRSeguimientoCartera>(0);
+        Map<String, Object> mapRespuesta = new HashMap<String, Object>(0);
+        List<CRSeguimientoCartera> listCRDetalleSeguimiento;
+        Long cantReg;
+        int inicio, pagina;
+        try {
+
+            crActividadSeguimientoCarteraFacadeInterfaceLocal = lookup(CRActividadSeguimientoCarteraFacade.LocalJNDIName);
+
+            pagina = genericBean.getProperty("pagina", Integer.class);
+            inicio = (pagina - 1) * Paginacion.NUM_REG;
+
+            cantReg = crSeguimientoCarteraInterfaceLocal.countSeguimientoCarteraByIdLote(genericBean);
+            listCRDetalleSeguimiento = crSeguimientoCarteraInterfaceLocal.findSeguimientoCarteraByIdLote(genericBean,
+                                                                                                         inicio,
+                                                                                                         Paginacion.NUM_REG);
+
+            if (!_isEmpty(listCRDetalleSeguimiento)) {
+
+                for (CRSeguimientoCartera crSeguimientoCartera : listCRDetalleSeguimiento) {
+                    listBeanCRDetalleSeguimientoCartera.add(getBeanCRSeguimientoCartera(crSeguimientoCartera,
+                                                                                        CADENA_VACIA,
                                                                                         beanParametrosAuditoria));
                 }
 
@@ -396,7 +568,6 @@
         BeanWFMaestra beanWFMaestra;
         String idModulo;
         BeanWFEventoPorEtapa beanWFEventoPorEtapa;
-        BeanWFEventoPorEtapa beanWFEventoPorEtapaInicio;
 
         try {
 
@@ -413,12 +584,8 @@
                                                                 beanParametrosAuditoria);
             idRuta = wfRutaFacadeInterfaceLocal.obtenerRuta(idModulo, null, null, null, beanParametrosAuditoria);
 
-            beanWFEventoPorEtapaInicio = wfEventoPorEtapaFacadeInterfaceLocal.getByKey(Constante.WF_ETAPA_SG_DATOS_SEGUIMIENTO,
-                                                                                       Constante.CODIGO_EVENTO_GRABAR,
-                                                                                       beanParametrosAuditoria);
-
             beanWFEventoPorEtapa = wfEventoPorEtapaFacadeInterfaceLocal.getByKey(Constante.WF_ETAPA_SG_DATOS_SEGUIMIENTO,
-                                                                                 Constante.CODIGO_EVENTO_ENVIAR,
+                                                                                 Constante.WF_EVENTO_ASIGNAR_ALERTA,
                                                                                  beanParametrosAuditoria);
 
             for (CRSeguimientoCartera crSeguimientoCartera : listCRSeguimientoCartera) {
@@ -426,23 +593,18 @@
                 beanWFMaestra = new BeanWFMaestra();
                 beanWFMaestra.setIdModulo(idModulo);
                 beanWFMaestra.setIdRuta(idRuta);
-                beanWFMaestra.setIdEstado(beanWFEventoPorEtapaInicio.getIdEstado());
-                beanWFMaestra.setIdEtapa(beanWFEventoPorEtapaInicio.getIdEtapa());
+                beanWFMaestra.setIdEstado(beanWFEventoPorEtapa.getIdEstado());
+                beanWFMaestra.setIdEtapa(beanWFEventoPorEtapa.getIdEtapa());
                 beanWFMaestra.setFechaProceso(beanParametrosAuditoria.getFechaProceso());
                 beanWFMaestra.setUsuarioSolicitante(beanParametrosAuditoria.getUsuarioInsercion());
                 beanWFMaestra.setUsuarioAtiende(crSeguimientoCartera.getUsuarioAsignado());
 
                 wfMaestra = wfMaestraFacadeInterfaceLocal.guardar(beanWFMaestra, beanParametrosAuditoria);
                 crSeguimientoCartera.setWfMaestra(wfMaestra);
+                crSeguimientoCartera.setHoraAsignacion(FormatoFecha.obtenerHora());
                 setModificacionAuditoria(crSeguimientoCartera, beanParametrosAuditoria);
                 crSeguimientoCarteraInterfaceLocal.update(crSeguimientoCartera);
 
-                wfMaestraFacadeInterfaceLocal.procesarEvento(wfMaestra.getIdMaestra(),
-                                                             beanWFEventoPorEtapaInicio.getIdEtapa(),
-                                                             beanWFEventoPorEtapaInicio.getIdEventoPorEtapa(),
-                                                             crSeguimientoCartera.getComentario(),
-                                                             beanParametrosAuditoria);
-                entityManager.flush();
                 wfMaestraFacadeInterfaceLocal.procesarEvento(wfMaestra.getIdMaestra(),
                                                              wfMaestra.getWfEtapa().getIdEtapa(),
                                                              beanWFEventoPorEtapa.getIdEventoPorEtapa(),
@@ -495,14 +657,18 @@
 
         String modulo = "CRSeguimientoCarteraFacade.procesarResolucion()";
         String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        CRSeguimientoCartera crSeguimientoCartera;
         try {
+            crSeguimientoCartera = new CRSeguimientoCartera();
+            if (_equiv(idTipoRespuesta, Constante.CODIGO_TIPO_RESPUESTA_DEVUELTO)) {
+                BeanWFEvento beanWFEvento = wfEventoFacadeInterfaceLocal.obtenerEventoByKey(Constante.CODIGO_EVENTO_OBSERVAR,
+                                                                                            beanParametrosAuditoria);
+                idEvento = beanWFEvento.getIdEvento();
+            }
 
             if (!_isEmpty(beanCRSeguimientoCartera.getFechaAtencion())) {
-                CRSeguimientoCartera crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(beanCRSeguimientoCartera.getCorrelativoSeguimiento());
+                crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(beanCRSeguimientoCartera.getCorrelativoSeguimiento());
                 crSeguimientoCartera.setFechaAtencion(FormatoFecha.stringToDateddMMyyyy(beanCRSeguimientoCartera.getFechaAtencion()));
-                setModificacionAuditoria(crSeguimientoCartera, beanParametrosAuditoria);
-
-                crSeguimientoCarteraInterfaceLocal.update(crSeguimientoCartera);
             }
 
             BeanWFEventoPorEtapa beanWFEventoPorEtapa = wfEventoPorEtapaFacadeInterfaceLocal.get(beanWFMaestra.getIdEtapa(),
@@ -520,8 +686,313 @@
                                                                                            beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
                                                                                            idTipoRespuesta,
                                                                                            beanParametrosAuditoria);
+
+            actualizarEstadoEnvioCorreoSeguimientoCartera(beanCRSeguimientoCartera.getCorrelativoSeguimiento(),
+                                                          Constante.INDICADOR_NO_ENVIADO,
+                                                          beanParametrosAuditoria);
+            crSeguimientoCarteraInterfaceLocal.update(crSeguimientoCartera);
         } catch (Exception e) {
             throw handlerError(e, usuario, modulo);
         }
     }
+
+    public void envioCorreoMasivoPorEstadoYAsesor(BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "CRSeguimientoCarteraFacade.envioCorreoMasivoPorEstadoYAsesor()";
+        String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        try {
+            envioCorreoAsignacion(beanParametrosAuditoria);
+            envioCorreoAtencion(beanParametrosAuditoria);
+            envioCorreoAprobadoDevuelto(beanParametrosAuditoria);
+            enviarNotificacionIncumplimiento(beanParametrosAuditoria);
+        } catch (Exception e) {
+            throw handlerError(e, usuario, modulo);
+        }
+    }
+
+    public void actualizarEstadoEnvioCorreoSeguimientoCartera(String correlativoSeguimiento,
+                                                              String indicadorEnvioCorreo,
+                                                              BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "CRSeguimientoCarteraFacade.envioCorreoResolucion()";
+        String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        CRSeguimientoCartera crSeguimientoCartera = new CRSeguimientoCartera();
+        try {
+            crSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findById(correlativoSeguimiento);
+            crSeguimientoCartera.setIndicadorEnvioCorreo(indicadorEnvioCorreo);
+            setModificacionAuditoria(crSeguimientoCartera, beanParametrosAuditoria);
+            crSeguimientoCarteraInterfaceLocal.update(crSeguimientoCartera);
+        } catch (Exception e) {
+            throw handlerError(e, usuario, modulo);
+        }
+
+    }
+
+    private void envioCorreoAsignacion(BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "CRSeguimientoCarteraFacade.envioCorreoAsignacion()";
+        String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        List<CRSeguimientoCartera> listCRSeguimientoCarteraPorUsuarioAsignado;
+        BeanCRSeguimientoCartera beanCRSeguimientoCartera;
+        List<BeanCRSeguimientoCartera> listBeanCRSeguimientoCartera;
+
+        List<Object[]> listaUsuariosAgencia;
+        try {
+            crActividadSeguimientoCarteraFacadeInterfaceLocal = lookup(CRActividadSeguimientoCarteraFacade.LocalJNDIName);
+
+            BeanWFEstado beanWFEstado = wfEstadoFacadeInterfaceLocal.listarEstadoByKey(Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_ASIGNADO,
+                                                                                       beanParametrosAuditoria);
+
+            listaUsuariosAgencia = crSeguimientoCarteraInterfaceLocal.listarUsuariosAsignadosAgencias(beanWFEstado.getIdEstado(),
+                                                                                                      CADENA_VACIA,
+                                                                                                      CADENA_VACIA,
+                                                                                                      Constante.ESTADO_REGISTRO_NOVIGENTE);
+            for (Object[] objects : listaUsuariosAgencia) {
+                final Object[] ope = (Object[]) objects;
+                listBeanCRSeguimientoCartera = new ArrayList<BeanCRSeguimientoCartera>(0);
+
+                listCRSeguimientoCarteraPorUsuarioAsignado = crSeguimientoCarteraInterfaceLocal.listarPorEstadosOUsuarioAsignado(CADENA_VACIA,
+                                                                                                                                 CADENA_VACIA,
+                                                                                                                                 beanWFEstado.getIdEstado(),
+                                                                                                                                 CADENA_VACIA,
+                                                                                                                                 _toStr(ope[1]),
+                                                                                                                                 Constante.ESTADO_REGISTRO_NOVIGENTE);
+                for (CRSeguimientoCartera crSeguimientoCarteraPorUsuarioAsignado : listCRSeguimientoCarteraPorUsuarioAsignado) {
+                    beanCRSeguimientoCartera = new BeanCRSeguimientoCartera();
+                    beanCRSeguimientoCartera = getBeanCRSeguimientoCartera(crSeguimientoCarteraPorUsuarioAsignado,
+                                                                           CADENA_VACIA,
+                                                                           beanParametrosAuditoria);
+
+                    listBeanCRSeguimientoCartera.add(beanCRSeguimientoCartera);
+                    actualizarEstadoEnvioCorreoSeguimientoCartera(crSeguimientoCarteraPorUsuarioAsignado.getCorrelativoSeguimiento(),
+                                                                  Constante.INDICADOR_ENVIADO,
+                                                                  beanParametrosAuditoria);
+                }
+                if (!_equiv(listBeanCRSeguimientoCartera.size(), 0)) {
+
+                    CBAgenciaId cbAgenciaId = new CBAgenciaId();
+                    List<String> listaDestinatarios = new ArrayList<String>(0);
+                    cbAgenciaId.setCodigoAgencia(_toStr(ope[0]));
+                    cbAgenciaId.setCodigoEmpresa(Constante.ID_TFC);
+                    CBAgencia cbAgencia = cbAgenciaInterfaceLocal.findById(cbAgenciaId);
+
+                    String emailDestinatario = clEmailsPersonasFacadeInterfaceLocal.obtenerEmailPersonas(_toStr(ope[1]));
+                    listaDestinatarios.add(emailDestinatario);
+                    String emailDestinatarioGerenteAgencia = clEmailsPersonasFacadeInterfaceLocal.obtenerEmailPersonas(cbAgencia.getCbUsuario().getCodigoUsuario());
+                    listaDestinatarios.add(emailDestinatarioGerenteAgencia);
+
+                    CBUsuario cbUsuario = cbUsuarioInterfaceLocal.findById(_toStr(ope[1]));
+                    geMailSenderFacadeInterfaceLocal.enviarMailClientesPorAsesor(cbUsuario.getNombreCompleto(),
+                                                                                 listaDestinatarios,
+                                                                                 listBeanCRSeguimientoCartera,
+                                                                                 beanParametrosAuditoria);
+                }
+            }
+
+        } catch (Exception e) {
+            throw handlerError(e, usuario, modulo);
+        }
+    }
+
+    private void envioCorreoAprobadoDevuelto(BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "CRSeguimientoCarteraFacade.envioCorreoAprobadoDevuelto()";
+        String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        List<CRSeguimientoCartera> listCRSeguimientoCarteraPorEstado;
+        BeanCRSeguimientoCartera beanCRSeguimientoCartera;
+        List<BeanCRSeguimientoCartera> listBeanCRSeguimientoCartera = new ArrayList<BeanCRSeguimientoCartera>(0);
+        List<Object[]> listaUsuariosAgencia;
+
+        try {
+            crActividadSeguimientoCarteraFacadeInterfaceLocal = lookup(CRActividadSeguimientoCarteraFacade.LocalJNDIName);
+
+            BeanWFEstado beanWFEstadoObservado = wfEstadoFacadeInterfaceLocal.listarEstadoByKey(Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_OBSERVADO,
+                                                                                                beanParametrosAuditoria);
+            BeanWFEstado beanWFEstadoFinalizado = wfEstadoFacadeInterfaceLocal.listarEstadoByKey(Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_FINALIZADO,
+                                                                                                 beanParametrosAuditoria);
+
+            listaUsuariosAgencia = crSeguimientoCarteraInterfaceLocal.listarUsuariosAsignadosAgencias(CADENA_VACIA,
+                                                                                                      beanWFEstadoObservado.getIdEstado(),
+                                                                                                      beanWFEstadoFinalizado.getIdEstado(),
+                                                                                                      Constante.ESTADO_REGISTRO_NOVIGENTE);
+            for (Object[] objects : listaUsuariosAgencia) {
+                final Object[] ope = (Object[]) objects;
+
+                listCRSeguimientoCarteraPorEstado = crSeguimientoCarteraInterfaceLocal.listarPorEstadosOUsuarioAsignado(beanWFEstadoObservado.getIdEstado(),
+                                                                                                                        beanWFEstadoFinalizado.getIdEstado(),
+                                                                                                                        CADENA_VACIA,
+                                                                                                                        CADENA_VACIA,
+                                                                                                                        _toStr(ope[1]),
+                                                                                                                        Constante.ESTADO_REGISTRO_NOVIGENTE);
+
+                for (CRSeguimientoCartera crSeguimientoCarteraPorEstado : listCRSeguimientoCarteraPorEstado) {
+                    beanCRSeguimientoCartera = new BeanCRSeguimientoCartera();
+                    beanCRSeguimientoCartera = getBeanCRSeguimientoCartera(crSeguimientoCarteraPorEstado,
+                                                                           CADENA_VACIA,
+                                                                           beanParametrosAuditoria);
+                    if (_equiv(crSeguimientoCarteraPorEstado.getWfMaestra().getWfEstado().getKeyEstado(),
+                               Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_FINALIZADO)) {
+                        beanCRSeguimientoCartera.setFechaAtencion("-");
+                    }
+                    listBeanCRSeguimientoCartera.add(beanCRSeguimientoCartera);
+                    actualizarEstadoEnvioCorreoSeguimientoCartera(crSeguimientoCarteraPorEstado.getCorrelativoSeguimiento(),
+                                                                  Constante.INDICADOR_ENVIADO,
+                                                                  beanParametrosAuditoria);
+                }
+                if (!_equiv(listBeanCRSeguimientoCartera.size(), 0)) {
+                    CBAgenciaId cbAgenciaId = new CBAgenciaId();
+                    List<String> listaDestinatarios = new ArrayList<String>(0);
+                    cbAgenciaId.setCodigoAgencia(_toStr(ope[0]));
+                    cbAgenciaId.setCodigoEmpresa(Constante.ID_TFC);
+                    CBAgencia cbAgencia = cbAgenciaInterfaceLocal.findById(cbAgenciaId);
+
+                    String emailDestinatario = clEmailsPersonasFacadeInterfaceLocal.obtenerEmailPersonas(_toStr(ope[1]));
+                    listaDestinatarios.add(emailDestinatario);
+                    String emailDestinatarioGerenteAgencia = clEmailsPersonasFacadeInterfaceLocal.obtenerEmailPersonas(cbAgencia.getCbUsuario().getCodigoUsuario());
+                    listaDestinatarios.add(emailDestinatarioGerenteAgencia);
+
+                    CBUsuario cbUsuario = cbUsuarioInterfaceLocal.findById(_toStr(ope[1]));
+
+                    geMailSenderFacadeInterfaceLocal.enviarMailSegCarAprobadoDevuelto(cbUsuario.getNombreCompleto(),
+                                                                                      listaDestinatarios,
+                                                                                      listBeanCRSeguimientoCartera,
+                                                                                      beanParametrosAuditoria);
+                }
+            }
+
+        } catch (Exception e) {
+            throw handlerError(e, usuario, modulo);
+        }
+    }
+
+    private void envioCorreoAtencion(BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "CRSeguimientoCarteraFacade.envioCorreoAtencion()";
+        String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        List<Object[]> listCRSeguimientoCarteraObjects;
+        List<CRSeguimientoCartera> listCRSeguimientoCartera;
+        BeanCRSeguimientoCartera beanCRSeguimientoCartera;
+        List<BeanCRSeguimientoCartera> listBeanCRSeguimientoCartera = new ArrayList<BeanCRSeguimientoCartera>(0);
+        PropertyParams propertyParams;
+        try {
+            BeanWFEstado beanWFEstado = wfEstadoFacadeInterfaceLocal.listarEstadoByKey(Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_ATENDIDO,
+                                                                                       beanParametrosAuditoria);
+
+            listCRSeguimientoCarteraObjects = crSeguimientoCarteraInterfaceLocal.listarAtendidosGroupByAgenciaAlerta(beanWFEstado.getIdEstado());
+            for (Object objects : listCRSeguimientoCarteraObjects) {
+                beanCRSeguimientoCartera = new BeanCRSeguimientoCartera();
+                final Object[] ope = (Object[]) objects;
+                beanCRSeguimientoCartera.setDescripcionAgencia(_toStr(ope[0]));
+                beanCRSeguimientoCartera.setDescripcionTipoAlerta(_toStr(ope[1]));
+                beanCRSeguimientoCartera.setCantidadAlertas(_toStr(ope[2]));
+
+                listBeanCRSeguimientoCartera.add(beanCRSeguimientoCartera);
+            }
+            if (!_equiv(listBeanCRSeguimientoCartera.size(), 0)) {
+                geMailSenderFacadeInterfaceLocal.enviarMailSegCarAtencion(Constante.SEGUIMIENTO_CARTERA_CORREO_DESTINATARIO_GyS,
+                                                                          listBeanCRSeguimientoCartera,
+                                                                          beanParametrosAuditoria);
+            }
+            propertyParams = new PropertyParams();
+            propertyParams.addProperty("wfMaestra.wfEstado.idEstado", beanWFEstado.getIdEstado());
+            propertyParams.addProperty("estadoRegistro", Constante.ESTADO_REGISTRO_VIGENTE);
+            propertyParams.addProperty("indicadorEnvioCorreo", Constante.ESTADO_REGISTRO_NOVIGENTE);
+
+            listCRSeguimientoCartera = crSeguimientoCarteraInterfaceLocal.findByProperties(propertyParams);
+            for (CRSeguimientoCartera crSeguimientoCartera : listCRSeguimientoCartera) {
+                actualizarEstadoEnvioCorreoSeguimientoCartera(crSeguimientoCartera.getCorrelativoSeguimiento(),
+                                                              Constante.INDICADOR_ENVIADO,
+                                                              beanParametrosAuditoria);
+            }
+
+        } catch (Exception e) {
+            throw handlerError(e, usuario, modulo);
+        }
+    }
+
+    private void enviarNotificacionIncumplimiento(BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        String modulo = "CRSeguimientoCarteraFacade.enviarNotificacionIncumplimiento()";
+        String usuario = beanParametrosAuditoria.getUsuarioInsercion();
+        List<BeanCRSeguimientoCartera> listBeanCRSeguimientoCartera = new ArrayList<BeanCRSeguimientoCartera>(0);
+        BeanCRSeguimientoCartera beanCRSeguimientoCartera;
+
+        List<Object[]> listaUsuariosAgencia;
+        List<CRSeguimientoCartera> listCRSeguimientoCarteraPorEstado;
+        try {
+            crActividadSeguimientoCarteraFacadeInterfaceLocal = lookup(CRActividadSeguimientoCarteraFacade.LocalJNDIName);
+
+            BeanWFEstado beanWFEstadoObservado = wfEstadoFacadeInterfaceLocal.listarEstadoByKey(Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_OBSERVADO,
+                                                                                                beanParametrosAuditoria);
+            BeanWFEstado beanWFEstadoAsignado = wfEstadoFacadeInterfaceLocal.listarEstadoByKey(Constante.CODIGO_ESTADO_SEGUIMIENTO_CARTERA_ASIGNADO,
+                                                                                               beanParametrosAuditoria);
+
+            listaUsuariosAgencia = crSeguimientoCarteraInterfaceLocal.listarUsuariosAsignadosAgencias(beanWFEstadoAsignado.getIdEstado(),
+                                                                                                      beanWFEstadoObservado.getIdEstado(),
+                                                                                                      CADENA_VACIA,
+                                                                                                      CADENA_VACIA);
+            for (Object[] objects : listaUsuariosAgencia) {
+                final Object[] ope = (Object[]) objects;
+
+                listCRSeguimientoCarteraPorEstado = crSeguimientoCarteraInterfaceLocal.listarPorEstadosOUsuarioAsignado(beanWFEstadoObservado.getIdEstado(),
+                                                                                                                        CADENA_VACIA,
+                                                                                                                        beanWFEstadoAsignado.getIdEstado(),
+                                                                                                                        CADENA_VACIA,
+                                                                                                                        _toStr(ope[1]),
+                                                                                                                        CADENA_VACIA);
+                for (CRSeguimientoCartera crSeguimientoCarteraPorEstado : listCRSeguimientoCarteraPorEstado) {
+                    beanCRSeguimientoCartera = new BeanCRSeguimientoCartera();
+                    beanCRSeguimientoCartera = getBeanCRSeguimientoCartera(crSeguimientoCarteraPorEstado,
+                                                                           CADENA_VACIA,
+                                                                           beanParametrosAuditoria);
+
+                    Integer diasTranscurridos = financ.util.FormatoFecha.obtenerDiasHabiles(crSeguimientoCarteraPorEstado.getFechaAtencion(),
+                                                                                            beanParametrosAuditoria.getFechaProceso(),
+                                                                                            true,
+                                                                                            false,
+                                                                                            false);
+
+                    if ((diasTranscurridos - 1) > 0 && ((diasTranscurridos - 1) / Constante.SEGUIMIENTO_CARTERA_DIAS_INCUMPLIMIENTO) >= 1) {
+                        beanCRSeguimientoCartera = getBeanCRSeguimientoCartera(crSeguimientoCarteraPorEstado,
+                                                                               CADENA_VACIA,
+                                                                               beanParametrosAuditoria);
+                        beanCRSeguimientoCartera.setDiasIncumplimiento(diasTranscurridos.toString());
+                        listBeanCRSeguimientoCartera.add(beanCRSeguimientoCartera);
+
+                    }
+                }
+                if (!_equiv(listBeanCRSeguimientoCartera.size(), 0)) {
+                    List<String> listaDestinatario = obtenerDestinatarios(_toStr(ope[0]));
+                    String emailDestinatario = clEmailsPersonasFacadeInterfaceLocal.obtenerEmailPersonas(_toStr(ope[1]));
+                    listaDestinatario.add(emailDestinatario);
+                    listaDestinatario.add(Constante.SEGUIMIENTO_CARTERA_CORREO_DESTINATARIO_GyS);
+                    CBUsuario cbUsuario = cbUsuarioInterfaceLocal.findById(_toStr(ope[1]));
+                    geMailSenderFacadeInterfaceLocal.enviarMailSegCarIncumplimiento(cbUsuario.getNombreCompleto(),
+                                                                                    listaDestinatario,
+                                                                                    listBeanCRSeguimientoCartera,
+                                                                                    beanParametrosAuditoria);
+                }
+            }
+        } catch (Exception e) {
+            throw handlerError(e, usuario, modulo);
+        }
+    }
+
+    private List<String> obtenerDestinatarios(String codigoAgencia) {
+        List<String> listaDestinatario = new ArrayList<String>(0);
+        CBAgenciaId cbAgenciaId;
+        CBRegionesAgencia cbRegionesAgencia;
+        try {
+            cbAgenciaId = new CBAgenciaId();
+
+            cbAgenciaId.setCodigoAgencia(codigoAgencia);
+            cbAgenciaId.setCodigoEmpresa(Constante.ID_TFC);
+            CBAgencia cbAgencia = cbAgenciaInterfaceLocal.findById(cbAgenciaId);
+
+            String emailDestinatarioGerenteAgencia = clEmailsPersonasFacadeInterfaceLocal.obtenerEmailPersonas(cbAgencia.getCbUsuario().getCodigoUsuario());
+            listaDestinatario.add(emailDestinatarioGerenteAgencia);
+
+            cbRegionesAgencia = cbRegionesAgenciaInterfaceLocal.findById(cbAgencia.getCbRegionesAgencia().getIdRegionAgencia());
+            String emailDestinatarioGerenteZonal = clEmailsPersonasFacadeInterfaceLocal.obtenerEmailPersonas(cbRegionesAgencia.getCbUsuario().getCodigoUsuario());
+            listaDestinatario.add(emailDestinatarioGerenteZonal);
+
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+        return listaDestinatario;
+    }
 }
\ No newline at end of file
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRActividadSeguimientoCarteraFacadeInterfaceLocal.java b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRActividadSeguimientoCarteraFacadeInterfaceLocal.java
index c20a871..1fce152 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRActividadSeguimientoCarteraFacadeInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRActividadSeguimientoCarteraFacadeInterfaceLocal.java
@@ -36,11 +36,12 @@
      * @param beanCRActividadSeguimientoCartera
      * @param idSeguimientoCartera
      * @param beanParametrosAuditoria
+     * @return String
      * @throws Exception
      */
-    public void registrarActividad(BeanCRActividadSeguimientoCartera beanCRActividadSeguimientoCartera,
-                                   String idSeguimientoCartera,
-                                   BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+    public String registrarActividad(BeanCRActividadSeguimientoCartera beanCRActividadSeguimientoCartera,
+                                     String idSeguimientoCartera,
+                                     BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 
     /**
      * @author kdelacruz
@@ -62,7 +63,8 @@
      * @param beanParametrosAuditoria
      * @throws Exception
      */
-    public void eliminarActividad(String correlativoActividad, BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+    public void eliminarActividad(String correlativoActividad,
+                                  BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 
     /**
      * @author kdelacruz
@@ -83,4 +85,16 @@
                                  BeanCRSeguimientoCartera beanCRSeguimientoCartera,
                                  String idTipoRespuesta,
                                  BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    /**
+     * 
+     * @author esalazar
+     * @since [Req.S17-022] 11.04.2017
+     * @param idSeguimiento
+     * @param beanParametrosAuditoria
+     * @return
+     * @throws Exception
+     */
+    BeanCRActividadSeguimientoCartera obtenerUltimaActividad(final String idSeguimiento,
+                                                             final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRCargaAlertaFacadeInterfaceLocal.java b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRCargaAlertaFacadeInterfaceLocal.java
index 454d746..26e7962 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRCargaAlertaFacadeInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRCargaAlertaFacadeInterfaceLocal.java
@@ -7,9 +7,10 @@
 import pe.com.tfc.utils.GenericBean;
 import admin.contab.beans.BeanParametrosAuditoria;
 import financ.seguimientoCartera.beans.BeanCRCargaAlerta;
+import financ.seguimientoCartera.beans.BeanCRSeguimientoCartera;
 
 /**
- * COCarteraCobranzaCargaMasivaFacadeInterfaceLocal
+ * CRCargaAlertaFacadeInterfaceLocal
  * 
  * @autor rsanchez
  * @since [S17-022] 24.03.2017
@@ -22,7 +23,7 @@
      * Enviar
      * 
      * @author rsanchez
-     * @since [] 24.03.2017
+     * @since [Req.S17-022] 24.03.2017
      * @param lstBeanCRCargaAlerta
      * @param genericBean
      * @param beanParametrosAuditoria
@@ -36,7 +37,7 @@
      * Procesar
      * 
      * @author rsanchez
-     * @since [] 24.03.2017
+     * @since [Req.S17-022] 24.03.2017
      * @param lstBeanCRCargaAlerta
      * @param genericBean
      * @param beanParametrosAuditoria
@@ -46,4 +47,14 @@
                          final GenericBean genericBean,
                          final BeanParametrosAuditoria beanParametrosAuditoria);
 
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 17.04.2017
+     * @param beanCRSeguimientoCartera
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void validarRegistroCargaIndividual(BeanCRSeguimientoCartera beanCRSeguimientoCartera,
+                                               BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRDocumentosPorActividadFacadeInterfaceLocal.java b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRDocumentosPorActividadFacadeInterfaceLocal.java
index 90a9b10..f99089f 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRDocumentosPorActividadFacadeInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRDocumentosPorActividadFacadeInterfaceLocal.java
@@ -1,6 +1,10 @@
 package financ.seguimientoCartera.local;
 
+import java.util.Map;
+
 import javax.ejb.Local;
+
+import admin.contab.beans.BeanParametrosAuditoria;
 
 /**
  * CRDocumentosPorActividadFacadeInterfaceLocal
@@ -12,4 +16,45 @@
 @Local
 public interface CRDocumentosPorActividadFacadeInterfaceLocal {
 
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 07.04.2017
+     * @param idActividad
+     * @param pagina
+     * @param beanParametrosAuditoria
+     * @return
+     * @throws Exception
+     */
+    public Map<String, Object> listarDocumentosPorActividad(final String idActividad,
+                                                            final Integer pagina,
+                                                            final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 07.04.2017
+     * @param idFileTMP
+     * @param idActividad
+     * @param cboTipoDocumento
+     * @param textoComentario
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void guardarDocumentoPorActividad(String idFileTMP,
+                                             String idActividad,
+                                             String cboTipoDocumento,
+                                             String textoComentario,
+                                             BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 07.04.2017
+     * @param idCorrelativo
+     * @param idFile
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void borrarRegistroDocumentoPorActividad(String idCorrelativo,
+                                                    String idFile,
+                                                    BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRSeguimientoCarteraFacadeInterfaceLocal.java b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRSeguimientoCarteraFacadeInterfaceLocal.java
index 4862041..ebefdf1 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRSeguimientoCarteraFacadeInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRSeguimientoCarteraFacadeInterfaceLocal.java
@@ -22,7 +22,7 @@
 public interface CRSeguimientoCarteraFacadeInterfaceLocal {
 
     void guardarDetalleMasivo(BeanCRSeguimientoCartera beanCRSeguimientoCartera,
-                        BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+                              BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 
     /**
      * @author kdelacruz
@@ -72,11 +72,11 @@
      * @since [Req.S17-022] 30.03.2017
      * @param idLote
      * @param beanParametrosAuditoria
-     * @return 
+     * @return
      * @throws Exception
      */
     void asignarMasivo(String idLote, BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
-    
+
     /**
      * Anular Detalles Lotes
      * 
@@ -84,20 +84,23 @@
      * @since [Req.S17-022] 06.04.2017
      * @param lstCRMaestroSeguimiento
      * @param beanParametrosAuditoria
-     * @return 
+     * @return
      * @throws Exception
      */
     void anularDetallesLotes(List<CRMaestroSeguimiento> lstCRMaestroSeguimiento,
                              BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
     /**
      * @author esalazar
      * @since [Req.S17-022] 31.03.2017
      * @param idMaestra
+     * @param idEtapa
      * @param beanParametrosAuditoria
      * @return BeanCRSeguimientoCartera
      * @throws Exception
      */
     public BeanCRSeguimientoCartera obtenerSeguimientoCarteraPorIdMaestra(String idMaestra,
+                                                                          String idEtapa,
                                                                           BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 
     /**
@@ -120,4 +123,37 @@
                                    String idTipoRespuesta,
                                    BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 17.04.2017
+     * @param correlativoSeguimiento
+     * @param indicadorEnvioCorreo
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void actualizarEstadoEnvioCorreoSeguimientoCartera(String correlativoSeguimiento,
+                                                              String indicadorEnvioCorreo,
+                                                              BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
+    /**
+     * 
+     * @author kdelacruz
+     * @since [Req.S17-022] 17.04.2017
+     * @param beanParametrosAuditoria
+     * @throws Exception
+     */
+    public void envioCorreoMasivoPorEstadoYAsesor(BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+    /**
+     * Buscar Seguimiento de Cartera
+     * 
+     * @author rsanchez
+     * @since [Req.S17-022] 11.04.2017
+     * @param genericBean
+     * @param beanParametrosAuditoria
+     * @return mapRespuesta
+     * @throws Exception
+     */
+    public Map<String, Object> buscarSeguimientoCarteraByIdLote(GenericBean genericBean,
+                                                         BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRSeguimientoCarteraInterfaceLocal.java b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRSeguimientoCarteraInterfaceLocal.java
index 3f26a09..7f72416 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/local/CRSeguimientoCarteraInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/local/CRSeguimientoCarteraInterfaceLocal.java
@@ -10,17 +10,84 @@
 
 /**
  * CRDetalleSeguimientoInterfaceLocal
- *
+ * 
  * @author rsanchez
  * @since [S17-022] 28.03.2017
  */
 
 @Local
-public interface CRSeguimientoCarteraInterfaceLocal extends GenericInterface<CRSeguimientoCartera, String>{
-    
+public interface CRSeguimientoCarteraInterfaceLocal extends GenericInterface<CRSeguimientoCartera, String> {
+
     Long countSeguimientoCartera(GenericBean genericBean) throws Exception;
+
+    List<CRSeguimientoCartera> findSeguimientoCartera(GenericBean genericBean, int posicionInicial, int maxResultado) throws Exception;
+
+    /**
+     * @author kdelacruz
+     * @since [req.S17-022] 11.04.2017
+     * @param idEstadoObservado
+     * @param idEstadoFinalizado
+     * @param idEstadoAsignado
+     * @param idEstadoResolucion
+     * @param usuarioAsignado
+     * @param indicadorEnvioCorreo
+     * @return
+     * @throws Exception
+     */
+    public List<CRSeguimientoCartera> listarPorEstadosOUsuarioAsignado(String idEstadoObservado,
+                                                                       String idEstadoFinalizado,
+                                                                       String idEstadoAsignado,
+                                                                       String idEstadoResolucion,
+                                                                       String indicadorEnvioCorreo,
+                                                                       String usuarioAsignado) throws Exception;
     
-    List<CRSeguimientoCartera> findSeguimientoCartera(GenericBean genericBean,
-                                                      int posicionInicial,
-                                                      int maxResultado) throws Exception;
+    /**
+     * @author kdelacruz
+     * @since [req.S17-022] 17.04.2017
+     * @param idEstadoAtendido
+     * @return List<Object[]>
+     * @throws Exception
+     */
+    public List<Object[]> listarAtendidosGroupByAgenciaAlerta(String idEstadoAtendido) throws Exception;
+    
+    /**
+     * @author kdelacruz
+     * @since [req.S17-022] 18.04.2017
+     * @param idEstadoAsignado
+     * @param idEstadoObservado
+     * @param idEstadoFinalizado
+     * @param indicadorEnvioCorreo
+     * @return
+     * @throws Exception
+     */
+    public List<Object[]> listarUsuariosAsignadosAgencias(String idEstadoAsignado,
+                                                          String idEstadoObservado,
+                                                          String idEstadoFinalizado,
+                                                          String indicadorEnvioCorreo) throws Exception;
+
+	/**
+     * @author rsanchez
+     * @since [req.S17-022] 18.04.2017
+     * @param idEstadoAsignado
+     * @param idEstadoObservado
+     * @param idEstadoFinalizado
+     * @param indicadorEnvioCorreo
+     * @return
+     * @throws Exception
+     */
+    Long countSeguimientoCarteraByIdLote(GenericBean genericBean) throws Exception;
+
+	 /**
+     * @author rsanchez
+     * @since [req.S17-022] 18.04.2017
+     * @param idEstadoAsignado
+     * @param idEstadoObservado
+     * @param idEstadoFinalizado
+     * @param indicadorEnvioCorreo
+     * @return
+     * @throws Exception
+     */
+    List<CRSeguimientoCartera> findSeguimientoCarteraByIdLote(GenericBean genericBean,
+                                                              int posicionInicial,
+                                                              int maxResultado) throws Exception;
 }
diff --git a/FINANCIERONEW/src/financ/seguimientoCartera/session/CRSeguimientoCarteraSession.java b/FINANCIERONEW/src/financ/seguimientoCartera/session/CRSeguimientoCarteraSession.java
index ec1ba2b..aea196c 100644
--- a/FINANCIERONEW/src/financ/seguimientoCartera/session/CRSeguimientoCarteraSession.java
+++ b/FINANCIERONEW/src/financ/seguimientoCartera/session/CRSeguimientoCarteraSession.java
@@ -23,7 +23,8 @@
  */
 
 @Stateless
-public class CRSeguimientoCarteraSession extends AbstractSession<CRSeguimientoCartera, String> implements CRSeguimientoCarteraInterfaceLocal {
+public class CRSeguimientoCarteraSession
+                extends AbstractSession<CRSeguimientoCartera, String> implements CRSeguimientoCarteraInterfaceLocal {
 
     private CRSeguimientoCarteraSession() {
         super(CRSeguimientoCartera.class);
@@ -42,6 +43,7 @@
         String codigoAsesor;
         String codigoCliente;
         String codigoEstado;
+        String codigoTipoProducto;
         String usuarioConsulta;
 
         try {
@@ -55,6 +57,7 @@
             codigoAsesor = genericBean.getPropertyString("codigoAsesor");
             codigoCliente = genericBean.getPropertyString("codigoCliente");
             codigoEstado = genericBean.getPropertyString("codigoEstado");
+            codigoTipoProducto = genericBean.getPropertyString("codigoTipoProducto");
             usuarioConsulta = genericBean.getPropertyString("usuarioConsulta");
 
             sbQuery = new StringBuilder();
@@ -64,6 +67,7 @@
             sbQuery.append("  INNER JOIN DFIN.WFMWORK WORK ");
             sbQuery.append("     ON (WORK.C_IDWORK = SGCA.C_IDWORK) ");
             sbQuery.append("  WHERE 1 = 1 ");
+            sbQuery.append("  AND SGCA.C_ESTREG = 'S' ");
 
             //FECHA ASIGNACION
             if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
@@ -73,10 +77,10 @@
                 sbQuery.append("    AND SGCA.D_FECASG <= :fechaAsignacionFinal ");
             }
             //FECHA ATENCION
-            if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
+            if (!StringUtil.isEmpty(fechaAtencionInicial)) {
                 sbQuery.append("    AND SGCA.D_FECATE >= :fechaAtencionInicial ");
             }
-            if (!StringUtil.isEmpty(fechaAsignacionFinal)) {
+            if (!StringUtil.isEmpty(fechaAtencionFinal)) {
                 sbQuery.append("    AND SGCA.D_FECATE <= :fechaAtencionFinal ");
             }
             if (!StringUtil.isEmpty(codigoTipoAlerta)) {
@@ -93,6 +97,33 @@
             }
             if (!StringUtil.isEmpty(codigoEstado)) {
                 sbQuery.append("    AND WORK.C_IDESTA = :codigoEstado ");
+            }
+
+            sbQuery.append("           AND (NOT EXISTS ");
+            sbQuery.append("               (SELECT 'X' ");
+            sbQuery.append("                   FROM DFIN.WFTESTA ESTA ");
+            sbQuery.append("                  WHERE ESTA.C_IDESTA = WORK.C_IDESTA ");
+            sbQuery.append("                    AND ESTA.C_KEYEST IN ('REGISTRADO_SEG_CARTERA', 'ANULADO_SEG_CARTERA'))  ");
+            sbQuery.append("               OR EXISTS ");
+            sbQuery.append("               (SELECT 'X' ");
+            sbQuery.append("                   FROM DFIN.WFTESTA ESTA ");
+            sbQuery.append("                  WHERE ESTA.C_IDESTA = WORK.C_IDESTA ");
+            sbQuery.append("                    AND ESTA.C_KEYEST IN ('REGISTRADO_SEG_CARTERA', 'ANULADO_SEG_CARTERA')) ");
+            sbQuery.append("               AND EXISTS ");
+            sbQuery.append("               (SELECT 'X' ");
+            sbQuery.append("                   FROM DADM.CBDRLUS RLUS ");
+            sbQuery.append("                  INNER JOIN DADM.SSMNROL NROL ");
+            sbQuery.append("                     ON (RLUS.C_IDEROL = NROL.C_IDEROL) ");
+            sbQuery.append("                  INNER JOIN DADM.SSMNOPC NOPC ");
+            sbQuery.append("                     ON (NOPC.C_IDMNOP = NROL.C_IDMNOP) ");
+            sbQuery.append("                  WHERE RLUS.C_CODUSU = :usuarioConsulta ");
+            sbQuery.append("                    AND RLUS.C_ESTREG = 'S' ");
+            sbQuery.append("                    AND NROL.C_ESTREG = 'S' ");
+            sbQuery.append("                    AND NOPC.C_ESTREG = 'S' ");
+            sbQuery.append("                    AND NOPC.C_KEYMNU = 'WF_SEG_CAR_CON_GYS')) ");
+
+            if (!StringUtil.isEmpty(codigoTipoProducto)) {
+                sbQuery.append("    AND SGCA.C_TIPPRO = :codigoTipoProducto ");
             }
             if (!StringUtil.equiv(usuarioConsulta, codigoAsesor)) {
                 sbQuery.append("     AND (EXISTS (SELECT 'X' ");
@@ -151,9 +182,10 @@
             if (!StringUtil.isEmpty(codigoEstado)) {
                 query.setParameter("codigoEstado", codigoEstado);
             }
-            if (!StringUtil.equiv(usuarioConsulta, codigoAsesor)) {
-                query.setParameter("usuarioConsulta", usuarioConsulta);
+            if (!StringUtil.isEmpty(codigoTipoProducto)) {
+                query.setParameter("codigoTipoProducto", codigoTipoProducto);
             }
+            query.setParameter("usuarioConsulta", usuarioConsulta);
 
             return StringUtil.toLong(query.getSingleResult());
 
@@ -177,6 +209,7 @@
         String codigoAsesor;
         String codigoCliente;
         String codigoEstado;
+        String codigoTipoProducto;
         String usuarioConsulta;
 
         try {
@@ -190,6 +223,7 @@
             codigoAsesor = genericBean.getPropertyString("codigoAsesor");
             codigoCliente = genericBean.getPropertyString("codigoCliente");
             codigoEstado = genericBean.getPropertyString("codigoEstado");
+            codigoTipoProducto = genericBean.getPropertyString("codigoTipoProducto");
             usuarioConsulta = genericBean.getPropertyString("usuarioConsulta");
 
             sbQuery = new StringBuilder();
@@ -199,7 +233,182 @@
             sbQuery.append("  INNER JOIN DFIN.WFMWORK WORK ");
             sbQuery.append("     ON (WORK.C_IDWORK = SGCA.C_IDWORK) ");
             sbQuery.append("  WHERE 1 = 1 ");
+            sbQuery.append("  AND SGCA.C_ESTREG = 'S' ");
 
+            //FECHA ASIGNACION
+            if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
+                sbQuery.append("    AND SGCA.D_FECASG >= :fechaAsignacionInicial ");
+            }
+            if (!StringUtil.isEmpty(fechaAsignacionFinal)) {
+                sbQuery.append("    AND SGCA.D_FECASG <= :fechaAsignacionFinal ");
+            }
+            //FECHA ATENCION
+            if (!StringUtil.isEmpty(fechaAtencionInicial)) {
+                sbQuery.append("    AND SGCA.D_FECATE >= :fechaAtencionInicial ");
+            }
+            if (!StringUtil.isEmpty(fechaAtencionFinal)) {
+                sbQuery.append("    AND SGCA.D_FECATE <= :fechaAtencionFinal ");
+            }
+            if (!StringUtil.isEmpty(codigoTipoAlerta)) {
+                sbQuery.append("    AND SGCA.C_TIPALE = :codigoTipoAlerta ");
+            }
+            if (!StringUtil.isEmpty(codigoAgencia)) {
+                sbQuery.append("    AND SGCA.C_AGEASG = :codigoAgencia ");
+            }
+            if (!StringUtil.isEmpty(codigoAsesor)) {
+                sbQuery.append("    AND SGCA.C_USUASG = :codigoAsesor ");
+            }
+            if (!StringUtil.isEmpty(codigoCliente)) {
+                sbQuery.append("    AND SGCA.C_CODPER = :codigoCliente ");
+            }
+            if (!StringUtil.isEmpty(codigoEstado)) {
+                sbQuery.append("    AND WORK.C_IDESTA = :codigoEstado ");
+            }
+
+            sbQuery.append("           AND (NOT EXISTS ");
+            sbQuery.append("               (SELECT 'X' ");
+            sbQuery.append("                   FROM DFIN.WFTESTA ESTA ");
+            sbQuery.append("                  WHERE ESTA.C_IDESTA = WORK.C_IDESTA ");
+            sbQuery.append("                    AND ESTA.C_KEYEST IN ('REGISTRADO_SEG_CARTERA', 'ANULADO_SEG_CARTERA'))  ");
+            sbQuery.append("               OR EXISTS ");
+            sbQuery.append("               (SELECT 'X' ");
+            sbQuery.append("                   FROM DFIN.WFTESTA ESTA ");
+            sbQuery.append("                  WHERE ESTA.C_IDESTA = WORK.C_IDESTA ");
+            sbQuery.append("                    AND ESTA.C_KEYEST IN ('REGISTRADO_SEG_CARTERA', 'ANULADO_SEG_CARTERA')) ");
+            sbQuery.append("               AND EXISTS ");
+            sbQuery.append("               (SELECT 'X' ");
+            sbQuery.append("                   FROM DADM.CBDRLUS RLUS ");
+            sbQuery.append("                  INNER JOIN DADM.SSMNROL NROL ");
+            sbQuery.append("                     ON (RLUS.C_IDEROL = NROL.C_IDEROL) ");
+            sbQuery.append("                  INNER JOIN DADM.SSMNOPC NOPC ");
+            sbQuery.append("                     ON (NOPC.C_IDMNOP = NROL.C_IDMNOP) ");
+            sbQuery.append("                  WHERE RLUS.C_CODUSU = :usuarioConsulta ");
+            sbQuery.append("                    AND RLUS.C_ESTREG = 'S' ");
+            sbQuery.append("                    AND NROL.C_ESTREG = 'S' ");
+            sbQuery.append("                    AND NOPC.C_ESTREG = 'S' ");
+            sbQuery.append("                    AND NOPC.C_KEYMNU = 'WF_SEG_CAR_CON_GYS')) ");
+
+            if (!StringUtil.isEmpty(codigoTipoProducto)) {
+                sbQuery.append("    AND SGCA.C_TIPPRO = :codigoTipoProducto ");
+            }
+            if (!StringUtil.equiv(usuarioConsulta, codigoAsesor)) {
+                sbQuery.append("     AND (EXISTS (SELECT 'X' ");
+                sbQuery.append("                    FROM DADM.CBDRLUS RLUS ");
+                sbQuery.append("                   INNER JOIN DADM.SSMNROL NROL ");
+                sbQuery.append("                      ON (RLUS.C_IDEROL = NROL.C_IDEROL) ");
+                sbQuery.append("                   INNER JOIN DADM.SSMNOPC NOPC ");
+                sbQuery.append("                      ON (NOPC.C_IDMNOP = NROL.C_IDMNOP) ");
+                sbQuery.append("                   WHERE RLUS.C_CODUSU = :usuarioConsulta ");
+                sbQuery.append("                     AND RLUS.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND NROL.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND NOPC.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND NOPC.C_KEYMNU = 'WF_SEG_CAR_CON') OR ");
+                sbQuery.append("          (EXISTS (SELECT 'X' ");
+                sbQuery.append("                    FROM DADM.CBTAGEN AGEN ");
+                sbQuery.append("                   INNER JOIN DADM.CBTREGA REGA ");
+                sbQuery.append("                      ON (REGA.C_IDREGA = AGEN.C_IDREGA) ");
+                sbQuery.append("                   WHERE REGA.C_JEFERE = :usuarioConsulta ");
+                sbQuery.append("                     AND REGA.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND AGEN.C_CODAGE = SGCA.C_AGEASG) OR ");
+                sbQuery.append("          EXISTS (SELECT 'X' ");
+                sbQuery.append("                    FROM DADM.CBTAGEN AGEN ");
+                sbQuery.append("                   WHERE AGEN.C_EJECUT = :usuarioConsulta ");
+                sbQuery.append("                     AND AGEN.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND AGEN.C_CODAGE = SGCA.C_AGEASG))) ");
+            }
+            sbQuery.append("  ORDER BY SGCA.D_FECATE, SGCA.C_TIPALE ");
+
+            query = entityManager.createNativeQuery(sbQuery.toString(), CRSeguimientoCartera.class);
+
+            //FECHA ASIGNACION
+            if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
+                query.setParameter("fechaAsignacionInicial", fechaAsignacionInicial, TemporalType.DATE);
+            }
+            if (!StringUtil.isEmpty(fechaAsignacionFinal)) {
+                query.setParameter("fechaAsignacionFinal", fechaAsignacionFinal, TemporalType.DATE);
+            }
+            //FECHA ATENCION
+            if (!StringUtil.isEmpty(fechaAtencionInicial)) {
+                query.setParameter("fechaAtencionInicial", fechaAtencionInicial, TemporalType.DATE);
+            }
+            if (!StringUtil.isEmpty(fechaAtencionFinal)) {
+                query.setParameter("fechaAtencionFinal", fechaAtencionFinal, TemporalType.DATE);
+            }
+            if (!StringUtil.isEmpty(codigoTipoAlerta)) {
+                query.setParameter("codigoTipoAlerta", codigoTipoAlerta);
+            }
+            if (!StringUtil.isEmpty(codigoAgencia)) {
+                query.setParameter("codigoAgencia", codigoAgencia);
+            }
+            if (!StringUtil.isEmpty(codigoAsesor)) {
+                query.setParameter("codigoAsesor", codigoAsesor);
+            }
+            if (!StringUtil.isEmpty(codigoCliente)) {
+                query.setParameter("codigoCliente", codigoCliente);
+            }
+            if (!StringUtil.isEmpty(codigoEstado)) {
+                query.setParameter("codigoEstado", codigoEstado);
+            }
+            if (!StringUtil.isEmpty(codigoTipoProducto)) {
+                query.setParameter("codigoTipoProducto", codigoTipoProducto);
+            }
+            query.setParameter("usuarioConsulta", usuarioConsulta);
+
+            if (!StringUtil.isEmpty(maxResultado) && maxResultado > 0) {
+                query.setFirstResult(posicionInicial);
+                query.setMaxResults(maxResultado);
+            }
+
+            return query.getResultList();
+        } catch (NoResultException e) {
+            return new ArrayList<CRSeguimientoCartera>(0);
+        } catch (Exception e) {
+            throw e;
+        }
+    }
+
+    public Long countSeguimientoCarteraByIdLote(GenericBean genericBean) throws Exception {
+
+        Query query;
+        StringBuilder sbQuery;
+        Date fechaAsignacionInicial;
+        Date fechaAsignacionFinal;
+        Date fechaAtencionInicial;
+        Date fechaAtencionFinal;
+        String codigoTipoAlerta;
+        String codigoAgencia;
+        String codigoAsesor;
+        String codigoCliente;
+        String codigoEstado;
+        String usuarioConsulta;
+        String idLote;
+
+        try {
+
+            fechaAsignacionInicial = genericBean.getPropertyDate("fechaAsignacionInicial");
+            fechaAsignacionFinal = genericBean.getPropertyDate("fechaAsignacionFinal");
+            fechaAtencionInicial = genericBean.getPropertyDate("fechaAtencionInicial");
+            fechaAtencionFinal = genericBean.getPropertyDate("fechaAtencionFinal");
+            codigoTipoAlerta = genericBean.getPropertyString("codigoTipoAlerta");
+            codigoAgencia = genericBean.getPropertyString("codigoAgencia");
+            codigoAsesor = genericBean.getPropertyString("codigoAsesor");
+            codigoCliente = genericBean.getPropertyString("codigoCliente");
+            codigoEstado = genericBean.getPropertyString("codigoEstado");
+            usuarioConsulta = genericBean.getPropertyString("usuarioConsulta");
+            idLote = genericBean.getPropertyString("idLote");
+
+            sbQuery = new StringBuilder();
+
+            sbQuery.append("  SELECT COUNT(*) ");
+            sbQuery.append("   FROM DFIN.CRDSGCA SGCA ");
+            sbQuery.append("  INNER JOIN DFIN.WFMWORK WORK ");
+            sbQuery.append("     ON (WORK.C_IDWORK = SGCA.C_IDWORK) ");
+            sbQuery.append("  WHERE 1 = 1 ");
+
+            //Id Lote
+            if (!StringUtil.isEmpty(idLote)) {
+                sbQuery.append("    AND SGCA.C_IDSGCA = :idLote ");
+            }
             //FECHA ASIGNACION
             if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
                 sbQuery.append("    AND SGCA.D_FECASG >= :fechaAsignacionInicial ");
@@ -254,11 +463,152 @@
                 sbQuery.append("                     AND AGEN.C_ESTREG = 'S' ");
                 sbQuery.append("                     AND AGEN.C_CODAGE = SGCA.C_AGEASG))) ");
             }
+
+            query = entityManager.createNativeQuery(sbQuery.toString());
+
+            if (!StringUtil.isEmpty(idLote)) {
+                query.setParameter("idLote", idLote);
+            }
+            //FECHA ASIGNACION
+            if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
+                query.setParameter("fechaAsignacionInicial", fechaAsignacionInicial, TemporalType.DATE);
+            }
+            if (!StringUtil.isEmpty(fechaAsignacionFinal)) {
+                query.setParameter("fechaAsignacionFinal", fechaAsignacionFinal, TemporalType.DATE);
+            }
+            //FECHA ATENCION
+            if (!StringUtil.isEmpty(fechaAtencionInicial)) {
+                query.setParameter("fechaAtencionInicial", fechaAtencionInicial, TemporalType.DATE);
+            }
+            if (!StringUtil.isEmpty(fechaAtencionFinal)) {
+                query.setParameter("fechaAtencionFinal", fechaAtencionFinal, TemporalType.DATE);
+            }
+            if (!StringUtil.isEmpty(codigoTipoAlerta)) {
+                query.setParameter("codigoTipoAlerta", codigoTipoAlerta);
+            }
+            if (!StringUtil.isEmpty(codigoAgencia)) {
+                query.setParameter("codigoAgencia", codigoAgencia);
+            }
+            if (!StringUtil.isEmpty(codigoAsesor)) {
+                query.setParameter("codigoAsesor", codigoAsesor);
+            }
+            if (!StringUtil.isEmpty(codigoCliente)) {
+                query.setParameter("codigoCliente", codigoCliente);
+            }
+            if (!StringUtil.isEmpty(codigoEstado)) {
+                query.setParameter("codigoEstado", codigoEstado);
+            }
+            if (!StringUtil.equiv(usuarioConsulta, codigoAsesor)) {
+                query.setParameter("usuarioConsulta", usuarioConsulta);
+            }
+
+            return StringUtil.toLong(query.getSingleResult());
+
+        } catch (Exception e) {
+            throw e;
+        }
+    }
+
+    public List<CRSeguimientoCartera> findSeguimientoCarteraByIdLote(GenericBean genericBean,
+                                                                     int posicionInicial,
+                                                                     int maxResultado) throws Exception {
+
+        Query query;
+        StringBuilder sbQuery;
+        Date fechaAsignacionInicial;
+        Date fechaAsignacionFinal;
+        Date fechaAtencionInicial;
+        Date fechaAtencionFinal;
+        String codigoTipoAlerta;
+        String codigoAgencia;
+        String codigoAsesor;
+        String codigoCliente;
+        String codigoEstado;
+        String usuarioConsulta;
+        String idLote;
+
+        try {
+
+            fechaAsignacionInicial = genericBean.getPropertyDate("fechaAsignacionInicial");
+            fechaAsignacionFinal = genericBean.getPropertyDate("fechaAsignacionFinal");
+            fechaAtencionInicial = genericBean.getPropertyDate("fechaAtencionInicial");
+            fechaAtencionFinal = genericBean.getPropertyDate("fechaAtencionFinal");
+            codigoTipoAlerta = genericBean.getPropertyString("codigoTipoAlerta");
+            codigoAgencia = genericBean.getPropertyString("codigoAgencia");
+            codigoAsesor = genericBean.getPropertyString("codigoAsesor");
+            codigoCliente = genericBean.getPropertyString("codigoCliente");
+            codigoEstado = genericBean.getPropertyString("codigoEstado");
+            usuarioConsulta = genericBean.getPropertyString("usuarioConsulta");
+            idLote = genericBean.getPropertyString("idLote");
+
+            sbQuery = new StringBuilder();
+
+            sbQuery.append("  SELECT SGCA.* ");
+            sbQuery.append("   FROM DFIN.CRDSGCA SGCA ");
+            sbQuery.append("  WHERE 1 = 1 ");
+
+            //ID LOTE
+            if (!StringUtil.isEmpty(idLote)) {
+                sbQuery.append("    AND SGCA.C_IDSGCA = :idLote ");
+            }
+            //FECHA ASIGNACION
+            if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
+                sbQuery.append("    AND SGCA.D_FECASG >= :fechaAsignacionInicial ");
+            }
+            if (!StringUtil.isEmpty(fechaAsignacionFinal)) {
+                sbQuery.append("    AND SGCA.D_FECASG <= :fechaAsignacionFinal ");
+            }
+            //FECHA ATENCION
+            if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
+                sbQuery.append("    AND SGCA.D_FECATE >= :fechaAtencionInicial ");
+            }
+            if (!StringUtil.isEmpty(fechaAsignacionFinal)) {
+                sbQuery.append("    AND SGCA.D_FECATE <= :fechaAtencionFinal ");
+            }
+            if (!StringUtil.isEmpty(codigoTipoAlerta)) {
+                sbQuery.append("    AND SGCA.C_TIPALE = :codigoTipoAlerta ");
+            }
+            if (!StringUtil.isEmpty(codigoAgencia)) {
+                sbQuery.append("    AND SGCA.C_AGEASG = :codigoAgencia ");
+            }
+            if (!StringUtil.isEmpty(codigoAsesor)) {
+                sbQuery.append("    AND SGCA.C_USUASG = :codigoAsesor ");
+            }
+            if (!StringUtil.isEmpty(codigoCliente)) {
+                sbQuery.append("    AND SGCA.C_CODPER = :codigoCliente ");
+            }
+            if (!StringUtil.equiv(usuarioConsulta, codigoAsesor)) {
+                sbQuery.append("     AND (EXISTS (SELECT 'X' ");
+                sbQuery.append("                    FROM DADM.CBDRLUS RLUS ");
+                sbQuery.append("                   INNER JOIN DADM.SSMNROL NROL ");
+                sbQuery.append("                      ON (RLUS.C_IDEROL = NROL.C_IDEROL) ");
+                sbQuery.append("                   INNER JOIN DADM.SSMNOPC NOPC ");
+                sbQuery.append("                      ON (NOPC.C_IDMNOP = NROL.C_IDMNOP) ");
+                sbQuery.append("                   WHERE RLUS.C_CODUSU = :usuarioConsulta ");
+                sbQuery.append("                     AND RLUS.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND NROL.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND NOPC.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND NOPC.C_KEYMNU = 'WF_SEG_CAR_CON') OR ");
+                sbQuery.append("          (EXISTS (SELECT 'X' ");
+                sbQuery.append("                    FROM DADM.CBTAGEN AGEN ");
+                sbQuery.append("                   INNER JOIN DADM.CBTREGA REGA ");
+                sbQuery.append("                      ON (REGA.C_IDREGA = AGEN.C_IDREGA) ");
+                sbQuery.append("                   WHERE REGA.C_JEFERE = :usuarioConsulta ");
+                sbQuery.append("                     AND REGA.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND AGEN.C_CODAGE = SGCA.C_AGEASG) OR ");
+                sbQuery.append("          EXISTS (SELECT 'X' ");
+                sbQuery.append("                    FROM DADM.CBTAGEN AGEN ");
+                sbQuery.append("                   WHERE AGEN.C_EJECUT = :usuarioConsulta ");
+                sbQuery.append("                     AND AGEN.C_ESTREG = 'S' ");
+                sbQuery.append("                     AND AGEN.C_CODAGE = SGCA.C_AGEASG))) ");
+            }
             sbQuery.append("  ORDER BY SGCA.D_FECATE, SGCA.C_TIPALE ");
 
             query = entityManager.createNativeQuery(sbQuery.toString(), CRSeguimientoCartera.class);
 
-
+            if (!StringUtil.isEmpty(idLote)) {
+                query.setParameter("idLote", idLote);
+            }
             //FECHA ASIGNACION
             if (!StringUtil.isEmpty(fechaAsignacionInicial)) {
                 query.setParameter("fechaAsignacionInicial", fechaAsignacionInicial, TemporalType.DATE);
@@ -303,4 +653,166 @@
         }
     }
 
+    public List<Object[]> listarAtendidosGroupByAgenciaAlerta(String idEstadoAtendido) throws Exception {
+
+        Query query;
+        StringBuilder sbQuery;
+
+        try {
+            sbQuery = new StringBuilder();
+
+            sbQuery.append(" SELECT (SELECT C_DESCRI FROM DADM.CBTAGEN WHERE C_CODAGE = SGCA.C_AGEASG), ");
+            sbQuery.append("        (SELECT C_DESCRI FROM DFIN.CRTTIAL WHERE C_IDTIAL = SGCA.C_TIPALE), ");
+            sbQuery.append("        COUNT(*) ");
+            sbQuery.append("   FROM DFIN.CRDSGCA SGCA ");
+            sbQuery.append("  INNER JOIN DFIN.WFMWORK ORK ");
+            sbQuery.append("     ON ORK.C_IDWORK = SGCA.C_IDWORK ");
+            sbQuery.append("  WHERE SGCA.C_INDECO = 'N' ");
+            sbQuery.append("    AND SGCA.C_ESTREG = 'S' ");
+            sbQuery.append("    AND ORK.C_IDESTA = :idEstadoAtendido ");
+            sbQuery.append("  GROUP BY C_AGEASG, C_TIPALE ");
+            sbQuery.append("  ORDER BY C_AGEASG ");
+
+            query = entityManager.createNativeQuery(sbQuery.toString());
+            query.setParameter("idEstadoAtendido", idEstadoAtendido);
+
+            return query.getResultList();
+        } catch (final RuntimeException re) {
+            throw re;
+        }
+    }
+
+    public List<CRSeguimientoCartera> listarPorEstadosOUsuarioAsignado(String idEstadoObservado,
+                                                                       String idEstadoFinalizado,
+                                                                       String idEstadoAsignado,
+                                                                       String idEstadoResolucion,
+                                                                       String usuarioAsignado,
+                                                                       String indicadorEnvioCorreo) throws Exception {
+
+        Query query;
+        StringBuilder sbQuery;
+
+        try {
+            sbQuery = new StringBuilder();
+
+            sbQuery.append("  SELECT SGCA ");
+            sbQuery.append("     FROM CRSeguimientoCartera SGCA ");
+            sbQuery.append("  WHERE 1=1 ");
+            sbQuery.append("      AND SGCA.estadoRegistro = 'S' ");
+            //FILTRAR POR INDICADOR DE ENVIO DE CORREO
+            if (!StringUtil.isEmpty(indicadorEnvioCorreo)) {
+                sbQuery.append("  AND SGCA.indicadorEnvioCorreo = :indicadorEnvioCorreo ");
+            }
+            //ASIGNADO Y OBSERVADO
+            if (!StringUtil.isEmpty(idEstadoObservado) && !StringUtil.isEmpty(idEstadoAsignado) && StringUtil.isEmpty(idEstadoFinalizado)) {
+                sbQuery.append("  AND (SGCA.wfMaestra.wfEstado.idEstado = :idEstadoObservado ");
+                sbQuery.append("  OR SGCA.wfMaestra.wfEstado.idEstado = :idEstadoAsignado) ");
+            }
+            //FINALIZADO Y OBSERVADO
+            if (!StringUtil.isEmpty(idEstadoObservado) && !StringUtil.isEmpty(idEstadoFinalizado) && StringUtil.isEmpty(idEstadoAsignado)) {
+                sbQuery.append("  AND (SGCA.wfMaestra.wfEstado.idEstado = :idEstadoObservado ");
+                sbQuery.append("  OR SGCA.wfMaestra.wfEstado.idEstado = :idEstadoFinalizado) ");
+            }
+            //ASIGNADO
+            if (!StringUtil.isEmpty(idEstadoAsignado) && StringUtil.isEmpty(idEstadoObservado) && StringUtil.isEmpty(idEstadoFinalizado)) {
+                sbQuery.append("  AND SGCA.wfMaestra.wfEstado.idEstado = :idEstadoAsignado ");
+            }
+            if (!StringUtil.isEmpty(idEstadoResolucion)) {
+                sbQuery.append("  AND SGCA.wfMaestra.wfEstado.idEstado = :idEstadoResolucion ");
+            }
+            if (!StringUtil.isEmpty(usuarioAsignado)) {
+                sbQuery.append("      AND SGCA.usuarioAsignado = :usuarioAsignado ");
+            }
+            sbQuery.append("  ORDER BY SGCA.wfMaestra.wfEstado.idEstado DESC");
+
+            query = entityManager.createQuery(sbQuery.toString());
+            if (!StringUtil.isEmpty(indicadorEnvioCorreo)) {
+                query.setParameter("indicadorEnvioCorreo", indicadorEnvioCorreo);
+            }
+            if (!StringUtil.isEmpty(idEstadoObservado) && !StringUtil.isEmpty(idEstadoAsignado) && StringUtil.isEmpty(idEstadoFinalizado)) {
+                query.setParameter("idEstadoObservado", idEstadoObservado);
+                query.setParameter("idEstadoAsignado", idEstadoAsignado);
+            }
+            if (!StringUtil.isEmpty(idEstadoObservado) && !StringUtil.isEmpty(idEstadoFinalizado) && StringUtil.isEmpty(idEstadoAsignado)) {
+                query.setParameter("idEstadoObservado", idEstadoObservado);
+                query.setParameter("idEstadoFinalizado", idEstadoFinalizado);
+            }
+            if (!StringUtil.isEmpty(idEstadoAsignado) && StringUtil.isEmpty(idEstadoObservado) && StringUtil.isEmpty(idEstadoFinalizado)) {
+                query.setParameter("idEstadoAsignado", idEstadoAsignado);
+            }
+            if (!StringUtil.isEmpty(idEstadoResolucion)) {
+                query.setParameter("idEstadoResolucion", idEstadoResolucion);
+            }
+            if (!StringUtil.isEmpty(usuarioAsignado)) {
+                query.setParameter("usuarioAsignado", usuarioAsignado);
+            }
+
+            return query.getResultList();
+        } catch (NoResultException e) {
+            return new ArrayList<CRSeguimientoCartera>(0);
+        } catch (Exception e) {
+            throw e;
+        }
+    }
+    
+    public List<Object[]> listarUsuariosAsignadosAgencias(String idEstadoAsignado,
+                                                          String idEstadoObservado,
+                                                          String idEstadoFinalizado,
+                                                          String indicadorEnvioCorreo) throws Exception {
+
+        Query query;
+        StringBuilder sbQuery;
+
+        try {
+            sbQuery = new StringBuilder();
+
+            sbQuery.append(" SELECT DISTINCT SGCA.C_AGEASG, SGCA.C_USUASG ");
+            sbQuery.append("   FROM DFIN.CRDSGCA SGCA ");
+            sbQuery.append("  INNER JOIN WFMWORK ORK ");
+            sbQuery.append("     ON ORK.C_IDWORK = SGCA.C_IDWORK ");
+            sbQuery.append("  WHERE SGCA.C_ESTREG = 'S' ");
+            //FILTRAR POR INDICADOR DE ENVIO DE CORREO
+            if (!StringUtil.isEmpty(indicadorEnvioCorreo)) {
+                sbQuery.append("  AND SGCA.C_INDECO = :indicadorEnvioCorreo ");
+            }
+            //SOLO ASIGNADO
+            if (!StringUtil.isEmpty(idEstadoAsignado) && StringUtil.isEmpty(idEstadoObservado) && StringUtil.isEmpty(idEstadoFinalizado)) {
+                sbQuery.append("  AND ORK.C_IDESTA = :idEstadoAsignado ");
+            }
+            // OBSERVADO Y FINALIZADO
+            if (!StringUtil.isEmpty(idEstadoObservado) && !StringUtil.isEmpty(idEstadoFinalizado) && StringUtil.isEmpty(idEstadoAsignado)) {
+                sbQuery.append("  AND (ORK.C_IDESTA = :idEstadoObservado ");
+                sbQuery.append("  OR ORK.C_IDESTA = :idEstadoFinalizado) ");
+            }
+            //OBSERVADO Y ASIGNADO
+            if (!StringUtil.isEmpty(idEstadoObservado) && !StringUtil.isEmpty(idEstadoAsignado) && StringUtil.isEmpty(idEstadoFinalizado)) {
+                sbQuery.append("  AND (ORK.C_IDESTA = :idEstadoObservado ");
+                sbQuery.append("  OR ORK.C_IDESTA = :idEstadoAsignado) ");
+            }
+            query = entityManager.createNativeQuery(sbQuery.toString());
+            //FILTRAR POR INDICADOR DE ENVIO DE CORREO
+            if (!StringUtil.isEmpty(indicadorEnvioCorreo)) {
+                query.setParameter("indicadorEnvioCorreo", indicadorEnvioCorreo);
+            }
+            //SOLO ASIGNADO
+            if (!StringUtil.isEmpty(idEstadoAsignado) && StringUtil.isEmpty(idEstadoObservado) && StringUtil.isEmpty(idEstadoFinalizado)) {
+                query.setParameter("idEstadoAsignado", idEstadoAsignado);
+            }
+            // OBSERVADO Y FINALIZADO
+            if (!StringUtil.isEmpty(idEstadoObservado) && !StringUtil.isEmpty(idEstadoFinalizado) && StringUtil.isEmpty(idEstadoAsignado)) {
+                query.setParameter("idEstadoObservado", idEstadoObservado);
+                query.setParameter("idEstadoFinalizado", idEstadoFinalizado);
+            }
+            //OBSERVADO Y ASIGNADO
+            if (!StringUtil.isEmpty(idEstadoObservado) && !StringUtil.isEmpty(idEstadoAsignado) && StringUtil.isEmpty(idEstadoFinalizado) ) {
+                query.setParameter("idEstadoObservado", idEstadoObservado);
+                query.setParameter("idEstadoAsignado", idEstadoAsignado);
+            }
+
+            return query.getResultList();
+        } catch (final RuntimeException re) {
+            throw re;
+        }
+    }
+
 }
diff --git a/FINANCIERONEW/src/financ/util/Constante.java b/FINANCIERONEW/src/financ/util/Constante.java
index af9b7ce..734c03d 100644
--- a/FINANCIERONEW/src/financ/util/Constante.java
+++ b/FINANCIERONEW/src/financ/util/Constante.java
@@ -2444,21 +2444,42 @@
     public static final String CODIGO_ESTADO_LOTE_REGISTRADO = "REG";
 
     public static final String CODIGO_TIPO_SEGUIMIENTO_INDIVIDUAL = "I";
-    
+
     public static final String CR_MODULO_SEGUIMIENTO_CARTERA = "SEGUIMIENTO_CARTERA";
 
     public static final String CODIGO_EVENTO_GRABAR = "BT_GRABAR_SEG_CAR";
     public static final String CODIGO_EVENTO_ENVIAR = "BT_ENVIAR_SEG_CAR";
-    
+    public static final String CODIGO_EVENTO_OBSERVAR = "BT_OBSERVAR_SEG_CAR";
+
     public static final String CODIGO_RUTA_SEGUIMIENTO_CARTERA = "SEGUIMIENTO_CARTERA_RUTA";
-    
+
     public static final String COMPORTAMIENTO_CONSULTA = "C";
     public static final String COMPORTAMIENTO_TRANSACCIONAL = "T";
-    
+
     public static final String CODIGO_TIPO_RESPUESTA_ENVIADO = "EN";
-    
+    public static final String CODIGO_TIPO_RESPUESTA_DEVUELTO = "DE";
+
     public static final String CODIGO_TIPO_MOTIVO_AMPLIACION_ATENCION = "S";
+
+    public static final String CODIGO_ESTADO_SEGUIMIENTO_CARTERA_FINALIZADO = "FINALIZADO_SEG_CARTERA";
+    public static final String CODIGO_ESTADO_SEGUIMIENTO_CARTERA_OBSERVADO = "OBSERVADO_SEG_CARTERA";
+    public static final String CODIGO_ESTADO_SEGUIMIENTO_CARTERA_ATENDIDO = "ATENDIDO_SEG_CARTERA";
+    public static final String CODIGO_ESTADO_SEGUIMIENTO_CARTERA_ASIGNADO = "ASIGNADO_SEG_CARTERA";
+    public static final String CODIGO_ESTADO_SEGUIMIENTO_CARTERA_REGISTRADO = "REGISTRADO_SEG_CARTERA";
     
+    public static final String SEGUIMIENTO_CARTERA_CORREO_DESTINATARIO_GyS = "gys@tfc.com.pe";
+
+    public static final String WF_SEGUIMIENTO_CARTERA_CODIGO_MODULO_ASIGNACION = "COPREN10";
+    public static final String WF_SEGUIMIENTO_CARTERA_CODIGO_MODULO_RESOLUCION = "COPREN12";
+    public static final String WF_SEGUIMIENTO_CARTERA_CODIGO_MODULO_APROBACION_DEVOLUACION = "COPREN11";
+    public static final String WF_SEGUIMIENTO_CARTERA_CODIGO_MODULO_INCUMPLIMIENTO = "COPREN13";
+
+    public static final String INDICADOR_ENVIADO = "S";
+    public static final String INDICADOR_NO_ENVIADO = "N";
+    
+    public static final Integer SEGUIMIENTO_CARTERA_DIAS_INCUMPLIMIENTO = 5;
+    
+    public static final String SEGUIMIENTO_CARTERA_CODIGO_ETAPA_RESOLUCION = "RESOLUCION";
     //Fin [Req.S17-022]
     
     // Inicio [Req.S17-022] rsanchez 04.04.2017
@@ -2471,6 +2492,8 @@
     
     public static final String CODIGO_LOTE_APROBADO = "APR";
     public static final String CODIGO_LOTE_RECHAZADO = "REC";
+    
+    public static final String CODIGO_MENU_REGMAS = "WF_SEG_CAR_CLT";
     // Fin [Req.S17-022]
 
     // Inicio [CC17-044] agarcia 22.03.2017
diff --git a/FINANCIERONEW/src/financ/util/file/facade/CBFileFacade.java b/FINANCIERONEW/src/financ/util/file/facade/CBFileFacade.java
index e8b71dc..2e4060e 100644
--- a/FINANCIERONEW/src/financ/util/file/facade/CBFileFacade.java
+++ b/FINANCIERONEW/src/financ/util/file/facade/CBFileFacade.java
@@ -99,4 +99,5 @@
         return beanCBFile;
     }
 
+
 }
diff --git a/FINANCIERONEW/src/financ/workflow/bean/BeanWFMovimientos.java b/FINANCIERONEW/src/financ/workflow/bean/BeanWFMovimientos.java
index 0f7ee04..b326f76 100644
--- a/FINANCIERONEW/src/financ/workflow/bean/BeanWFMovimientos.java
+++ b/FINANCIERONEW/src/financ/workflow/bean/BeanWFMovimientos.java
@@ -31,6 +31,9 @@
     private String tiempoTranscurrido;
     private String usuarioInsercion;
     private String usuarioProceso;
+    //[Req.S17-022] kdelacruz 19.04.2017
+    private String keyEstadoInicial;
+    private String keyEstadoFinal;
 
     public String getIdMovimiento() {
         return idMovimiento;
@@ -168,4 +171,22 @@
         this.usuarioProceso = usuarioProceso;
     }
 
+  //Inicio [Req.S17-022] kdelacruz 19.04.2017
+    public String getKeyEstadoInicial() {
+        return keyEstadoInicial;
+    }
+
+    public void setKeyEstadoInicial(String keyEstadoInicial) {
+        this.keyEstadoInicial = keyEstadoInicial;
+    }
+
+    public String getKeyEstadoFinal() {
+        return keyEstadoFinal;
+    }
+
+    public void setKeyEstadoFinal(String keyEstadoFinal) {
+        this.keyEstadoFinal = keyEstadoFinal;
+    }
+    //Fin [Req.S17-022] kdelacruz 19.04.2017
+
 }
diff --git a/FINANCIERONEW/src/financ/workflow/entity/WFEvento.java b/FINANCIERONEW/src/financ/workflow/entity/WFEvento.java
index 5f5f657..7e64822 100644
--- a/FINANCIERONEW/src/financ/workflow/entity/WFEvento.java
+++ b/FINANCIERONEW/src/financ/workflow/entity/WFEvento.java
@@ -34,6 +34,8 @@
     private String indicadorInvocar;
     private Integer numeroOrden;
     private String keyEvento;
+    // [Req.S17-022] kdelacruz 11.04.2017
+    private String indicadorVisible;
 
     private WFModulo wfModulo;
     private List<WFEventoPorEtapa> listwfeventoporEtapa = new ArrayList<WFEventoPorEtapa>(0);
@@ -121,4 +123,14 @@
         this.listwfeventoporEtapa = listwfeventoporEtapa;
     }
 
+    // Inicio [Req.S17-022] kdelacruz 11.04.2017
+    @Column(name = "C_INDVIS", length = 1)
+    public String getIndicadorVisible() {
+        return indicadorVisible;
+    }
+
+    public void setIndicadorVisible(String indicadorVisible) {
+        this.indicadorVisible = indicadorVisible;
+    }
+    // Fin [Req.S17-022] 
 }
diff --git a/FINANCIERONEW/src/financ/workflow/facade/WFEstadoFacade.java b/FINANCIERONEW/src/financ/workflow/facade/WFEstadoFacade.java
index 870c922..5efddab 100644
--- a/FINANCIERONEW/src/financ/workflow/facade/WFEstadoFacade.java
+++ b/FINANCIERONEW/src/financ/workflow/facade/WFEstadoFacade.java
@@ -55,6 +55,8 @@
                 beanWFEstado = new BeanWFEstado();
                 beanWFEstado.setIdEstado(wfEstado.getIdEstado());
                 beanWFEstado.setDescripcionEstado(wfEstado.getDescripcionEstado());
+                //[Req.S17-022] kdelacruz 19.04.2017
+                beanWFEstado.setKeyEstado(wfEstado.getKeyEstado());
                 listBeanWFEstado.add(beanWFEstado);
             }
         } catch (final Exception e) {
@@ -63,4 +65,32 @@
         return listBeanWFEstado;
     }
 
+    // Inicio [Req.S17-022] kdelacruz 19.04.2017
+    public BeanWFEstado listarEstadoByKey(final String keyEstado, final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+
+        final String modulo = "WFEstadoFacade.listarEstadoByKey()";
+        List<WFEstado> listWFEstado = new ArrayList<WFEstado>(0);
+        BeanWFEstado beanWFEstado = new BeanWFEstado();
+        PropertyParams propertyParams;
+
+        try {
+            propertyParams = new PropertyParams();
+            propertyParams.addProperty("keyEstado", keyEstado);
+            propertyParams.addProperty("estadoRegistro", Constante.ESTADO_REGISTRO_VIGENTE);
+            propertyParams.setMaxResults(1);
+            listWFEstado = wfEstadoInterfaceLocal.findByProperties(propertyParams);
+
+            for (final WFEstado wfEstado : listWFEstado) {
+                beanWFEstado = new BeanWFEstado();
+                beanWFEstado.setIdEstado(wfEstado.getIdEstado());
+                beanWFEstado.setDescripcionEstado(wfEstado.getDescripcionEstado());
+                beanWFEstado.setKeyEstado(wfEstado.getKeyEstado());
+            }
+        } catch (final Exception e) {
+            throw handlerError(e, beanParametrosAuditoria.getUsuarioInsercion(), modulo);
+        }
+        return beanWFEstado;
+    }
+    //Fin [Req.S17-022]
+
 }
diff --git a/FINANCIERONEW/src/financ/workflow/facade/WFEventoFacade.java b/FINANCIERONEW/src/financ/workflow/facade/WFEventoFacade.java
index bac3d95..78c45c1 100644
--- a/FINANCIERONEW/src/financ/workflow/facade/WFEventoFacade.java
+++ b/FINANCIERONEW/src/financ/workflow/facade/WFEventoFacade.java
@@ -9,6 +9,7 @@
 import pe.com.tfc.utils.AbstractFacade;
 import pe.com.tfc.utils.PropertyParams;
 import admin.contab.beans.BeanParametrosAuditoria;
+import admin.util.Constante;
 import financ.workflow.bean.BeanWFEvento;
 import financ.workflow.entity.WFEvento;
 import financ.workflow.local.WFEventoFacadeInterfaceLocal;
@@ -38,6 +39,10 @@
 
             propertyParams = new PropertyParams();
             propertyParams.addProperty("wfModulo.idModulo", idModulo);
+            // Inicio [Req.S17-022] kdelacruz 11.04.2017
+            propertyParams.addProperty("indicadorVisible", Constante.INDICADOR_SI);
+            propertyParams.addProperty("estadoRegistro", Constante.ESTADO_REGISTRO_VIGENTE);
+            // Fin [Req.S17-022]
             propertyParams.addPropertyOrder("numeroOrden");
 
             lstWfEventos = wfEventoWorkflowInterfaceLocal.findByProperties(propertyParams);
diff --git a/FINANCIERONEW/src/financ/workflow/facade/WFEventoPorEtapaFacade.java b/FINANCIERONEW/src/financ/workflow/facade/WFEventoPorEtapaFacade.java
index 874340f..a8da4d0 100644
--- a/FINANCIERONEW/src/financ/workflow/facade/WFEventoPorEtapaFacade.java
+++ b/FINANCIERONEW/src/financ/workflow/facade/WFEventoPorEtapaFacade.java
@@ -9,6 +9,7 @@
 import pe.com.tfc.utils.AbstractFacade;
 import pe.com.tfc.utils.PropertyParams;
 import admin.contab.beans.BeanParametrosAuditoria;
+import admin.util.Constante;
 import financ.workflow.bean.BeanWFEvento;
 import financ.workflow.bean.BeanWFEventoPorEtapa;
 import financ.workflow.entity.WFEventoPorEtapa;
@@ -49,6 +50,8 @@
 
             propertyParams = new PropertyParams();
             propertyParams.addProperty("wfEtapa.idEtapa", idEtapa);
+          //[Req.S17-022] kdelacruz 19.04.2017
+            propertyParams.addProperty("wfEvento.indicadorVisible", Constante.INDICADOR_SI);
             if (!_isEmpty(idRuta)) {
                 propertyParams.addProperty("wfRuta.idRuta", idRuta);
             } else {
diff --git a/FINANCIERONEW/src/financ/workflow/facade/WFMovimientosFacade.java b/FINANCIERONEW/src/financ/workflow/facade/WFMovimientosFacade.java
index 0da26b4..cd2af5d 100644
--- a/FINANCIERONEW/src/financ/workflow/facade/WFMovimientosFacade.java
+++ b/FINANCIERONEW/src/financ/workflow/facade/WFMovimientosFacade.java
@@ -1,7 +1,5 @@
 package financ.workflow.facade;
 
-import java.text.DateFormat;
-import java.text.SimpleDateFormat;
 import java.util.ArrayList;
 import java.util.Date;
 import java.util.List;
@@ -12,6 +10,7 @@
 import pe.com.tfc.utils.AbstractFacade;
 import pe.com.tfc.utils.PropertyParams;
 import admin.contab.beans.BeanParametrosAuditoria;
+import admin.util.local.UtilAdminFacadeInterfaceLocal;
 import financ.util.Constante;
 import financ.util.FormatoFecha;
 import financ.workflow.bean.BeanWFMovimientos;
@@ -41,6 +40,9 @@
     private WFMaestraInterfaceLocal wfMaestraInterfaceLocal;
     @EJB
     private WFMovimientosFacadeInterfaceLocal wfMovimientosFacadeInterfaceLocal;
+    //[Req.S17-022] kdelacruz 19.04.2017
+    @EJB
+    private UtilAdminFacadeInterfaceLocal utilAdminFacadeInterfaceLocal;
 
     public String insertar(String idMaestra,
                            String idEtapaFinal,
@@ -61,7 +63,7 @@
             wfMovimientos.setWfMaestra(wfMaestra);
 
             if (!(_equiv(idEtapaFinal, wfMaestra.getWfEtapa().getIdEtapa()) && _equiv(idEstadoFinal,
-                                                                                      wfMaestra.getWfEstado().getIdEstado()))) {
+                                                                        wfMaestra.getWfEstado().getIdEstado()))) {
                 wfMovimientos.setWfEtapaInicial(wfMaestra.getWfEtapa());
                 wfMovimientos.setWfEstadoInicial(wfMaestra.getWfEstado());
 
@@ -136,9 +138,13 @@
         if (!_isEmpty(wfMovimientos.getWfEstadoInicial())) {
             beanWFMovimientos.setIdEstadoInicial(wfMovimientos.getWfEstadoInicial().getIdEstado());
             beanWFMovimientos.setDescripcionEstadoInicial(wfMovimientos.getWfEstadoInicial().getDescripcionEstado());
+          //[Req.S17-022] kdelacruz 19.04.2017
+            beanWFMovimientos.setKeyEstadoInicial(wfMovimientos.getWfEstadoInicial().getKeyEstado());
         }
         beanWFMovimientos.setIdEstadoFinal(wfMovimientos.getWfEstadoFinal().getIdEstado());
         beanWFMovimientos.setDescripcionEstadoFinal(wfMovimientos.getWfEstadoFinal().getDescripcionEstado());
+      //[Req.S17-022] kdelacruz 19.04.2017
+        beanWFMovimientos.setKeyEstadoFinal(wfMovimientos.getWfEstadoFinal().getKeyEstado());
         beanWFMovimientos.setFechaProceso(wfMovimientos.getFechaProceso());
         beanWFMovimientos.setHoraProceso(wfMovimientos.getHoraProceso());
         beanWFMovimientos.setUsuarioProceso(wfMovimientos.getUsuarioProceso());
@@ -155,7 +161,7 @@
 
         return beanWFMovimientos;
     }
-    
+
     public String obtenerUltimoComentario(String idMaestra,
                                           String idEtapaFinal,
                                           BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
@@ -188,14 +194,6 @@
                                         String horaProcesoFinalinal,
                                         BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
         String tiempoEstimado = "";
-        DateFormat formatter = new SimpleDateFormat("HH:mm:ss");
-        Date horaProcesoFinal;
-        Date horaProcesoInicial;
-        Long tiempoProcesoFinal;
-        Long tiempoProcesoInicial;
-        horaProcesoFinal = formatter.parse(horaProcesoFinalinal);
-        tiempoProcesoFinal = fechaProcesoFinal.getTime() + horaProcesoFinal.getTime();
-
         PropertyParams propertyParams = new PropertyParams();
         propertyParams.addProperty("idMovimiento", idMovimiento, PropertyParams.OPERADOR_MENOR);
         propertyParams.addProperty("wfMaestra.idMaestra", idMaestra);
@@ -205,13 +203,44 @@
 
         List<WFMovimientos> lstWFMovimientos = wfMovimientosInterfaceLocal.findByProperties(propertyParams);
         for (WFMovimientos wfMovimientos : lstWFMovimientos) {
-            horaProcesoInicial = formatter.parse(wfMovimientos.getHoraProceso());
-            tiempoProcesoInicial = wfMovimientos.getFechaProceso().getTime() + horaProcesoInicial.getTime();
-
-            tiempoEstimado = FormatoFecha.longToStringHHMMSS(new Date(tiempoProcesoFinal), new Date(tiempoProcesoInicial));
+            //[Req.S17-022] kdelacruz 19.04.2017
+            tiempoEstimado = utilAdminFacadeInterfaceLocal.obtenerTiempoTranscurrido(wfMovimientos.getFechaProceso(),
+                                                                                     fechaProcesoFinal,
+                                                                                     wfMovimientos.getHoraProceso(),
+                                                                                     horaProcesoFinalinal,
+                                                                                     null);
             return tiempoEstimado;
         }
 
         return null;
     }
+
+    // Inicio [Req.S17-022] kdelacruz 19.04.2017
+    public BeanWFMovimientos obtenerUltimoMovimiento(final String idMaestra,
+                                                     final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception {
+        final String modulo = "CRActividadSeguimientoCarteraFacade.obtenerUltimaActividad()";
+        List<WFMovimientos> listWFMovimientos;
+        BeanWFMovimientos beanWFMovimientos = null;
+        PropertyParams propertyParams;
+
+        try {
+
+            propertyParams = new PropertyParams();
+            propertyParams.addProperty("wfMaestra.idMaestra", idMaestra);
+            propertyParams.addProperty("estadoRegistro", Constante.INDICADOR_ESTADO_ACTIVO);
+            propertyParams.addPropertyOrder("idMovimiento", true);
+            propertyParams.setMaxResults(1);
+
+            listWFMovimientos = wfMovimientosInterfaceLocal.findByProperties(propertyParams);
+
+            if (!_isEmpty(listWFMovimientos)) {
+                beanWFMovimientos = getBeanWFMovimientos(listWFMovimientos.get(0), beanParametrosAuditoria);
+            }
+
+        } catch (final Exception e) {
+            throw handlerError(e, beanParametrosAuditoria.getUsuarioInsercion(), modulo);
+        }
+        return beanWFMovimientos;
+    }
+    // Fin [Req.S17-022]
 }
diff --git a/FINANCIERONEW/src/financ/workflow/local/WFEstadoFacadeInterfaceLocal.java b/FINANCIERONEW/src/financ/workflow/local/WFEstadoFacadeInterfaceLocal.java
index 76477b6..14b2303 100644
--- a/FINANCIERONEW/src/financ/workflow/local/WFEstadoFacadeInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/workflow/local/WFEstadoFacadeInterfaceLocal.java
@@ -27,5 +27,18 @@
      */
     public List<BeanWFEstado> listarCboEstado(final String idModulo,
                                               final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+    
+    
+    /**
+     * @author kdelacruz
+     * @since [Req.S17-022] 11.04.2017
+     * @param keyEstado
+     * @param beanParametrosAuditoria
+     * @return
+     * @throws Exception
+     */
+    public BeanWFEstado listarEstadoByKey(final String keyEstado,
+                                          final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
+    
 
 }
diff --git a/FINANCIERONEW/src/financ/workflow/local/WFMovimientosFacadeInterfaceLocal.java b/FINANCIERONEW/src/financ/workflow/local/WFMovimientosFacadeInterfaceLocal.java
index 9f80ed1..8709525 100644
--- a/FINANCIERONEW/src/financ/workflow/local/WFMovimientosFacadeInterfaceLocal.java
+++ b/FINANCIERONEW/src/financ/workflow/local/WFMovimientosFacadeInterfaceLocal.java
@@ -43,7 +43,7 @@
      * @throws Exception
      */
     public List<BeanWFMovimientos> buscar(String idMaestra, BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
-    
+
     /**
      * @author kdelacruz
      * @since [Req.S17-007] 21.03.2017
@@ -57,4 +57,14 @@
                                           String idEtapaFinal,
                                           BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 
+    /**
+     * @author esalazar
+     * @since [Req.S17-022] 11.04.2017
+     * @param idMaestra
+     * @param beanParametrosAuditoria
+     * @return
+     * @throws Exception
+     */
+    BeanWFMovimientos obtenerUltimoMovimiento(final String idMaestra,
+                                              final BeanParametrosAuditoria beanParametrosAuditoria) throws Exception;
 }
diff --git a/FINANCIERONEW/src/sbs/util/Constante.java b/FINANCIERONEW/src/sbs/util/Constante.java
index 4f6306e..9efd887 100644
--- a/FINANCIERONEW/src/sbs/util/Constante.java
+++ b/FINANCIERONEW/src/sbs/util/Constante.java
@@ -778,4 +778,7 @@
 
     //[Req.S17-003] kdelacruz 25.01.2017 Implementaci�n de operativa de COFIDE en m�dulo de adeudados
     public static final String CODIGO_PROCESO_ENVIO_REPORTE_VENCIMIENTO_ADEUDOS = "EAREVEAD";
+    
+  //[Req.S17-022] kdelacruz 18.04.2017
+    public static final String CODIGO_PROCESO_ENVIO_CORREO_SEGUIMIENTO_CARTERA = "EACOSECA";
 }
